{"version":3,"sources":["webpack:///./node_modules/@firebase/component/dist/index.cjs.js","webpack:///./node_modules/@firebase/installations/dist/index.esm.js","webpack:///./node_modules/@firebase/logger/dist/index.esm.js"],"names":["Object","defineProperty","exports","value","tslib","util","Component","name","instanceFactory","type","this","multipleInstances","serviceProps","instantiationMode","prototype","setInstantiationMode","mode","setMultipleInstances","setServiceProps","props","DEFAULT_ENTRY_NAME","Provider","container","component","instances","Map","instancesDeferred","get","identifier","normalizedIdentifier","normalizeInstanceIdentifier","has","deferred","Deferred","set","instance","getOrInitializeService","resolve","e","promise","getImmediate","options","_a","__assign","optional","Error","getComponent","setComponent","e_1","isComponentEager","_b","__values","entries","_c","next","done","_d","__read","instanceIdentifier","instanceDeferred","e_1_1","error","return","call","clearInstance","delete","__awaiter","services","__generator","label","Array","from","values","Promise","all","filter","service","map","INTERNAL","sent","isComponentSet","normalizeIdentifierForFactory","undefined","ComponentContainer","providers","addComponent","provider","getProvider","addOrOverwriteComponent","getProviders","version","PENDING_TIMEOUT_MS","PACKAGE_VERSION","INTERNAL_AUTH_VERSION","INSTALLATIONS_API_URL","TOKEN_EXPIRATION_BUFFER","SERVICE","SERVICE_NAME","ERROR_DESCRIPTION_MAP","ERROR_FACTORY","isServerError","code","includes","getInstallationsEndpoint","projectId","extractAuthTokenInfoFromResponse","response","token","requestStatus","expiresIn","getExpiresInFromResponseExpiresIn","creationTime","Date","now","getErrorFromResponse","requestName","responseJson","errorData","json","create","serverCode","serverMessage","message","serverStatus","status","getHeaders","apiKey","Headers","Accept","getHeadersWithAuth","appConfig","refreshToken","headers","append","getAuthorizationHeader","retryIfServerError","fn","result","responseExpiresIn","Number","replace","createInstallationRequest","fid","endpoint","body","request","responseValue","registeredInstallationEntry","authVersion","appId","sdkVersion","method","JSON","stringify","fetch","ok","registrationStatus","authToken","sleep","ms","setTimeout","bufferToBase64UrlSafe","array","b64","btoa","String","fromCharCode","apply","VALID_FID_PATTERN","INVALID_FID","generateFid","fidByteArray","Uint8Array","crypto_1","self","crypto","msCrypto","getRandomValues","encode","test","b64String","substr","getKey","appName","fidChangeCallbacks","fidChanged","key","callFidChangeCallbacks","broadcastFidChange","addCallback","callback","getBroadcastChannel","callbackSet","Set","add","removeCallback","size","closeBroadcastChannel","callbacks","callbacks_1","callbacks_1_1","channel","postMessage","broadcastChannel","BroadcastChannel","onmessage","data","close","DATABASE_NAME","DATABASE_VERSION","OBJECT_STORE_NAME","dbPromise","getDbPromise","upgradeDB","oldVersion","createObjectStore","db","tx","objectStore","oldValue","transaction","put","complete","remove","update","updateFn","store","newValue","getInstallationEntry","registrationPromise","installationEntry","oldEntry","updateOrCreateInstallationEntry","entryWithPromise","triggerRegistrationIfNecessary","entry","clearTimedOutRequest","navigator","onLine","registrationPromiseWithError","reject","inProgressEntry","registrationTime","registerInstallation","waitUntilFidRegistration","trys","push","updateInstallationRequest","hasInstallationRequestTimedOut","generateAuthTokenRequest","platformLoggerProvider","platformLogger","completedAuthToken","getGenerateAuthTokenEndpoint","getPlatformInfoString","installation","refreshAuthToken","dependencies","forceRefresh","tokenPromise","isEntryRegistered","oldAuthToken","isAuthTokenValid","waitUntilAuthTokenRequest","makeAuthTokenRequestInProgressEntry","fetchAuthTokenFromServer","updateAuthTokenRequest","hasAuthTokenRequestTimedOut","updatedInstallationEntry","isAuthTokenExpired","inProgressAuthToken","requestTime","getId","catch","console","getToken","completeInstallationRegistration","deleteInstallationRequest","getDeleteEndpoint","deleteInstallation","onIdChange","extractAppConfig","app","getMissingValueError","configKeys","configKeys_1","configKeys_1_1","keyName","valueName","registerInstallations","installationsName","registerComponent","installations","registerVersion","__spreadArrays","s","i","il","arguments","length","r","k","a","j","jl","LogLevel","levelStringToEnum","DEBUG","VERBOSE","INFO","WARN","ERROR","SILENT","defaultLogLevel","ConsoleMethod","defaultLogHandler","logType","args","_i","logLevel","toISOString","Logger","_logLevel","_logHandler","_userLogHandler","val","TypeError","enumerable","configurable","setLogLevel","debug","log","info","warn","level","forEach","inst","setUserLogHandler","logCallback","_loop_1","customLogLevel","userLogHandler","arg","toString","ignored","join","toLowerCase","instances_1"],"mappings":"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","file":"js/app~1fb195ae.5365b21e.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar tslib = require('tslib');\nvar util = require('@firebase/util');\n\n/**\r\n * Component for service name T, e.g. `auth`, `auth-internal`\r\n */\r\nvar Component = /** @class */ (function () {\r\n    /**\r\n     *\r\n     * @param name The public service name, e.g. app, auth, firestore, database\r\n     * @param instanceFactory Service factory responsible for creating the public interface\r\n     * @param type whether the service provided by the component is public or private\r\n     */\r\n    function Component(name, instanceFactory, type) {\r\n        this.name = name;\r\n        this.instanceFactory = instanceFactory;\r\n        this.type = type;\r\n        this.multipleInstances = false;\r\n        /**\r\n         * Properties to be added to the service namespace\r\n         */\r\n        this.serviceProps = {};\r\n        this.instantiationMode = \"LAZY\" /* LAZY */;\r\n    }\r\n    Component.prototype.setInstantiationMode = function (mode) {\r\n        this.instantiationMode = mode;\r\n        return this;\r\n    };\r\n    Component.prototype.setMultipleInstances = function (multipleInstances) {\r\n        this.multipleInstances = multipleInstances;\r\n        return this;\r\n    };\r\n    Component.prototype.setServiceProps = function (props) {\r\n        this.serviceProps = props;\r\n        return this;\r\n    };\r\n    return Component;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar DEFAULT_ENTRY_NAME = '[DEFAULT]';\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Provider for instance for service name T, e.g. 'auth', 'auth-internal'\r\n * NameServiceMapping[T] is an alias for the type of the instance\r\n */\r\nvar Provider = /** @class */ (function () {\r\n    function Provider(name, container) {\r\n        this.name = name;\r\n        this.container = container;\r\n        this.component = null;\r\n        this.instances = new Map();\r\n        this.instancesDeferred = new Map();\r\n    }\r\n    /**\r\n     * @param identifier A provider can provide mulitple instances of a service\r\n     * if this.component.multipleInstances is true.\r\n     */\r\n    Provider.prototype.get = function (identifier) {\r\n        if (identifier === void 0) { identifier = DEFAULT_ENTRY_NAME; }\r\n        // if multipleInstances is not supported, use the default name\r\n        var normalizedIdentifier = this.normalizeInstanceIdentifier(identifier);\r\n        if (!this.instancesDeferred.has(normalizedIdentifier)) {\r\n            var deferred = new util.Deferred();\r\n            this.instancesDeferred.set(normalizedIdentifier, deferred);\r\n            // If the service instance is available, resolve the promise with it immediately\r\n            try {\r\n                var instance = this.getOrInitializeService(normalizedIdentifier);\r\n                if (instance) {\r\n                    deferred.resolve(instance);\r\n                }\r\n            }\r\n            catch (e) {\r\n                // when the instance factory throws an exception during get(), it should not cause\r\n                // a fatal error. We just return the unresolved promise in this case.\r\n            }\r\n        }\r\n        return this.instancesDeferred.get(normalizedIdentifier).promise;\r\n    };\r\n    Provider.prototype.getImmediate = function (options) {\r\n        var _a = tslib.__assign({ identifier: DEFAULT_ENTRY_NAME, optional: false }, options), identifier = _a.identifier, optional = _a.optional;\r\n        // if multipleInstances is not supported, use the default name\r\n        var normalizedIdentifier = this.normalizeInstanceIdentifier(identifier);\r\n        try {\r\n            var instance = this.getOrInitializeService(normalizedIdentifier);\r\n            if (!instance) {\r\n                if (optional) {\r\n                    return null;\r\n                }\r\n                throw Error(\"Service \" + this.name + \" is not available\");\r\n            }\r\n            return instance;\r\n        }\r\n        catch (e) {\r\n            if (optional) {\r\n                return null;\r\n            }\r\n            else {\r\n                throw e;\r\n            }\r\n        }\r\n    };\r\n    Provider.prototype.getComponent = function () {\r\n        return this.component;\r\n    };\r\n    Provider.prototype.setComponent = function (component) {\r\n        var e_1, _a;\r\n        if (component.name !== this.name) {\r\n            throw Error(\"Mismatching Component \" + component.name + \" for Provider \" + this.name + \".\");\r\n        }\r\n        if (this.component) {\r\n            throw Error(\"Component for \" + this.name + \" has already been provided\");\r\n        }\r\n        this.component = component;\r\n        // if the service is eager, initialize the default instance\r\n        if (isComponentEager(component)) {\r\n            try {\r\n                this.getOrInitializeService(DEFAULT_ENTRY_NAME);\r\n            }\r\n            catch (e) {\r\n                // when the instance factory for an eager Component throws an exception during the eager\r\n                // initialization, it should not cause a fatal error.\r\n                // TODO: Investigate if we need to make it configurable, because some component may want to cause\r\n                // a fatal error in this case?\r\n            }\r\n        }\r\n        try {\r\n            // Create service instances for the pending promises and resolve them\r\n            // NOTE: if this.multipleInstances is false, only the default instance will be created\r\n            // and all promises with resolve with it regardless of the identifier.\r\n            for (var _b = tslib.__values(this.instancesDeferred.entries()), _c = _b.next(); !_c.done; _c = _b.next()) {\r\n                var _d = tslib.__read(_c.value, 2), instanceIdentifier = _d[0], instanceDeferred = _d[1];\r\n                var normalizedIdentifier = this.normalizeInstanceIdentifier(instanceIdentifier);\r\n                try {\r\n                    // `getOrInitializeService()` should always return a valid instance since a component is guaranteed. use ! to make typescript happy.\r\n                    var instance = this.getOrInitializeService(normalizedIdentifier);\r\n                    instanceDeferred.resolve(instance);\r\n                }\r\n                catch (e) {\r\n                    // when the instance factory throws an exception, it should not cause\r\n                    // a fatal error. We just leave the promise unresolved.\r\n                }\r\n            }\r\n        }\r\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\r\n        finally {\r\n            try {\r\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\r\n            }\r\n            finally { if (e_1) throw e_1.error; }\r\n        }\r\n    };\r\n    Provider.prototype.clearInstance = function (identifier) {\r\n        if (identifier === void 0) { identifier = DEFAULT_ENTRY_NAME; }\r\n        this.instancesDeferred.delete(identifier);\r\n        this.instances.delete(identifier);\r\n    };\r\n    // app.delete() will call this method on every provider to delete the services\r\n    // TODO: should we mark the provider as deleted?\r\n    Provider.prototype.delete = function () {\r\n        return tslib.__awaiter(this, void 0, void 0, function () {\r\n            var services;\r\n            return tslib.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        services = Array.from(this.instances.values());\r\n                        return [4 /*yield*/, Promise.all(services\r\n                                .filter(function (service) { return 'INTERNAL' in service; })\r\n                                // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n                                .map(function (service) { return service.INTERNAL.delete(); }))];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Provider.prototype.isComponentSet = function () {\r\n        return this.component != null;\r\n    };\r\n    Provider.prototype.getOrInitializeService = function (identifier) {\r\n        var instance = this.instances.get(identifier);\r\n        if (!instance && this.component) {\r\n            instance = this.component.instanceFactory(this.container, normalizeIdentifierForFactory(identifier));\r\n            this.instances.set(identifier, instance);\r\n        }\r\n        return instance || null;\r\n    };\r\n    Provider.prototype.normalizeInstanceIdentifier = function (identifier) {\r\n        if (this.component) {\r\n            return this.component.multipleInstances ? identifier : DEFAULT_ENTRY_NAME;\r\n        }\r\n        else {\r\n            return identifier; // assume multiple instances are supported before the component is provided.\r\n        }\r\n    };\r\n    return Provider;\r\n}());\r\n// undefined should be passed to the service factory for the default instance\r\nfunction normalizeIdentifierForFactory(identifier) {\r\n    return identifier === DEFAULT_ENTRY_NAME ? undefined : identifier;\r\n}\r\nfunction isComponentEager(component) {\r\n    return component.instantiationMode === \"EAGER\" /* EAGER */;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * ComponentContainer that provides Providers for service name T, e.g. `auth`, `auth-internal`\r\n */\r\nvar ComponentContainer = /** @class */ (function () {\r\n    function ComponentContainer(name) {\r\n        this.name = name;\r\n        this.providers = new Map();\r\n    }\r\n    /**\r\n     *\r\n     * @param component Component being added\r\n     * @param overwrite When a component with the same name has already been registered,\r\n     * if overwrite is true: overwrite the existing component with the new component and create a new\r\n     * provider with the new component. It can be useful in tests where you want to use different mocks\r\n     * for different tests.\r\n     * if overwrite is false: throw an exception\r\n     */\r\n    ComponentContainer.prototype.addComponent = function (component) {\r\n        var provider = this.getProvider(component.name);\r\n        if (provider.isComponentSet()) {\r\n            throw new Error(\"Component \" + component.name + \" has already been registered with \" + this.name);\r\n        }\r\n        provider.setComponent(component);\r\n    };\r\n    ComponentContainer.prototype.addOrOverwriteComponent = function (component) {\r\n        var provider = this.getProvider(component.name);\r\n        if (provider.isComponentSet()) {\r\n            // delete the existing provider from the container, so we can register the new component\r\n            this.providers.delete(component.name);\r\n        }\r\n        this.addComponent(component);\r\n    };\r\n    /**\r\n     * getProvider provides a type safe interface where it can only be called with a field name\r\n     * present in NameServiceMapping interface.\r\n     *\r\n     * Firebase SDKs providing services should extend NameServiceMapping interface to register\r\n     * themselves.\r\n     */\r\n    ComponentContainer.prototype.getProvider = function (name) {\r\n        if (this.providers.has(name)) {\r\n            return this.providers.get(name);\r\n        }\r\n        // create a Provider for a service that hasn't registered with Firebase\r\n        var provider = new Provider(name, this);\r\n        this.providers.set(name, provider);\r\n        return provider;\r\n    };\r\n    ComponentContainer.prototype.getProviders = function () {\r\n        return Array.from(this.providers.values());\r\n    };\r\n    return ComponentContainer;\r\n}());\n\nexports.Component = Component;\nexports.ComponentContainer = ComponentContainer;\nexports.Provider = Provider;\n//# sourceMappingURL=index.cjs.js.map\n","import firebase from '@firebase/app';\nimport { Component } from '@firebase/component';\nimport { __awaiter, __generator, __spread, __values, __assign } from 'tslib';\nimport { ErrorFactory, FirebaseError } from '@firebase/util';\nimport { openDb } from 'idb';\n\nvar name = \"@firebase/installations\";\nvar version = \"0.4.11\";\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar PENDING_TIMEOUT_MS = 10000;\r\nvar PACKAGE_VERSION = \"w:\" + version;\r\nvar INTERNAL_AUTH_VERSION = 'FIS_v2';\r\nvar INSTALLATIONS_API_URL = 'https://firebaseinstallations.googleapis.com/v1';\r\nvar TOKEN_EXPIRATION_BUFFER = 60 * 60 * 1000; // One hour\r\nvar SERVICE = 'installations';\r\nvar SERVICE_NAME = 'Installations';\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar _a;\r\nvar ERROR_DESCRIPTION_MAP = (_a = {},\r\n    _a[\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */] = 'Missing App configuration value: \"{$valueName}\"',\r\n    _a[\"not-registered\" /* NOT_REGISTERED */] = 'Firebase Installation is not registered.',\r\n    _a[\"installation-not-found\" /* INSTALLATION_NOT_FOUND */] = 'Firebase Installation not found.',\r\n    _a[\"request-failed\" /* REQUEST_FAILED */] = '{$requestName} request failed with error \"{$serverCode} {$serverStatus}: {$serverMessage}\"',\r\n    _a[\"app-offline\" /* APP_OFFLINE */] = 'Could not process request. Application offline.',\r\n    _a[\"delete-pending-registration\" /* DELETE_PENDING_REGISTRATION */] = \"Can't delete installation while there is a pending registration request.\",\r\n    _a);\r\nvar ERROR_FACTORY = new ErrorFactory(SERVICE, SERVICE_NAME, ERROR_DESCRIPTION_MAP);\r\n/** Returns true if error is a FirebaseError that is based on an error from the server. */\r\nfunction isServerError(error) {\r\n    return (error instanceof FirebaseError &&\r\n        error.code.includes(\"request-failed\" /* REQUEST_FAILED */));\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getInstallationsEndpoint(_a) {\r\n    var projectId = _a.projectId;\r\n    return INSTALLATIONS_API_URL + \"/projects/\" + projectId + \"/installations\";\r\n}\r\nfunction extractAuthTokenInfoFromResponse(response) {\r\n    return {\r\n        token: response.token,\r\n        requestStatus: 2 /* COMPLETED */,\r\n        expiresIn: getExpiresInFromResponseExpiresIn(response.expiresIn),\r\n        creationTime: Date.now()\r\n    };\r\n}\r\nfunction getErrorFromResponse(requestName, response) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var responseJson, errorData;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, response.json()];\r\n                case 1:\r\n                    responseJson = _a.sent();\r\n                    errorData = responseJson.error;\r\n                    return [2 /*return*/, ERROR_FACTORY.create(\"request-failed\" /* REQUEST_FAILED */, {\r\n                            requestName: requestName,\r\n                            serverCode: errorData.code,\r\n                            serverMessage: errorData.message,\r\n                            serverStatus: errorData.status\r\n                        })];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getHeaders(_a) {\r\n    var apiKey = _a.apiKey;\r\n    return new Headers({\r\n        'Content-Type': 'application/json',\r\n        Accept: 'application/json',\r\n        'x-goog-api-key': apiKey\r\n    });\r\n}\r\nfunction getHeadersWithAuth(appConfig, _a) {\r\n    var refreshToken = _a.refreshToken;\r\n    var headers = getHeaders(appConfig);\r\n    headers.append('Authorization', getAuthorizationHeader(refreshToken));\r\n    return headers;\r\n}\r\n/**\r\n * Calls the passed in fetch wrapper and returns the response.\r\n * If the returned response has a status of 5xx, re-runs the function once and\r\n * returns the response.\r\n */\r\nfunction retryIfServerError(fn) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var result;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, fn()];\r\n                case 1:\r\n                    result = _a.sent();\r\n                    if (result.status >= 500 && result.status < 600) {\r\n                        // Internal Server Error. Retry request.\r\n                        return [2 /*return*/, fn()];\r\n                    }\r\n                    return [2 /*return*/, result];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getExpiresInFromResponseExpiresIn(responseExpiresIn) {\r\n    // This works because the server will never respond with fractions of a second.\r\n    return Number(responseExpiresIn.replace('s', '000'));\r\n}\r\nfunction getAuthorizationHeader(refreshToken) {\r\n    return INTERNAL_AUTH_VERSION + \" \" + refreshToken;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction createInstallationRequest(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var endpoint, headers, body, request, response, responseValue, registeredInstallationEntry;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    endpoint = getInstallationsEndpoint(appConfig);\r\n                    headers = getHeaders(appConfig);\r\n                    body = {\r\n                        fid: fid,\r\n                        authVersion: INTERNAL_AUTH_VERSION,\r\n                        appId: appConfig.appId,\r\n                        sdkVersion: PACKAGE_VERSION\r\n                    };\r\n                    request = {\r\n                        method: 'POST',\r\n                        headers: headers,\r\n                        body: JSON.stringify(body)\r\n                    };\r\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\r\n                case 1:\r\n                    response = _b.sent();\r\n                    if (!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, response.json()];\r\n                case 2:\r\n                    responseValue = _b.sent();\r\n                    registeredInstallationEntry = {\r\n                        fid: responseValue.fid || fid,\r\n                        registrationStatus: 2 /* COMPLETED */,\r\n                        refreshToken: responseValue.refreshToken,\r\n                        authToken: extractAuthTokenInfoFromResponse(responseValue.authToken)\r\n                    };\r\n                    return [2 /*return*/, registeredInstallationEntry];\r\n                case 3: return [4 /*yield*/, getErrorFromResponse('Create Installation', response)];\r\n                case 4: throw _b.sent();\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** Returns a promise that resolves after given time passes. */\r\nfunction sleep(ms) {\r\n    return new Promise(function (resolve) {\r\n        setTimeout(resolve, ms);\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction bufferToBase64UrlSafe(array) {\r\n    var b64 = btoa(String.fromCharCode.apply(String, __spread(array)));\r\n    return b64.replace(/\\+/g, '-').replace(/\\//g, '_');\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar VALID_FID_PATTERN = /^[cdef][\\w-]{21}$/;\r\nvar INVALID_FID = '';\r\n/**\r\n * Generates a new FID using random values from Web Crypto API.\r\n * Returns an empty string if FID generation fails for any reason.\r\n */\r\nfunction generateFid() {\r\n    try {\r\n        // A valid FID has exactly 22 base64 characters, which is 132 bits, or 16.5\r\n        // bytes. our implementation generates a 17 byte array instead.\r\n        var fidByteArray = new Uint8Array(17);\r\n        var crypto_1 = self.crypto || self.msCrypto;\r\n        crypto_1.getRandomValues(fidByteArray);\r\n        // Replace the first 4 random bits with the constant FID header of 0b0111.\r\n        fidByteArray[0] = 112 + (fidByteArray[0] % 16);\r\n        var fid = encode(fidByteArray);\r\n        return VALID_FID_PATTERN.test(fid) ? fid : INVALID_FID;\r\n    }\r\n    catch (_a) {\r\n        // FID generation errored\r\n        return INVALID_FID;\r\n    }\r\n}\r\n/** Converts a FID Uint8Array to a base64 string representation. */\r\nfunction encode(fidByteArray) {\r\n    var b64String = bufferToBase64UrlSafe(fidByteArray);\r\n    // Remove the 23rd character that was added because of the extra 4 bits at the\r\n    // end of our 17 byte array, and the '=' padding.\r\n    return b64String.substr(0, 22);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** Returns a string key that can be used to identify the app. */\r\nfunction getKey(appConfig) {\r\n    return appConfig.appName + \"!\" + appConfig.appId;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar fidChangeCallbacks = new Map();\r\n/**\r\n * Calls the onIdChange callbacks with the new FID value, and broadcasts the\r\n * change to other tabs.\r\n */\r\nfunction fidChanged(appConfig, fid) {\r\n    var key = getKey(appConfig);\r\n    callFidChangeCallbacks(key, fid);\r\n    broadcastFidChange(key, fid);\r\n}\r\nfunction addCallback(appConfig, callback) {\r\n    // Open the broadcast channel if it's not already open,\r\n    // to be able to listen to change events from other tabs.\r\n    getBroadcastChannel();\r\n    var key = getKey(appConfig);\r\n    var callbackSet = fidChangeCallbacks.get(key);\r\n    if (!callbackSet) {\r\n        callbackSet = new Set();\r\n        fidChangeCallbacks.set(key, callbackSet);\r\n    }\r\n    callbackSet.add(callback);\r\n}\r\nfunction removeCallback(appConfig, callback) {\r\n    var key = getKey(appConfig);\r\n    var callbackSet = fidChangeCallbacks.get(key);\r\n    if (!callbackSet) {\r\n        return;\r\n    }\r\n    callbackSet.delete(callback);\r\n    if (callbackSet.size === 0) {\r\n        fidChangeCallbacks.delete(key);\r\n    }\r\n    // Close broadcast channel if there are no more callbacks.\r\n    closeBroadcastChannel();\r\n}\r\nfunction callFidChangeCallbacks(key, fid) {\r\n    var e_1, _a;\r\n    var callbacks = fidChangeCallbacks.get(key);\r\n    if (!callbacks) {\r\n        return;\r\n    }\r\n    try {\r\n        for (var callbacks_1 = __values(callbacks), callbacks_1_1 = callbacks_1.next(); !callbacks_1_1.done; callbacks_1_1 = callbacks_1.next()) {\r\n            var callback = callbacks_1_1.value;\r\n            callback(fid);\r\n        }\r\n    }\r\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\r\n    finally {\r\n        try {\r\n            if (callbacks_1_1 && !callbacks_1_1.done && (_a = callbacks_1.return)) _a.call(callbacks_1);\r\n        }\r\n        finally { if (e_1) throw e_1.error; }\r\n    }\r\n}\r\nfunction broadcastFidChange(key, fid) {\r\n    var channel = getBroadcastChannel();\r\n    if (channel) {\r\n        channel.postMessage({ key: key, fid: fid });\r\n    }\r\n    closeBroadcastChannel();\r\n}\r\nvar broadcastChannel = null;\r\n/** Opens and returns a BroadcastChannel if it is supported by the browser. */\r\nfunction getBroadcastChannel() {\r\n    if (!broadcastChannel && 'BroadcastChannel' in self) {\r\n        broadcastChannel = new BroadcastChannel('[Firebase] FID Change');\r\n        broadcastChannel.onmessage = function (e) {\r\n            callFidChangeCallbacks(e.data.key, e.data.fid);\r\n        };\r\n    }\r\n    return broadcastChannel;\r\n}\r\nfunction closeBroadcastChannel() {\r\n    if (fidChangeCallbacks.size === 0 && broadcastChannel) {\r\n        broadcastChannel.close();\r\n        broadcastChannel = null;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar DATABASE_NAME = 'firebase-installations-database';\r\nvar DATABASE_VERSION = 1;\r\nvar OBJECT_STORE_NAME = 'firebase-installations-store';\r\nvar dbPromise = null;\r\nfunction getDbPromise() {\r\n    if (!dbPromise) {\r\n        dbPromise = openDb(DATABASE_NAME, DATABASE_VERSION, function (upgradeDB) {\r\n            // We don't use 'break' in this switch statement, the fall-through\r\n            // behavior is what we want, because if there are multiple versions between\r\n            // the old version and the current version, we want ALL the migrations\r\n            // that correspond to those versions to run, not only the last one.\r\n            // eslint-disable-next-line default-case\r\n            switch (upgradeDB.oldVersion) {\r\n                case 0:\r\n                    upgradeDB.createObjectStore(OBJECT_STORE_NAME);\r\n            }\r\n        });\r\n    }\r\n    return dbPromise;\r\n}\r\n/** Assigns or overwrites the record for the given key with the given value. */\r\nfunction set(appConfig, value) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx, objectStore, oldValue;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    objectStore = tx.objectStore(OBJECT_STORE_NAME);\r\n                    return [4 /*yield*/, objectStore.get(key)];\r\n                case 2:\r\n                    oldValue = _a.sent();\r\n                    return [4 /*yield*/, objectStore.put(value, key)];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, tx.complete];\r\n                case 4:\r\n                    _a.sent();\r\n                    if (!oldValue || oldValue.fid !== value.fid) {\r\n                        fidChanged(appConfig, value.fid);\r\n                    }\r\n                    return [2 /*return*/, value];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** Removes record(s) from the objectStore that match the given key. */\r\nfunction remove(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    return [4 /*yield*/, tx.objectStore(OBJECT_STORE_NAME).delete(key)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, tx.complete];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Atomically updates a record with the result of updateFn, which gets\r\n * called with the current value. If newValue is undefined, the record is\r\n * deleted instead.\r\n * @return Updated value\r\n */\r\nfunction update(appConfig, updateFn) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx, store, oldValue, newValue;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    store = tx.objectStore(OBJECT_STORE_NAME);\r\n                    return [4 /*yield*/, store.get(key)];\r\n                case 2:\r\n                    oldValue = _a.sent();\r\n                    newValue = updateFn(oldValue);\r\n                    if (!(newValue === undefined)) return [3 /*break*/, 4];\r\n                    return [4 /*yield*/, store.delete(key)];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [3 /*break*/, 6];\r\n                case 4: return [4 /*yield*/, store.put(newValue, key)];\r\n                case 5:\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: return [4 /*yield*/, tx.complete];\r\n                case 7:\r\n                    _a.sent();\r\n                    if (newValue && (!oldValue || oldValue.fid !== newValue.fid)) {\r\n                        fidChanged(appConfig, newValue.fid);\r\n                    }\r\n                    return [2 /*return*/, newValue];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Updates and returns the InstallationEntry from the database.\r\n * Also triggers a registration request if it is necessary and possible.\r\n */\r\nfunction getInstallationEntry(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var registrationPromise, installationEntry, _a;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, update(appConfig, function (oldEntry) {\r\n                        var installationEntry = updateOrCreateInstallationEntry(oldEntry);\r\n                        var entryWithPromise = triggerRegistrationIfNecessary(appConfig, installationEntry);\r\n                        registrationPromise = entryWithPromise.registrationPromise;\r\n                        return entryWithPromise.installationEntry;\r\n                    })];\r\n                case 1:\r\n                    installationEntry = _b.sent();\r\n                    if (!(installationEntry.fid === INVALID_FID)) return [3 /*break*/, 3];\r\n                    _a = {};\r\n                    return [4 /*yield*/, registrationPromise];\r\n                case 2: \r\n                // FID generation failed. Waiting for the FID from the server.\r\n                return [2 /*return*/, (_a.installationEntry = _b.sent(), _a)];\r\n                case 3: return [2 /*return*/, {\r\n                        installationEntry: installationEntry,\r\n                        registrationPromise: registrationPromise\r\n                    }];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Creates a new Installation Entry if one does not exist.\r\n * Also clears timed out pending requests.\r\n */\r\nfunction updateOrCreateInstallationEntry(oldEntry) {\r\n    var entry = oldEntry || {\r\n        fid: generateFid(),\r\n        registrationStatus: 0 /* NOT_STARTED */\r\n    };\r\n    return clearTimedOutRequest(entry);\r\n}\r\n/**\r\n * If the Firebase Installation is not registered yet, this will trigger the\r\n * registration and return an InProgressInstallationEntry.\r\n *\r\n * If registrationPromise does not exist, the installationEntry is guaranteed\r\n * to be registered.\r\n */\r\nfunction triggerRegistrationIfNecessary(appConfig, installationEntry) {\r\n    if (installationEntry.registrationStatus === 0 /* NOT_STARTED */) {\r\n        if (!navigator.onLine) {\r\n            // Registration required but app is offline.\r\n            var registrationPromiseWithError = Promise.reject(ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */));\r\n            return {\r\n                installationEntry: installationEntry,\r\n                registrationPromise: registrationPromiseWithError\r\n            };\r\n        }\r\n        // Try registering. Change status to IN_PROGRESS.\r\n        var inProgressEntry = {\r\n            fid: installationEntry.fid,\r\n            registrationStatus: 1 /* IN_PROGRESS */,\r\n            registrationTime: Date.now()\r\n        };\r\n        var registrationPromise = registerInstallation(appConfig, inProgressEntry);\r\n        return { installationEntry: inProgressEntry, registrationPromise: registrationPromise };\r\n    }\r\n    else if (installationEntry.registrationStatus === 1 /* IN_PROGRESS */) {\r\n        return {\r\n            installationEntry: installationEntry,\r\n            registrationPromise: waitUntilFidRegistration(appConfig)\r\n        };\r\n    }\r\n    else {\r\n        return { installationEntry: installationEntry };\r\n    }\r\n}\r\n/** This will be executed only once for each new Firebase Installation. */\r\nfunction registerInstallation(appConfig, installationEntry) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var registeredInstallationEntry, e_1;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    _a.trys.push([0, 2, , 7]);\r\n                    return [4 /*yield*/, createInstallationRequest(appConfig, installationEntry)];\r\n                case 1:\r\n                    registeredInstallationEntry = _a.sent();\r\n                    return [2 /*return*/, set(appConfig, registeredInstallationEntry)];\r\n                case 2:\r\n                    e_1 = _a.sent();\r\n                    if (!(isServerError(e_1) && e_1.serverCode === 409)) return [3 /*break*/, 4];\r\n                    // Server returned a \"FID can not be used\" error.\r\n                    // Generate a new ID next time.\r\n                    return [4 /*yield*/, remove(appConfig)];\r\n                case 3:\r\n                    // Server returned a \"FID can not be used\" error.\r\n                    // Generate a new ID next time.\r\n                    _a.sent();\r\n                    return [3 /*break*/, 6];\r\n                case 4: \r\n                // Registration failed. Set FID as not registered.\r\n                return [4 /*yield*/, set(appConfig, {\r\n                        fid: installationEntry.fid,\r\n                        registrationStatus: 0 /* NOT_STARTED */\r\n                    })];\r\n                case 5:\r\n                    // Registration failed. Set FID as not registered.\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: throw e_1;\r\n                case 7: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** Call if FID registration is pending in another request. */\r\nfunction waitUntilFidRegistration(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var entry, _a, installationEntry, registrationPromise;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, updateInstallationRequest(appConfig)];\r\n                case 1:\r\n                    entry = _b.sent();\r\n                    _b.label = 2;\r\n                case 2:\r\n                    if (!(entry.registrationStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 5];\r\n                    // createInstallation request still in progress.\r\n                    return [4 /*yield*/, sleep(100)];\r\n                case 3:\r\n                    // createInstallation request still in progress.\r\n                    _b.sent();\r\n                    return [4 /*yield*/, updateInstallationRequest(appConfig)];\r\n                case 4:\r\n                    entry = _b.sent();\r\n                    return [3 /*break*/, 2];\r\n                case 5:\r\n                    if (!(entry.registrationStatus === 0 /* NOT_STARTED */)) return [3 /*break*/, 7];\r\n                    return [4 /*yield*/, getInstallationEntry(appConfig)];\r\n                case 6:\r\n                    _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\r\n                    if (registrationPromise) {\r\n                        return [2 /*return*/, registrationPromise];\r\n                    }\r\n                    else {\r\n                        // if there is no registrationPromise, entry is registered.\r\n                        return [2 /*return*/, installationEntry];\r\n                    }\r\n                case 7: return [2 /*return*/, entry];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Called only if there is a CreateInstallation request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * CreateInstallation request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\r\nfunction updateInstallationRequest(appConfig) {\r\n    return update(appConfig, function (oldEntry) {\r\n        if (!oldEntry) {\r\n            throw ERROR_FACTORY.create(\"installation-not-found\" /* INSTALLATION_NOT_FOUND */);\r\n        }\r\n        return clearTimedOutRequest(oldEntry);\r\n    });\r\n}\r\nfunction clearTimedOutRequest(entry) {\r\n    if (hasInstallationRequestTimedOut(entry)) {\r\n        return {\r\n            fid: entry.fid,\r\n            registrationStatus: 0 /* NOT_STARTED */\r\n        };\r\n    }\r\n    return entry;\r\n}\r\nfunction hasInstallationRequestTimedOut(installationEntry) {\r\n    return (installationEntry.registrationStatus === 1 /* IN_PROGRESS */ &&\r\n        installationEntry.registrationTime + PENDING_TIMEOUT_MS < Date.now());\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction generateAuthTokenRequest(_a, installationEntry) {\r\n    var appConfig = _a.appConfig, platformLoggerProvider = _a.platformLoggerProvider;\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var endpoint, headers, platformLogger, body, request, response, responseValue, completedAuthToken;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    endpoint = getGenerateAuthTokenEndpoint(appConfig, installationEntry);\r\n                    headers = getHeadersWithAuth(appConfig, installationEntry);\r\n                    platformLogger = platformLoggerProvider.getImmediate({\r\n                        optional: true\r\n                    });\r\n                    if (platformLogger) {\r\n                        headers.append('x-firebase-client', platformLogger.getPlatformInfoString());\r\n                    }\r\n                    body = {\r\n                        installation: {\r\n                            sdkVersion: PACKAGE_VERSION\r\n                        }\r\n                    };\r\n                    request = {\r\n                        method: 'POST',\r\n                        headers: headers,\r\n                        body: JSON.stringify(body)\r\n                    };\r\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\r\n                case 1:\r\n                    response = _b.sent();\r\n                    if (!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, response.json()];\r\n                case 2:\r\n                    responseValue = _b.sent();\r\n                    completedAuthToken = extractAuthTokenInfoFromResponse(responseValue);\r\n                    return [2 /*return*/, completedAuthToken];\r\n                case 3: return [4 /*yield*/, getErrorFromResponse('Generate Auth Token', response)];\r\n                case 4: throw _b.sent();\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getGenerateAuthTokenEndpoint(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return getInstallationsEndpoint(appConfig) + \"/\" + fid + \"/authTokens:generate\";\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns a valid authentication token for the installation. Generates a new\r\n * token if one doesn't exist, is expired or about to expire.\r\n *\r\n * Should only be called if the Firebase Installation is registered.\r\n */\r\nfunction refreshAuthToken(dependencies, forceRefresh) {\r\n    if (forceRefresh === void 0) { forceRefresh = false; }\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var tokenPromise, entry, authToken, _a;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, update(dependencies.appConfig, function (oldEntry) {\r\n                        if (!isEntryRegistered(oldEntry)) {\r\n                            throw ERROR_FACTORY.create(\"not-registered\" /* NOT_REGISTERED */);\r\n                        }\r\n                        var oldAuthToken = oldEntry.authToken;\r\n                        if (!forceRefresh && isAuthTokenValid(oldAuthToken)) {\r\n                            // There is a valid token in the DB.\r\n                            return oldEntry;\r\n                        }\r\n                        else if (oldAuthToken.requestStatus === 1 /* IN_PROGRESS */) {\r\n                            // There already is a token request in progress.\r\n                            tokenPromise = waitUntilAuthTokenRequest(dependencies, forceRefresh);\r\n                            return oldEntry;\r\n                        }\r\n                        else {\r\n                            // No token or token expired.\r\n                            if (!navigator.onLine) {\r\n                                throw ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */);\r\n                            }\r\n                            var inProgressEntry = makeAuthTokenRequestInProgressEntry(oldEntry);\r\n                            tokenPromise = fetchAuthTokenFromServer(dependencies, inProgressEntry);\r\n                            return inProgressEntry;\r\n                        }\r\n                    })];\r\n                case 1:\r\n                    entry = _b.sent();\r\n                    if (!tokenPromise) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, tokenPromise];\r\n                case 2:\r\n                    _a = _b.sent();\r\n                    return [3 /*break*/, 4];\r\n                case 3:\r\n                    _a = entry.authToken;\r\n                    _b.label = 4;\r\n                case 4:\r\n                    authToken = _a;\r\n                    return [2 /*return*/, authToken];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Call only if FID is registered and Auth Token request is in progress.\r\n *\r\n * Waits until the current pending request finishes. If the request times out,\r\n * tries once in this thread as well.\r\n */\r\nfunction waitUntilAuthTokenRequest(dependencies, forceRefresh) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var entry, authToken;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, updateAuthTokenRequest(dependencies.appConfig)];\r\n                case 1:\r\n                    entry = _a.sent();\r\n                    _a.label = 2;\r\n                case 2:\r\n                    if (!(entry.authToken.requestStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 5];\r\n                    // generateAuthToken still in progress.\r\n                    return [4 /*yield*/, sleep(100)];\r\n                case 3:\r\n                    // generateAuthToken still in progress.\r\n                    _a.sent();\r\n                    return [4 /*yield*/, updateAuthTokenRequest(dependencies.appConfig)];\r\n                case 4:\r\n                    entry = _a.sent();\r\n                    return [3 /*break*/, 2];\r\n                case 5:\r\n                    authToken = entry.authToken;\r\n                    if (authToken.requestStatus === 0 /* NOT_STARTED */) {\r\n                        // The request timed out or failed in a different call. Try again.\r\n                        return [2 /*return*/, refreshAuthToken(dependencies, forceRefresh)];\r\n                    }\r\n                    else {\r\n                        return [2 /*return*/, authToken];\r\n                    }\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Called only if there is a GenerateAuthToken request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * GenerateAuthToken request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\r\nfunction updateAuthTokenRequest(appConfig) {\r\n    return update(appConfig, function (oldEntry) {\r\n        if (!isEntryRegistered(oldEntry)) {\r\n            throw ERROR_FACTORY.create(\"not-registered\" /* NOT_REGISTERED */);\r\n        }\r\n        var oldAuthToken = oldEntry.authToken;\r\n        if (hasAuthTokenRequestTimedOut(oldAuthToken)) {\r\n            return __assign(__assign({}, oldEntry), { authToken: { requestStatus: 0 /* NOT_STARTED */ } });\r\n        }\r\n        return oldEntry;\r\n    });\r\n}\r\nfunction fetchAuthTokenFromServer(dependencies, installationEntry) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var authToken, updatedInstallationEntry, e_1, updatedInstallationEntry;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    _a.trys.push([0, 3, , 8]);\r\n                    return [4 /*yield*/, generateAuthTokenRequest(dependencies, installationEntry)];\r\n                case 1:\r\n                    authToken = _a.sent();\r\n                    updatedInstallationEntry = __assign(__assign({}, installationEntry), { authToken: authToken });\r\n                    return [4 /*yield*/, set(dependencies.appConfig, updatedInstallationEntry)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [2 /*return*/, authToken];\r\n                case 3:\r\n                    e_1 = _a.sent();\r\n                    if (!(isServerError(e_1) && (e_1.serverCode === 401 || e_1.serverCode === 404))) return [3 /*break*/, 5];\r\n                    // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\r\n                    // Generate a new ID next time.\r\n                    return [4 /*yield*/, remove(dependencies.appConfig)];\r\n                case 4:\r\n                    // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\r\n                    // Generate a new ID next time.\r\n                    _a.sent();\r\n                    return [3 /*break*/, 7];\r\n                case 5:\r\n                    updatedInstallationEntry = __assign(__assign({}, installationEntry), { authToken: { requestStatus: 0 /* NOT_STARTED */ } });\r\n                    return [4 /*yield*/, set(dependencies.appConfig, updatedInstallationEntry)];\r\n                case 6:\r\n                    _a.sent();\r\n                    _a.label = 7;\r\n                case 7: throw e_1;\r\n                case 8: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction isEntryRegistered(installationEntry) {\r\n    return (installationEntry !== undefined &&\r\n        installationEntry.registrationStatus === 2 /* COMPLETED */);\r\n}\r\nfunction isAuthTokenValid(authToken) {\r\n    return (authToken.requestStatus === 2 /* COMPLETED */ &&\r\n        !isAuthTokenExpired(authToken));\r\n}\r\nfunction isAuthTokenExpired(authToken) {\r\n    var now = Date.now();\r\n    return (now < authToken.creationTime ||\r\n        authToken.creationTime + authToken.expiresIn < now + TOKEN_EXPIRATION_BUFFER);\r\n}\r\n/** Returns an updated InstallationEntry with an InProgressAuthToken. */\r\nfunction makeAuthTokenRequestInProgressEntry(oldEntry) {\r\n    var inProgressAuthToken = {\r\n        requestStatus: 1 /* IN_PROGRESS */,\r\n        requestTime: Date.now()\r\n    };\r\n    return __assign(__assign({}, oldEntry), { authToken: inProgressAuthToken });\r\n}\r\nfunction hasAuthTokenRequestTimedOut(authToken) {\r\n    return (authToken.requestStatus === 1 /* IN_PROGRESS */ &&\r\n        authToken.requestTime + PENDING_TIMEOUT_MS < Date.now());\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getId(dependencies) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var _a, installationEntry, registrationPromise;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, getInstallationEntry(dependencies.appConfig)];\r\n                case 1:\r\n                    _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\r\n                    if (registrationPromise) {\r\n                        registrationPromise.catch(console.error);\r\n                    }\r\n                    else {\r\n                        // If the installation is already registered, update the authentication\r\n                        // token if needed.\r\n                        refreshAuthToken(dependencies).catch(console.error);\r\n                    }\r\n                    return [2 /*return*/, installationEntry.fid];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getToken(dependencies, forceRefresh) {\r\n    if (forceRefresh === void 0) { forceRefresh = false; }\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var authToken;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, completeInstallationRegistration(dependencies.appConfig)];\r\n                case 1:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, refreshAuthToken(dependencies, forceRefresh)];\r\n                case 2:\r\n                    authToken = _a.sent();\r\n                    return [2 /*return*/, authToken.token];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction completeInstallationRegistration(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var registrationPromise;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, getInstallationEntry(appConfig)];\r\n                case 1:\r\n                    registrationPromise = (_a.sent()).registrationPromise;\r\n                    if (!registrationPromise) return [3 /*break*/, 3];\r\n                    // A createInstallation request is in progress. Wait until it finishes.\r\n                    return [4 /*yield*/, registrationPromise];\r\n                case 2:\r\n                    // A createInstallation request is in progress. Wait until it finishes.\r\n                    _a.sent();\r\n                    _a.label = 3;\r\n                case 3: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction deleteInstallationRequest(appConfig, installationEntry) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var endpoint, headers, request, response;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    endpoint = getDeleteEndpoint(appConfig, installationEntry);\r\n                    headers = getHeadersWithAuth(appConfig, installationEntry);\r\n                    request = {\r\n                        method: 'DELETE',\r\n                        headers: headers\r\n                    };\r\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\r\n                case 1:\r\n                    response = _a.sent();\r\n                    if (!!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, getErrorFromResponse('Delete Installation', response)];\r\n                case 2: throw _a.sent();\r\n                case 3: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getDeleteEndpoint(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return getInstallationsEndpoint(appConfig) + \"/\" + fid;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction deleteInstallation(dependencies) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var appConfig, entry;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    appConfig = dependencies.appConfig;\r\n                    return [4 /*yield*/, update(appConfig, function (oldEntry) {\r\n                            if (oldEntry && oldEntry.registrationStatus === 0 /* NOT_STARTED */) {\r\n                                // Delete the unregistered entry without sending a deleteInstallation request.\r\n                                return undefined;\r\n                            }\r\n                            return oldEntry;\r\n                        })];\r\n                case 1:\r\n                    entry = _a.sent();\r\n                    if (!entry) return [3 /*break*/, 6];\r\n                    if (!(entry.registrationStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 2];\r\n                    // Can't delete while trying to register.\r\n                    throw ERROR_FACTORY.create(\"delete-pending-registration\" /* DELETE_PENDING_REGISTRATION */);\r\n                case 2:\r\n                    if (!(entry.registrationStatus === 2 /* COMPLETED */)) return [3 /*break*/, 6];\r\n                    if (!!navigator.onLine) return [3 /*break*/, 3];\r\n                    throw ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */);\r\n                case 3: return [4 /*yield*/, deleteInstallationRequest(appConfig, entry)];\r\n                case 4:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, remove(appConfig)];\r\n                case 5:\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Sets a new callback that will get called when Installation ID changes.\r\n * Returns an unsubscribe function that will remove the callback when called.\r\n */\r\nfunction onIdChange(_a, callback) {\r\n    var appConfig = _a.appConfig;\r\n    addCallback(appConfig, callback);\r\n    return function () {\r\n        removeCallback(appConfig, callback);\r\n    };\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction extractAppConfig(app) {\r\n    var e_1, _a;\r\n    if (!app || !app.options) {\r\n        throw getMissingValueError('App Configuration');\r\n    }\r\n    if (!app.name) {\r\n        throw getMissingValueError('App Name');\r\n    }\r\n    // Required app config keys\r\n    var configKeys = [\r\n        'projectId',\r\n        'apiKey',\r\n        'appId'\r\n    ];\r\n    try {\r\n        for (var configKeys_1 = __values(configKeys), configKeys_1_1 = configKeys_1.next(); !configKeys_1_1.done; configKeys_1_1 = configKeys_1.next()) {\r\n            var keyName = configKeys_1_1.value;\r\n            if (!app.options[keyName]) {\r\n                throw getMissingValueError(keyName);\r\n            }\r\n        }\r\n    }\r\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\r\n    finally {\r\n        try {\r\n            if (configKeys_1_1 && !configKeys_1_1.done && (_a = configKeys_1.return)) _a.call(configKeys_1);\r\n        }\r\n        finally { if (e_1) throw e_1.error; }\r\n    }\r\n    return {\r\n        appName: app.name,\r\n        projectId: app.options.projectId,\r\n        apiKey: app.options.apiKey,\r\n        appId: app.options.appId\r\n    };\r\n}\r\nfunction getMissingValueError(valueName) {\r\n    return ERROR_FACTORY.create(\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */, {\r\n        valueName: valueName\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction registerInstallations(instance) {\r\n    var installationsName = 'installations';\r\n    instance.INTERNAL.registerComponent(new Component(installationsName, function (container) {\r\n        var app = container.getProvider('app').getImmediate();\r\n        // Throws if app isn't configured properly.\r\n        var appConfig = extractAppConfig(app);\r\n        var platformLoggerProvider = container.getProvider('platform-logger');\r\n        var dependencies = {\r\n            appConfig: appConfig,\r\n            platformLoggerProvider: platformLoggerProvider\r\n        };\r\n        var installations = {\r\n            app: app,\r\n            getId: function () { return getId(dependencies); },\r\n            getToken: function (forceRefresh) {\r\n                return getToken(dependencies, forceRefresh);\r\n            },\r\n            delete: function () { return deleteInstallation(dependencies); },\r\n            onIdChange: function (callback) {\r\n                return onIdChange(dependencies, callback);\r\n            }\r\n        };\r\n        return installations;\r\n    }, \"PUBLIC\" /* PUBLIC */));\r\n    instance.registerVersion(name, version);\r\n}\r\nregisterInstallations(firebase);\n\nexport { registerInstallations };\n//# sourceMappingURL=index.esm.js.map\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n\r\nfunction __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar _a;\r\n/**\r\n * A container for all of the Logger instances\r\n */\r\nvar instances = [];\r\n/**\r\n * The JS SDK supports 5 log levels and also allows a user the ability to\r\n * silence the logs altogether.\r\n *\r\n * The order is a follows:\r\n * DEBUG < VERBOSE < INFO < WARN < ERROR\r\n *\r\n * All of the log types above the current log level will be captured (i.e. if\r\n * you set the log level to `INFO`, errors will still be logged, but `DEBUG` and\r\n * `VERBOSE` logs will not)\r\n */\r\nvar LogLevel;\r\n(function (LogLevel) {\r\n    LogLevel[LogLevel[\"DEBUG\"] = 0] = \"DEBUG\";\r\n    LogLevel[LogLevel[\"VERBOSE\"] = 1] = \"VERBOSE\";\r\n    LogLevel[LogLevel[\"INFO\"] = 2] = \"INFO\";\r\n    LogLevel[LogLevel[\"WARN\"] = 3] = \"WARN\";\r\n    LogLevel[LogLevel[\"ERROR\"] = 4] = \"ERROR\";\r\n    LogLevel[LogLevel[\"SILENT\"] = 5] = \"SILENT\";\r\n})(LogLevel || (LogLevel = {}));\r\nvar levelStringToEnum = {\r\n    'debug': LogLevel.DEBUG,\r\n    'verbose': LogLevel.VERBOSE,\r\n    'info': LogLevel.INFO,\r\n    'warn': LogLevel.WARN,\r\n    'error': LogLevel.ERROR,\r\n    'silent': LogLevel.SILENT\r\n};\r\n/**\r\n * The default log level\r\n */\r\nvar defaultLogLevel = LogLevel.INFO;\r\n/**\r\n * By default, `console.debug` is not displayed in the developer console (in\r\n * chrome). To avoid forcing users to have to opt-in to these logs twice\r\n * (i.e. once for firebase, and once in the console), we are sending `DEBUG`\r\n * logs to the `console.log` function.\r\n */\r\nvar ConsoleMethod = (_a = {},\r\n    _a[LogLevel.DEBUG] = 'log',\r\n    _a[LogLevel.VERBOSE] = 'log',\r\n    _a[LogLevel.INFO] = 'info',\r\n    _a[LogLevel.WARN] = 'warn',\r\n    _a[LogLevel.ERROR] = 'error',\r\n    _a);\r\n/**\r\n * The default log handler will forward DEBUG, VERBOSE, INFO, WARN, and ERROR\r\n * messages on to their corresponding console counterparts (if the log method\r\n * is supported by the current log level)\r\n */\r\nvar defaultLogHandler = function (instance, logType) {\r\n    var args = [];\r\n    for (var _i = 2; _i < arguments.length; _i++) {\r\n        args[_i - 2] = arguments[_i];\r\n    }\r\n    if (logType < instance.logLevel) {\r\n        return;\r\n    }\r\n    var now = new Date().toISOString();\r\n    var method = ConsoleMethod[logType];\r\n    if (method) {\r\n        console[method].apply(console, __spreadArrays([\"[\" + now + \"]  \" + instance.name + \":\"], args));\r\n    }\r\n    else {\r\n        throw new Error(\"Attempted to log a message with an invalid logType (value: \" + logType + \")\");\r\n    }\r\n};\r\nvar Logger = /** @class */ (function () {\r\n    /**\r\n     * Gives you an instance of a Logger to capture messages according to\r\n     * Firebase's logging scheme.\r\n     *\r\n     * @param name The name that the logs will be associated with\r\n     */\r\n    function Logger(name) {\r\n        this.name = name;\r\n        /**\r\n         * The log level of the given Logger instance.\r\n         */\r\n        this._logLevel = defaultLogLevel;\r\n        /**\r\n         * The main (internal) log handler for the Logger instance.\r\n         * Can be set to a new function in internal package code but not by user.\r\n         */\r\n        this._logHandler = defaultLogHandler;\r\n        /**\r\n         * The optional, additional, user-defined log handler for the Logger instance.\r\n         */\r\n        this._userLogHandler = null;\r\n        /**\r\n         * Capture the current instance for later use\r\n         */\r\n        instances.push(this);\r\n    }\r\n    Object.defineProperty(Logger.prototype, \"logLevel\", {\r\n        get: function () {\r\n            return this._logLevel;\r\n        },\r\n        set: function (val) {\r\n            if (!(val in LogLevel)) {\r\n                throw new TypeError(\"Invalid value \\\"\" + val + \"\\\" assigned to `logLevel`\");\r\n            }\r\n            this._logLevel = val;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    // Workaround for setter/getter having to be the same type.\r\n    Logger.prototype.setLogLevel = function (val) {\r\n        this._logLevel = typeof val === 'string' ? levelStringToEnum[val] : val;\r\n    };\r\n    Object.defineProperty(Logger.prototype, \"logHandler\", {\r\n        get: function () {\r\n            return this._logHandler;\r\n        },\r\n        set: function (val) {\r\n            if (typeof val !== 'function') {\r\n                throw new TypeError('Value assigned to `logHandler` must be a function');\r\n            }\r\n            this._logHandler = val;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Logger.prototype, \"userLogHandler\", {\r\n        get: function () {\r\n            return this._userLogHandler;\r\n        },\r\n        set: function (val) {\r\n            this._userLogHandler = val;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * The functions below are all based on the `console` interface\r\n     */\r\n    Logger.prototype.debug = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        this._userLogHandler && this._userLogHandler.apply(this, __spreadArrays([this, LogLevel.DEBUG], args));\r\n        this._logHandler.apply(this, __spreadArrays([this, LogLevel.DEBUG], args));\r\n    };\r\n    Logger.prototype.log = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        this._userLogHandler && this._userLogHandler.apply(this, __spreadArrays([this, LogLevel.VERBOSE], args));\r\n        this._logHandler.apply(this, __spreadArrays([this, LogLevel.VERBOSE], args));\r\n    };\r\n    Logger.prototype.info = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        this._userLogHandler && this._userLogHandler.apply(this, __spreadArrays([this, LogLevel.INFO], args));\r\n        this._logHandler.apply(this, __spreadArrays([this, LogLevel.INFO], args));\r\n    };\r\n    Logger.prototype.warn = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        this._userLogHandler && this._userLogHandler.apply(this, __spreadArrays([this, LogLevel.WARN], args));\r\n        this._logHandler.apply(this, __spreadArrays([this, LogLevel.WARN], args));\r\n    };\r\n    Logger.prototype.error = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        this._userLogHandler && this._userLogHandler.apply(this, __spreadArrays([this, LogLevel.ERROR], args));\r\n        this._logHandler.apply(this, __spreadArrays([this, LogLevel.ERROR], args));\r\n    };\r\n    return Logger;\r\n}());\r\nfunction setLogLevel(level) {\r\n    instances.forEach(function (inst) {\r\n        inst.setLogLevel(level);\r\n    });\r\n}\r\nfunction setUserLogHandler(logCallback, options) {\r\n    var _loop_1 = function (instance) {\r\n        var customLogLevel = null;\r\n        if (options && options.level) {\r\n            customLogLevel = levelStringToEnum[options.level];\r\n        }\r\n        if (logCallback === null) {\r\n            instance.userLogHandler = null;\r\n        }\r\n        else {\r\n            instance.userLogHandler = function (instance, level) {\r\n                var args = [];\r\n                for (var _i = 2; _i < arguments.length; _i++) {\r\n                    args[_i - 2] = arguments[_i];\r\n                }\r\n                var message = args\r\n                    .map(function (arg) {\r\n                    if (arg == null) {\r\n                        return null;\r\n                    }\r\n                    else if (typeof arg === 'string') {\r\n                        return arg;\r\n                    }\r\n                    else if (typeof arg === 'number' || typeof arg === 'boolean') {\r\n                        return arg.toString();\r\n                    }\r\n                    else if (arg instanceof Error) {\r\n                        return arg.message;\r\n                    }\r\n                    else {\r\n                        try {\r\n                            return JSON.stringify(arg);\r\n                        }\r\n                        catch (ignored) {\r\n                            return null;\r\n                        }\r\n                    }\r\n                })\r\n                    .filter(function (arg) { return arg; })\r\n                    .join(' ');\r\n                if (level >= (customLogLevel !== null && customLogLevel !== void 0 ? customLogLevel : instance.logLevel)) {\r\n                    logCallback({\r\n                        level: LogLevel[level].toLowerCase(),\r\n                        message: message,\r\n                        args: args,\r\n                        type: instance.name\r\n                    });\r\n                }\r\n            };\r\n        }\r\n    };\r\n    for (var _i = 0, instances_1 = instances; _i < instances_1.length; _i++) {\r\n        var instance = instances_1[_i];\r\n        _loop_1(instance);\r\n    }\r\n}\n\nexport { LogLevel, Logger, setLogLevel, setUserLogHandler };\n//# sourceMappingURL=index.esm.js.map\n"],"sourceRoot":""}