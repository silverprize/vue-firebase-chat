{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/store/session/mutations.type.ts","webpack:///./src/store/session/index.ts","webpack:///./src/store/chat/mutations.type.ts","webpack:///./src/store/chat/index.ts","webpack:///./src/store/dialog/index.ts","webpack:///./src/store/root/index.ts","webpack:///./src/store/index.ts","webpack:///./src/store/chat/getters.type.ts","webpack:///./src/store/dialog/getters.type.ts","webpack:///./src/store/session/actions.type.ts","webpack:///./src/store/dialog/types.ts","webpack:///./src/store/session/getters.type.ts","webpack:///./src/router/route.name.ts","webpack:///./src/store/root/mutations.type.ts","webpack:///./src/decorators/WithGlobalSpinner.ts","webpack:///./src/services/backend/types.ts","webpack:///./src/services/backend/index.ts","webpack:///./src/store/chat/actions.type.ts","webpack:///./src/store/root/getters.type.ts","webpack:///./src/router/main/index.ts","webpack:///./src/router/chat-room/index.ts","webpack:///./src/router/chat-room-list/index.ts","webpack:///./src/router/options.ts","webpack:///./src/router/index.ts","webpack:///./src/components/VButton/VButton.tsx","webpack:///./src/store/dialog/actions.type.ts","webpack:///./src/components/VSpinner/VSpinner.tsx","webpack:///./src/components/VModal/VModal.tsx","webpack:///./src/components/DialogMessage/DialogMessage.tsx","webpack:///./src/components/DialogInvitation/DialogInvitation.tsx","webpack:///./src/components/DialogConfirmInvitation/DialogConfirmInvitation.tsx","webpack:///./src/components/DialogContainer/DialogContainer.tsx","webpack:///./src/App.tsx","webpack:///./src/main.ts"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","installedCssChunks","jsonpScriptSrc","p","exports","module","l","e","promises","cssChunks","Promise","resolve","reject","href","fullhref","existingLinkTags","document","getElementsByTagName","tag","dataHref","getAttribute","rel","existingStyleTags","linkTag","createElement","type","onload","onerror","event","request","target","src","err","Error","code","parentNode","removeChild","head","appendChild","then","installedChunkData","promise","onScriptComplete","script","charset","timeout","nc","setAttribute","error","clearTimeout","chunk","errorType","realSrc","message","name","undefined","setTimeout","all","m","c","d","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","oe","jsonpArray","window","oldJsonpFunction","slice","SET_PROFILE","SET_CONNECTED","SET_SIGNED_IN","RESET","state","user","isConnecting","isSignedIn","unsubscribes","getters","mutations","profile","forEach","unsubscribe","actions","context","session","subscribeSessionEvents","id","commit","onAuthChanged","onConnectionChanged","connected","dispatch","dialogType","MESSAGE","params","closeText","onInvite","invitation","CONFIRM_INVITATION","handleOk","router","ChatRoom","roomId","room","SET_ROOMS","SET_PEOPLE","SET_ROOM","CLEAR","ADD_MESSAGE","ADD_USER","REMOVE_USER","IMAGE_UPLOADED","ContentType","SubRoomsKey","SubRoomKey","dummyRoom","order","countPeople","chat","rooms","people","messages","imageMessageIndices","contentType","Image","index","findIndex","set","delete","subscribeRoomsEvent","unsubscribeEvents","subscribeRoomEvent","invitee","currentRoom","unsubscribePromise","reduce","arr","createSystemMessage","content","Type","System","Text","sender","createdAt","Date","now","ROOM_UPDATED","USER_JOINED","USER_LEAVE","NEW_MESSAGE","USER_LIST_LOADED","keys","map","dialog","current","queue","INVITATION","showMessageDialog","showInvitationDialog","showConfirmInvitationDialog","pop","consumeDialogRequest","unshift","usersPromise","users","filter","uid","currentRoomId","storeOptions","isBusy","enable","use","Store","root","GET_ROOMS","GET_ROOM_INFO","GET_MESSAGES","GET_PEOPLE","GET_CURRENT_MESSAGE_DIALOG","GET_CURRENT_INVITATION_DIALOG","GET_CURRENT_CONFIRM_INVITATION_DIALOG","SIGN_IN","SIGN_OUT","CHECK_USER_SESSION","DialogType","IS_CONNECTING","IS_SIGNED_IN","IS_VALID","GET_PROFILE","RouteName","SET_BUSY","factory","options","prop","method","methods","container","args","this","WithGlobalSpinner","Message","ChatRoomEvent","ServerValue","database","firebaseApp","initializeApp","firebaseAuth","auth","firebaseDatabase","firebaseStorage","storage","checkUserSession","off","onAuthStateChanged","getSessionRef","once","sessionSnapshot","val","signIn","signInAnonymously","getCurrentUser","getSessionsRef","orderByChild","equalTo","exist","exists","signOut","update","updateProfile","displayName","remove","dispatchMessage","TIMESTAMP","files","file","getChatRoomRef","child","ref","path","toISOString","join","uploadFile","url","destPath","put","snapshot","getDownloadURL","fetchUsers","snapshots","sendInvitation","getInvitations","inviter","consumeInvitation","subscribeAuthState","callbackFn","userInfo","toJSON","subscribeInvitation","invitationRef","startAt","on","subscribeChatRooms","roomsCallbackFn","chatRoomStatesRef","getChatRoomStatesRef","chatRoomsSnapshots","chatRoomSnapshot","subscribeChatRoom","roomCallbackFn","chatRoomUsersRef","getChatRoomUsersRef","userSnapshots","addUserToChatRoom","me","chatRoomStateRef","getChatRoomStateRef","chatRoomUsersQuery","joinedAt","chatRoomMessagesQuery","getChatRoomMessagesRef","roomUsersDisconnection","onDisconnect","roomStateDisconnection","increment","removeUserFromRoom","cancel","subscribeConnectionState","sessionRef","connectionRef","online","lastChanged","currentUser","getChatRoomsRef","chatRoomUserRef","numChildren","ENTER_LOBBY","LEAVE_LOBBY","ENTER_ROOM","LEAVE_ROOM","DISPATCH_MESSAGE","SEND_INVITATION","IS_BUSY","main","Main","component","chatRoom","chatRooms","ChatRoomList","routes","redirect","routerOptions","base","checkSession","to","from","next","store","beforeEach","VButton","styleVariant","buttonType","$listeners","$slots","default","$attrs","variant","String","NEXT_DIALOG","REQUEST_DIALOG","closeLabel","$emit","okLabel","okText","concat","guest","onOk","chatUser","components","VModal","nextDialog","handleClose","currentInvitationDialog","currentConfirmInvitationDialog","currentMessageDialog","config","productionTip","registerHooks","onError","render","h","$mount"],"mappings":"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","file":"js/app~06837ae4.968c4536.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded CSS chunks\n \tvar installedCssChunks = {\n \t\t\"app~06837ae4\": 0\n \t}\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app~06837ae4\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// script path function\n \tfunction jsonpScriptSrc(chunkId) {\n \t\treturn __webpack_require__.p + \"js/\" + ({\"main~31ecd969\":\"main~31ecd969\",\"vendors~chat-room~chat-room-list~987e6011\":\"vendors~chat-room~chat-room-list~987e6011\",\"chat-room-list~21833f8f\":\"chat-room-list~21833f8f\",\"vendors~chat-room~d939e436\":\"vendors~chat-room~d939e436\",\"chat-room~21833f8f\":\"chat-room~21833f8f\"}[chunkId]||chunkId) + \".\" + {\"main~31ecd969\":\"faa1815a\",\"vendors~chat-room~chat-room-list~987e6011\":\"5d94a9e8\",\"chat-room-list~21833f8f\":\"c7b51227\",\"vendors~chat-room~d939e436\":\"d5065859\",\"chat-room~21833f8f\":\"cfacbdd3\"}[chunkId] + \".js\"\n \t}\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n \t// This file contains only the entry chunk.\n \t// The chunk loading function for additional chunks\n \t__webpack_require__.e = function requireEnsure(chunkId) {\n \t\tvar promises = [];\n\n\n \t\t// mini-css-extract-plugin CSS loading\n \t\tvar cssChunks = {\"main~31ecd969\":1,\"chat-room-list~21833f8f\":1,\"chat-room~21833f8f\":1};\n \t\tif(installedCssChunks[chunkId]) promises.push(installedCssChunks[chunkId]);\n \t\telse if(installedCssChunks[chunkId] !== 0 && cssChunks[chunkId]) {\n \t\t\tpromises.push(installedCssChunks[chunkId] = new Promise(function(resolve, reject) {\n \t\t\t\tvar href = \"css/\" + ({\"main~31ecd969\":\"main~31ecd969\",\"vendors~chat-room~chat-room-list~987e6011\":\"vendors~chat-room~chat-room-list~987e6011\",\"chat-room-list~21833f8f\":\"chat-room-list~21833f8f\",\"vendors~chat-room~d939e436\":\"vendors~chat-room~d939e436\",\"chat-room~21833f8f\":\"chat-room~21833f8f\"}[chunkId]||chunkId) + \".\" + {\"main~31ecd969\":\"15b94d15\",\"vendors~chat-room~chat-room-list~987e6011\":\"31d6cfe0\",\"chat-room-list~21833f8f\":\"52a8c9d7\",\"vendors~chat-room~d939e436\":\"31d6cfe0\",\"chat-room~21833f8f\":\"6b0ced50\"}[chunkId] + \".css\";\n \t\t\t\tvar fullhref = __webpack_require__.p + href;\n \t\t\t\tvar existingLinkTags = document.getElementsByTagName(\"link\");\n \t\t\t\tfor(var i = 0; i < existingLinkTags.length; i++) {\n \t\t\t\t\tvar tag = existingLinkTags[i];\n \t\t\t\t\tvar dataHref = tag.getAttribute(\"data-href\") || tag.getAttribute(\"href\");\n \t\t\t\t\tif(tag.rel === \"stylesheet\" && (dataHref === href || dataHref === fullhref)) return resolve();\n \t\t\t\t}\n \t\t\t\tvar existingStyleTags = document.getElementsByTagName(\"style\");\n \t\t\t\tfor(var i = 0; i < existingStyleTags.length; i++) {\n \t\t\t\t\tvar tag = existingStyleTags[i];\n \t\t\t\t\tvar dataHref = tag.getAttribute(\"data-href\");\n \t\t\t\t\tif(dataHref === href || dataHref === fullhref) return resolve();\n \t\t\t\t}\n \t\t\t\tvar linkTag = document.createElement(\"link\");\n \t\t\t\tlinkTag.rel = \"stylesheet\";\n \t\t\t\tlinkTag.type = \"text/css\";\n \t\t\t\tlinkTag.onload = resolve;\n \t\t\t\tlinkTag.onerror = function(event) {\n \t\t\t\t\tvar request = event && event.target && event.target.src || fullhref;\n \t\t\t\t\tvar err = new Error(\"Loading CSS chunk \" + chunkId + \" failed.\\n(\" + request + \")\");\n \t\t\t\t\terr.code = \"CSS_CHUNK_LOAD_FAILED\";\n \t\t\t\t\terr.request = request;\n \t\t\t\t\tdelete installedCssChunks[chunkId]\n \t\t\t\t\tlinkTag.parentNode.removeChild(linkTag)\n \t\t\t\t\treject(err);\n \t\t\t\t};\n \t\t\t\tlinkTag.href = fullhref;\n\n \t\t\t\tvar head = document.getElementsByTagName(\"head\")[0];\n \t\t\t\thead.appendChild(linkTag);\n \t\t\t}).then(function() {\n \t\t\t\tinstalledCssChunks[chunkId] = 0;\n \t\t\t}));\n \t\t}\n\n \t\t// JSONP chunk loading for javascript\n\n \t\tvar installedChunkData = installedChunks[chunkId];\n \t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n \t\t\t// a Promise means \"currently loading\".\n \t\t\tif(installedChunkData) {\n \t\t\t\tpromises.push(installedChunkData[2]);\n \t\t\t} else {\n \t\t\t\t// setup Promise in chunk cache\n \t\t\t\tvar promise = new Promise(function(resolve, reject) {\n \t\t\t\t\tinstalledChunkData = installedChunks[chunkId] = [resolve, reject];\n \t\t\t\t});\n \t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n \t\t\t\t// start chunk loading\n \t\t\t\tvar script = document.createElement('script');\n \t\t\t\tvar onScriptComplete;\n\n \t\t\t\tscript.charset = 'utf-8';\n \t\t\t\tscript.timeout = 120;\n \t\t\t\tif (__webpack_require__.nc) {\n \t\t\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n \t\t\t\t}\n \t\t\t\tscript.src = jsonpScriptSrc(chunkId);\n\n \t\t\t\t// create error before stack unwound to get useful stacktrace later\n \t\t\t\tvar error = new Error();\n \t\t\t\tonScriptComplete = function (event) {\n \t\t\t\t\t// avoid mem leaks in IE.\n \t\t\t\t\tscript.onerror = script.onload = null;\n \t\t\t\t\tclearTimeout(timeout);\n \t\t\t\t\tvar chunk = installedChunks[chunkId];\n \t\t\t\t\tif(chunk !== 0) {\n \t\t\t\t\t\tif(chunk) {\n \t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n \t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n \t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n \t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n \t\t\t\t\t\t\terror.type = errorType;\n \t\t\t\t\t\t\terror.request = realSrc;\n \t\t\t\t\t\t\tchunk[1](error);\n \t\t\t\t\t\t}\n \t\t\t\t\t\tinstalledChunks[chunkId] = undefined;\n \t\t\t\t\t}\n \t\t\t\t};\n \t\t\t\tvar timeout = setTimeout(function(){\n \t\t\t\t\tonScriptComplete({ type: 'timeout', target: script });\n \t\t\t\t}, 120000);\n \t\t\t\tscript.onerror = script.onload = onScriptComplete;\n \t\t\t\tdocument.head.appendChild(script);\n \t\t\t}\n \t\t}\n \t\treturn Promise.all(promises);\n \t};\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/vue-firebase-chat/\";\n\n \t// on error function for async loading\n \t__webpack_require__.oe = function(err) { console.error(err); throw err; };\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"app~c5b24172\",\"app~8a6c828a\",\"app~7ffa8a2f\",\"app~8b322766\",\"app~1fb195ae\",\"app~c1554789\",\"app~d939e436\",\"app~b58f7129\",\"app~1c3a2c3f\",\"app~d2305125\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","export const SET_PROFILE = 'session.setProfile'\nexport const SET_CONNECTED = 'session.setConnected'\nexport const SET_SIGNED_IN = 'session.setSignedIn'\nexport const RESET = 'session.clear'\n","import { ActionContext, Module } from 'vuex'\nimport { RESET, SET_CONNECTED, SET_PROFILE, SET_SIGNED_IN } from './mutations.type'\nimport { GET_PROFILE, IS_CONNECTING, IS_SIGNED_IN, IS_VALID } from './getters.type'\nimport { CHECK_USER_SESSION, SIGN_IN, SIGN_OUT } from '@/store/session/actions.type'\nimport { RootState } from '@/store/root'\nimport {\n  checkUserSession,\n  consumeInvitation,\n  Profile,\n  signIn,\n  signOut,\n  subscribeAuthState,\n  subscribeConnectionState,\n  subscribeInvitation,\n} from '@/services/backend'\nimport { ConfirmInvitationDialog, DialogType } from '@/store/dialog/types'\nimport { REQUEST_DIALOG } from '@/store/dialog/actions.type'\nimport RouteName from '@/router/route.name'\nimport router from '@/router'\n\ninterface State {\n  user: Profile | null;\n  isConnecting: boolean;\n  isSignedIn: boolean;\n  unsubscribes: (() => void)[];\n}\n\nconst module: Module<State, RootState> = {\n  state: () => ({\n    user: null,\n    isConnecting: false,\n    isSignedIn: false,\n    unsubscribes: [],\n  }),\n  getters: {\n    [IS_CONNECTING]: state => state.isConnecting,\n    [IS_SIGNED_IN]: state => state.isSignedIn,\n    [IS_VALID]: (state, getters) => getters[IS_CONNECTING] && getters[IS_SIGNED_IN],\n    [GET_PROFILE]: state => state.user,\n  },\n  mutations: {\n    [SET_PROFILE](state, profile: Profile) {\n      state.user = profile\n    },\n    [SET_CONNECTED](state, isConnecting: boolean) {\n      state.isConnecting = isConnecting\n    },\n    [SET_SIGNED_IN](state, isSignedIn: boolean) {\n      state.isSignedIn = isSignedIn\n    },\n    [RESET](state) {\n      state.unsubscribes.forEach(unsubscribe => unsubscribe())\n      state.user = null\n      state.isConnecting = false\n      state.isSignedIn = false\n      state.unsubscribes = []\n    },\n  },\n  actions: {\n    async [CHECK_USER_SESSION](context) {\n      const session = await checkUserSession()\n      if (session) {\n        await subscribeSessionEvents(context)\n      } else {\n        throw new Error('Unauthorized')\n      }\n      return session\n    },\n    async [SIGN_IN](context, id) {\n      await signIn(id)\n      await subscribeSessionEvents(context)\n    },\n    async [SIGN_OUT]({ commit }) {\n      await signOut()\n      commit(RESET)\n    },\n  },\n}\n\nfunction subscribeSessionEvents(context: ActionContext<State, RootState>) {\n  const onAuthChanged = (profile: Profile | null) => {\n    if (profile) {\n      context.commit(SET_PROFILE, profile)\n    }\n    context.commit(SET_SIGNED_IN, profile != null)\n  }\n  const onConnectionChanged = (connected: boolean) => {\n    if (context.getters[IS_CONNECTING] && !connected) {\n      context.dispatch(REQUEST_DIALOG, {\n        dialogType: DialogType.MESSAGE,\n        params: {\n          message: '서버와 연결이 끊겼습니다.',\n          closeText: '',\n        },\n      })\n    }\n    context.commit(SET_CONNECTED, connected)\n  }\n  const onInvite = (invitation: ConfirmInvitationDialog.Params) => {\n    context.dispatch(REQUEST_DIALOG, {\n      dialogType: DialogType.CONFIRM_INVITATION,\n      params: {\n        ...invitation,\n        handleOk: () => {\n          consumeInvitation(invitation.id)\n          router.push({\n            name: RouteName.ChatRoom,\n            params: { roomId: invitation.room.id },\n          })\n        },\n      },\n    })\n  }\n\n  context.commit(RESET)\n  context.state.unsubscribes.push(\n    subscribeInvitation(onInvite),\n    subscribeAuthState(onAuthChanged),\n    subscribeConnectionState(onConnectionChanged),\n  )\n}\n\nexport default module\n","export const SET_ROOMS = 'chat.setRooms'\nexport const SET_PEOPLE = 'chat.setPeople'\nexport const SET_ROOM = 'chat.setRoom'\nexport const CLEAR = 'chat.clear'\nexport const ADD_MESSAGE = 'chat.addMessage'\nexport const ADD_USER = 'chat.addUser'\nexport const REMOVE_USER = 'chat.removeUser'\nexport const IMAGE_UPLOADED = 'chat.imageUploaded'\n","import Vue from 'vue'\nimport { ActionContext, Module } from 'vuex'\nimport { v1 as uuid } from 'uuid'\nimport {\n  ADD_MESSAGE,\n  ADD_USER,\n  CLEAR,\n  IMAGE_UPLOADED,\n  REMOVE_USER,\n  SET_PEOPLE,\n  SET_ROOM,\n  SET_ROOMS,\n} from './mutations.type'\nimport { GET_MESSAGES, GET_PEOPLE, GET_ROOM_INFO, GET_ROOMS } from '@/store/chat/getters.type'\nimport {\n  DISPATCH_MESSAGE,\n  ENTER_LOBBY,\n  ENTER_ROOM,\n  LEAVE_LOBBY,\n  LEAVE_ROOM,\n  SEND_INVITATION,\n} from '@/store/chat/actions.type'\nimport { RootState } from '@/store/root'\nimport {\n  ChatRoomEvent,\n  ChatUser,\n  dispatchMessage,\n  Message,\n  Room,\n  sendInvitation,\n  subscribeChatRoom,\n  subscribeChatRooms,\n} from '@/services/backend'\nimport { Dictionary } from '@/types/common'\nimport ContentType = Message.ContentType\n\ninterface State {\n  rooms: Room[];\n  people: ChatUser[];\n  messages: Message[];\n  room: Room;\n  unsubscribes: Dictionary<Promise<() => void>>;\n  imageMessageIndices: Dictionary<number>\n}\n\nconst SubRoomsKey = 'RoomsKey'\nconst SubRoomKey = 'RoomKey'\nconst dummyRoom = { id: '', order: -1, name: '', countPeople: 0 }\nconst chat: Module<State, RootState> = {\n  state: () => ({\n    rooms: [],\n    people: [],\n    messages: [],\n    room: dummyRoom,\n    unsubscribes: {},\n    imageMessageIndices: {},\n  }),\n  getters: {\n    [GET_ROOMS]: state => state.rooms,\n    [GET_ROOM_INFO]: state => state.room,\n    [GET_MESSAGES]: state => state.messages,\n    [GET_PEOPLE]: state => state.people,\n  },\n  mutations: {\n    [SET_ROOMS](state, rooms) {\n      state.rooms = rooms\n    },\n    [SET_PEOPLE](state, people) {\n      state.people = people\n    },\n    [SET_ROOM](state, room: Room) {\n      state.room = room\n    },\n    [ADD_MESSAGE](state, message: Message) {\n      if (message.contentType === Message.ContentType.Image) {\n        state.imageMessageIndices[message.id] = state.messages.length\n      }\n      state.messages.push(message)\n    },\n    [ADD_USER](state, user: ChatUser) {\n      state.people.push(user)\n    },\n    [REMOVE_USER](state, user: ChatUser) {\n      const index = state.people.findIndex(({ id }) => id === user.id)\n      state.people.splice(index, 1)\n    },\n    [IMAGE_UPLOADED](state, message: Message) {\n      const index = state.imageMessageIndices[message.id]\n      Vue.set(state.messages, index, message)\n      Vue.delete(state.imageMessageIndices, message.id)\n    },\n    [CLEAR](state) {\n      state.messages = []\n      state.rooms = []\n      state.people = []\n      state.room = dummyRoom\n    },\n  },\n  actions: {\n    [ENTER_LOBBY](context) {\n      return subscribeRoomsEvent(context)\n    },\n    [LEAVE_LOBBY](context) {\n      return unsubscribeEvents(context, [SubRoomsKey])\n    },\n    [ENTER_ROOM]: (context, roomId) => {\n      context.commit(CLEAR)\n      return subscribeRoomEvent(context, roomId)\n    },\n    [LEAVE_ROOM]: (context) => {\n      return unsubscribeEvents(context, [SubRoomKey])\n    },\n    [DISPATCH_MESSAGE](context, message: Message.Params) {\n      return dispatchMessage(context.state.room.id, message)\n    },\n    [SEND_INVITATION]({ getters }, invitee: string) {\n      const currentRoom: Room = getters[GET_ROOM_INFO]\n      return sendInvitation({\n        room: {\n          id: currentRoom.id,\n          name: currentRoom.name,\n        },\n        invitee,\n      })\n    },\n  },\n}\n\nasync function subscribeRoomsEvent(context: ActionContext<State, RootState>) {\n  const unsubscribePromise = subscribeChatRooms((rooms) => {\n    context.commit(SET_ROOMS, rooms.reduce((arr, room) => {\n      arr[room.order] = room\n      return arr\n    }, [...context.state.rooms]))\n  })\n  context.state.unsubscribes[SubRoomsKey] = unsubscribePromise\n  return unsubscribePromise\n}\n\nasync function subscribeRoomEvent(context: ActionContext<State, RootState>, roomId: string) {\n  function createSystemMessage(content: string): Message {\n    return {\n      id: uuid(),\n      type: Message.Type.System,\n      contentType: ContentType.Text,\n      content,\n      sender: { id: '', name: '' },\n      createdAt: Date.now(),\n    }\n  }\n  const unsubscribePromise = subscribeChatRoom(roomId, (event, data) => {\n    switch (event) {\n      case ChatRoomEvent.ROOM_UPDATED:\n        context.commit(SET_ROOM, data)\n        break\n      case ChatRoomEvent.USER_JOINED:\n        context.commit(\n          ADD_MESSAGE,\n          createSystemMessage(`${(data as ChatUser).name}님이 입장했습니다.`),\n        )\n        context.commit(ADD_USER, data)\n        break\n      case ChatRoomEvent.USER_LEAVE:\n        context.commit(\n          ADD_MESSAGE,\n          createSystemMessage(`${(data as ChatUser).name}님이 퇴장했습니다.`),\n        )\n        context.commit(REMOVE_USER, data)\n        break\n      case ChatRoomEvent.NEW_MESSAGE:\n        context.commit(ADD_MESSAGE, data)\n        break\n      case ChatRoomEvent.IMAGE_UPLOADED:\n        context.commit(IMAGE_UPLOADED, data)\n        break\n      case ChatRoomEvent.USER_LIST_LOADED:\n        context.commit(SET_PEOPLE, data)\n        break\n    }\n  })\n  context.state.unsubscribes[SubRoomKey] = unsubscribePromise\n  return unsubscribePromise\n}\n\nasync function unsubscribeEvents(context: ActionContext<State, RootState>, keys: string[]) {\n  await Promise.all(keys.map(key => {\n    const unsubscribePromise = context.state.unsubscribes[key]\n    if (unsubscribePromise != null) {\n      Vue.delete(context.state.unsubscribes, key)\n      return unsubscribePromise.then((unsubscribe) => unsubscribe())\n    }\n  }))\n}\n\nexport default chat\n","import { ActionContext, Module } from 'vuex'\nimport { RootState } from '@/store/root'\nimport { NEXT_DIALOG, REQUEST_DIALOG } from '@/store/dialog/actions.type'\nimport {\n  ConfirmInvitationDialog,\n  DialogType,\n  InvitationDialog,\n  MessageDialog,\n} from '@/store/dialog/types'\nimport {\n  GET_CURRENT_CONFIRM_INVITATION_DIALOG,\n  GET_CURRENT_INVITATION_DIALOG,\n  GET_CURRENT_MESSAGE_DIALOG,\n} from '@/store/dialog/getters.type'\nimport { fetchUsers, Profile, Room } from '@/services/backend'\nimport { GET_PROFILE } from '@/store/session/getters.type'\nimport { GET_ROOM_INFO } from '@/store/chat/getters.type'\n\ninterface DialogRequestParams {\n  dialogType: DialogType;\n  params: MessageDialog.Params | InvitationDialog.Params | ConfirmInvitationDialog.Params;\n}\n\ninterface State {\n  [DialogType.MESSAGE]: {\n    current: MessageDialog.Params | null;\n    queue: MessageDialog.Params[];\n  },\n  [DialogType.INVITATION]: {\n    current: InvitationDialog.Params | null;\n    queue: InvitationDialog.Params[];\n  },\n  [DialogType.CONFIRM_INVITATION]: {\n    current: ConfirmInvitationDialog.Params | null;\n    queue: ConfirmInvitationDialog.Params[];\n  },\n}\n\nconst dialog: Module<State, RootState> = {\n  state: () => ({\n    [DialogType.MESSAGE]: {\n      current: null,\n      queue: [],\n    },\n    [DialogType.INVITATION]: {\n      current: null,\n      queue: [],\n    },\n    [DialogType.CONFIRM_INVITATION]: {\n      current: null,\n      queue: [],\n    },\n  }),\n  getters: {\n    [GET_CURRENT_MESSAGE_DIALOG]: (state) => state[DialogType.MESSAGE].current,\n    [GET_CURRENT_INVITATION_DIALOG]: (state) => state[DialogType.INVITATION].current,\n    [GET_CURRENT_CONFIRM_INVITATION_DIALOG]: (state) => state[DialogType.CONFIRM_INVITATION].current,\n  },\n  actions: {\n    [REQUEST_DIALOG](context: ActionContext<State, RootState>, { dialogType, params }: DialogRequestParams) {\n      switch (dialogType) {\n        case DialogType.MESSAGE:\n          showMessageDialog(context, params as MessageDialog.Params)\n          break\n        case DialogType.INVITATION:\n          showInvitationDialog(context, params as InvitationDialog.Params)\n          break\n        case DialogType.CONFIRM_INVITATION:\n          showConfirmInvitationDialog(context, params as ConfirmInvitationDialog.Params)\n          break\n      }\n    },\n    [NEXT_DIALOG](context, dialogType: DialogType) {\n      context.state[dialogType].current = null\n      setTimeout(() => {\n        context.state[dialogType].current = context.state[dialogType].queue.pop() || null\n      }, 100)\n    },\n  },\n}\n\nfunction consumeDialogRequest(\n  { state, dispatch } : ActionContext<State, RootState>,\n  { dialogType, params }: { dialogType: DialogType, params: any },\n) {\n  if (state[dialogType].current != null) {\n    state[dialogType].queue.unshift(params)\n  } else {\n    state[dialogType].current = params\n  }\n}\n\nfunction showInvitationDialog(context: ActionContext<State, RootState>, params: InvitationDialog.Params) {\n  const profile: Profile = context.getters[GET_PROFILE]\n  const currentRoom: Room = context.getters[GET_ROOM_INFO]\n  consumeDialogRequest(context, {\n    dialogType: DialogType.INVITATION,\n    params: {\n      usersPromise: fetchUsers()\n        .then((users) =>\n          users.filter((user) =>\n            profile.uid !== user.id && user.currentRoomId !== currentRoom.id)),\n      handleOk: params.handleOk,\n    },\n  })\n}\n\nfunction showConfirmInvitationDialog(context: ActionContext<State, RootState>, params: ConfirmInvitationDialog.Params) {\n  consumeDialogRequest(context, {\n    dialogType: DialogType.CONFIRM_INVITATION,\n    params,\n  })\n}\n\nfunction showMessageDialog(context: ActionContext<State, RootState>, params: MessageDialog.Params) {\n  consumeDialogRequest(context, {\n    dialogType: DialogType.MESSAGE,\n    params,\n  })\n}\n\nexport default dialog\nexport { DialogRequestParams }\n","import { StoreOptions } from 'vuex'\nimport session from '@/store/session'\nimport chat from '@/store/chat'\nimport dialog from '@/store/dialog'\nimport { IS_BUSY } from './getters.type'\nimport { SET_BUSY } from './mutations.type'\n\ninterface RootState {\n  isBusy: boolean;\n}\n\nconst storeOptions: StoreOptions<RootState> = {\n  modules: {\n    session,\n    chat,\n    dialog,\n  },\n  state: () => ({\n    isBusy: true,\n  }),\n  getters: {\n    [IS_BUSY]: state => state.isBusy,\n  },\n  mutations: {\n    [SET_BUSY](state, enable) {\n      state.isBusy = enable\n    },\n  },\n}\n\nexport {\n  RootState,\n}\nexport default storeOptions\n","import Vue from 'vue'\nimport Vuex from 'vuex'\nimport rootModule from '@/store/root'\n\nVue.use(Vuex)\n\nexport default new Vuex.Store(rootModule)\n","export const GET_ROOMS = 'chat.getRooms'\nexport const GET_ROOM_INFO = 'chat.getRoom'\nexport const GET_MESSAGES = 'chat.getMessages'\nexport const GET_PEOPLE = 'chat.getPeople'\n","export const GET_DIALOG_REQUEST_QUEUE = 'dialog.getDialogRequestQueue'\nexport const GET_CURRENT_MESSAGE_DIALOG = 'dialog.getCurrentMessageDialog'\nexport const GET_CURRENT_INVITATION_DIALOG = 'dialog.getCurrentInvitationDialog'\nexport const GET_CURRENT_CONFIRM_INVITATION_DIALOG = 'dialog.getCurrentConfirmInvitationDialog'\n","export const SIGN_IN = 'session.signIn'\nexport const SIGN_OUT = 'session.signOut'\nexport const CHECK_USER_SESSION = 'root.checkUserSession'\n","import { ChatUser } from '@/services/backend'\n\ndeclare namespace InvitationDialog {\n  export interface Params {\n    usersPromise?: Promise<ChatUser[]>;\n    handleOk?: (uid: string) => void;\n    handleClose?: () => void;\n  }\n}\n\ndeclare namespace MessageDialog {\n  export interface Params {\n    message: string[] | string;\n    okText: string;\n    closeText: string;\n    handleOk?: () => void;\n    handleClose?: () => void;\n  }\n}\n\ndeclare namespace ConfirmInvitationDialog {\n  export interface Params {\n    id: string;\n    inviter: { id: string; name: string; };\n    room: { id: string; name: string; };\n    handleOk?: (roomId: string) => void;\n    handleClose?: () => void;\n  }\n}\n\nenum DialogType {\n  MESSAGE = 'message',\n  INVITATION = 'invitation',\n  CONFIRM_INVITATION = 'confirm',\n}\n\nexport { DialogType, InvitationDialog, MessageDialog, ConfirmInvitationDialog }\n","export const IS_CONNECTING = 'session.isConnecting'\nexport const IS_SIGNED_IN = 'session.isSignedIn'\nexport const IS_VALID = 'session.isValid'\nexport const GET_PROFILE = 'session.getProfile'\n","enum RouteName {\n  Main = 'Main',\n  ChatRoomList = 'ChatRoomList',\n  ChatRoom = 'ChatRoom',\n}\n\nexport default RouteName\n","export const SET_BUSY = 'root.setBusy'\n","import { createDecorator } from 'vue-class-component'\nimport { Vue } from 'vue-property-decorator'\nimport store from '@/store'\nimport { SET_BUSY } from '@/store/root/mutations.type'\nimport { ComponentOptions } from 'vue'\n\nconst factory = createDecorator((options: ComponentOptions<Vue>, prop: string) => {\n  const method = options.methods?.[prop] || (options as { [key: string]: any })[prop]\n  const container: any = options.methods?.[prop] ? options.methods : options\n\n  if (!method) {\n    throw new Error(`${prop} of ${method}`)\n  }\n\n  container[prop] = async function (this: Vue, ...args: any[]) {\n    store.commit(SET_BUSY, true)\n    try {\n      return await method.apply(this, args)\n    } finally {\n      store.commit(SET_BUSY, false)\n    }\n  }\n})\n\nexport function WithGlobalSpinner(target: Vue, key: string) {\n  factory(target, key)\n}\n","import { UserInfo } from 'firebase/app'\n\nnamespace Message {\n  export interface Params {\n    content: string | File[] | null;\n    contentType: Message.ContentType;\n  }\n  export enum Type {\n    User = 'USER',\n    System = 'SYSTEM',\n  }\n\n  export enum ContentType {\n    Text = 'TEXT',\n    Image = 'IMAGE',\n  }\n}\n\ntype Profile = UserInfo\n\ntype Timestamp = number\n\ninterface Message {\n  id: string,\n  type: Message.Type;\n  content: string;\n  contentType: Message.ContentType;\n  sender: {\n    id: string;\n    name: string;\n  };\n  createdAt: Timestamp;\n}\n\ninterface ChatUser {\n  id: string;\n  name: string;\n  joinedAt: Timestamp;\n}\n\ninterface Room {\n  id: string;\n  order: number;\n  name: string;\n  countPeople: number;\n}\n\ninterface Session {\n  id: string;\n  name: string;\n  currentRoomId: string;\n}\n\nexport {\n  Profile,\n  Room,\n  Message,\n  ChatUser,\n  Session,\n}\n","import firebase, { UserInfo } from 'firebase/app'\nimport 'firebase/auth'\nimport 'firebase/database'\nimport 'firebase/storage'\nimport 'firebase/analytics'\nimport { ChatUser, Message, Room, Session } from '@/services/backend/types'\nimport firebaseConfig from '@/../firebase.config.json'\nimport DataSnapshot = firebase.database.DataSnapshot\nimport ContentType = Message.ContentType\n\nconst ServerValue = firebase.database.ServerValue\nconst firebaseApp = firebase.initializeApp(firebaseConfig)\nconst firebaseAuth = firebaseApp.auth()\nconst firebaseDatabase = firebaseApp.database()\nconst firebaseStorage = firebaseApp.storage()\n\nenum ChatRoomEvent {\n  ROOM_UPDATED,\n  USER_LIST_LOADED,\n  USER_JOINED,\n  USER_LEAVE,\n  NEW_MESSAGE,\n  IMAGE_UPLOADED,\n}\n\nfunction checkUserSession(): Promise<Session | null> {\n  return new Promise((resolve, reject) => {\n    const off = firebaseAuth.onAuthStateChanged(async (user) => {\n      off()\n      try {\n        const sessionSnapshot = await getSessionRef().once('value')\n        resolve(sessionSnapshot.val())\n      } catch (e) {\n        reject(e)\n      }\n    })\n  })\n}\n\nasync function signIn(name: string) {\n  await firebaseAuth.signInAnonymously()\n  const user = getCurrentUser()\n  const exist = await getSessionsRef().orderByChild('name').equalTo(name).once('value')\n  if (exist.exists()) {\n    firebaseAuth.signOut()\n    throw new Error('사용중인 이름입니다.')\n  }\n  await Promise.all([\n    getSessionRef().update({\n      name,\n    }),\n    user.updateProfile({ displayName: name }),\n  ])\n  return user\n}\n\nfunction signOut() {\n  getSessionRef().remove()\n  return firebaseAuth.signOut()\n}\n\nfunction dispatchMessage(roomId: string, params: Message.Params) {\n  const user = getCurrentUser()\n  const message = {\n    ...params,\n    sender: {\n      id: user.uid,\n      name: user.displayName,\n    },\n    createdAt: ServerValue.TIMESTAMP,\n  }\n  if (params.contentType === Message.ContentType.Image) {\n    const files = params.content as File[]\n    message.content = null\n    return files.map(async (file) =>\n      getChatRoomRef(roomId)\n        .child('messages')\n        .push(message)\n        .then(ref => {\n          const path = [\n            roomId,\n            ref.key,\n            new Date().toISOString(),\n            user.uid,\n            file.name,\n          ].join('/')\n          uploadFile(path, file).then((url) => ref.update({ content: url }))\n        }))\n  } else {\n    return getChatRoomRef(roomId)\n      .child('messages')\n      .push(message)\n  }\n}\n\nfunction uploadFile(destPath: string, file: File) {\n  return firebaseStorage\n    .ref(destPath)\n    .put(file)\n    .then((snapshot) => snapshot.ref.getDownloadURL())\n}\n\nasync function fetchUsers() {\n  const snapshots = await getSessionsRef()\n    .orderByChild('online')\n    .equalTo(true)\n    .once('value')\n  const users: { id: string; name: string, currentRoomId: string; }[] = []\n  snapshots.forEach((snapshot) => {\n    const data = snapshot.val()\n    users.push({\n      id: snapshot.key as string,\n      name: data.name,\n      currentRoomId: data.currentRoomId,\n    })\n  })\n  return users\n}\n\nfunction sendInvitation({ room, invitee }: {\n  room: { id: string; name: string };\n  invitee: string;\n}) {\n  const { uid, displayName } = getCurrentUser()\n  return getInvitations()\n    .child(invitee)\n    .push({\n      room,\n      inviter: {\n        id: uid,\n        name: displayName,\n      },\n      createdAt: ServerValue.TIMESTAMP,\n    })\n}\n\nfunction consumeInvitation(key: string) {\n  const { uid } = getCurrentUser()\n  return getInvitations().child(uid).child(key).remove()\n}\n\nfunction subscribeAuthState(callbackFn: (user: UserInfo | null) => void) {\n  return firebaseAuth.onAuthStateChanged((user) => {\n    const userInfo = (user?.toJSON() as UserInfo) || null\n    callbackFn(userInfo)\n  })\n}\n\nfunction subscribeInvitation(callbackFn: (invitation: any) => void) {\n  const { uid } = getCurrentUser()\n  const invitationRef = getInvitations()\n    .child(uid)\n    .orderByChild('createdAt')\n    .startAt(Date.now())\n  invitationRef.on('child_added', snapshot => callbackFn({\n    ...snapshot.val(),\n    id: snapshot.key,\n  }))\n  return () => invitationRef.off()\n}\n\nfunction subscribeChatRooms(roomsCallbackFn: (rooms: Room[]) => void): Promise<() => void> {\n  return new Promise(resolve => {\n    const chatRoomStatesRef = getChatRoomStatesRef().orderByChild('order')\n    chatRoomStatesRef.on('value', (chatRoomsSnapshots: DataSnapshot) => {\n      const rooms: Room[] = []\n      chatRoomsSnapshots.forEach(chatRoomSnapshot => {\n        const data = chatRoomSnapshot.val()\n        rooms.push({\n          ...data,\n          countPeople: data.countPeople || 0,\n          id: chatRoomSnapshot.key,\n        })\n      })\n      roomsCallbackFn(rooms)\n      resolve(() => chatRoomStatesRef.off())\n    })\n  })\n}\n\nasync function subscribeChatRoom(roomId: string, roomCallbackFn: (event: ChatRoomEvent, data: Room | ChatUser | Message | ChatUser[]) => void) {\n  const { uid } = getCurrentUser()\n  const chatRoomUsersRef = getChatRoomUsersRef(roomId)\n  const userSnapshots = await chatRoomUsersRef.once('value')\n  const me: ChatUser = await addUserToChatRoom(roomId)\n  const chatRoomStateRef = getChatRoomStateRef(roomId)\n  const chatRoomUsersQuery = chatRoomUsersRef.orderByChild('joinedAt').startAt(me.joinedAt)\n  const chatRoomMessagesQuery = getChatRoomMessagesRef(roomId).orderByChild('createdAt').startAt(me.joinedAt)\n  const roomUsersDisconnection = chatRoomUsersQuery.ref.child(uid).onDisconnect()\n  const roomStateDisconnection = chatRoomStateRef.onDisconnect()\n\n  await Promise.all([\n    roomUsersDisconnection.remove(),\n    roomStateDisconnection.update({ countPeople: ServerValue.increment(-1) }),\n  ])\n\n  const users: ChatUser[] = []\n  userSnapshots.forEach(snapshot => {\n    users.push({\n      ...snapshot.val(),\n      id: snapshot.key,\n    })\n  })\n  roomCallbackFn(ChatRoomEvent.USER_LIST_LOADED, users)\n\n  chatRoomStateRef.on('value', (snapshot) => {\n    const data = snapshot.val()\n    roomCallbackFn(\n      ChatRoomEvent.ROOM_UPDATED,\n      {\n        ...data,\n        id: snapshot.key,\n      },\n    )\n  })\n  chatRoomUsersQuery.on('child_added', (snapshot) => {\n    const data = snapshot.val()\n    roomCallbackFn(\n      ChatRoomEvent.USER_JOINED,\n      data,\n    )\n  })\n  chatRoomUsersQuery.on('child_removed', (snapshot) => {\n    const data = snapshot.val()\n    roomCallbackFn(\n      ChatRoomEvent.USER_LEAVE,\n      data,\n    )\n  })\n  chatRoomMessagesQuery.on('child_added', (snapshot) => {\n    const data = snapshot.val()\n    const message: Message = {\n      ...data,\n      id: snapshot.key,\n    }\n    roomCallbackFn(\n      ChatRoomEvent.NEW_MESSAGE,\n      message,\n    )\n  })\n  chatRoomMessagesQuery.on('child_changed', (snapshot) => {\n    const data = snapshot.val()\n    if (data.contentType === ContentType.Image && data.content) {\n      roomCallbackFn(\n        ChatRoomEvent.IMAGE_UPLOADED,\n        {\n          ...data,\n          id: snapshot.key,\n        },\n      )\n    }\n  })\n\n  return async () => {\n    chatRoomStateRef.off()\n    chatRoomUsersQuery.off()\n    chatRoomMessagesQuery.off()\n    await removeUserFromRoom(roomId)\n    await Promise.all([\n      roomStateDisconnection.cancel(),\n      roomUsersDisconnection.cancel(),\n    ])\n  }\n}\n\n// https://firebase.google.com/docs/firestore/solutions/presence?hl=ko\nfunction subscribeConnectionState(callbackFn: (connected: boolean) => void) {\n  const { uid } = getCurrentUser()\n  const sessionRef = firebaseDatabase.ref(`/sessions/${uid}`)\n  const connectionRef = firebaseDatabase.ref('.info/connected')\n  let promise = Promise.resolve()\n  connectionRef.on(\n    'value',\n    (snapshot) => {\n      promise = promise.then(() => {\n        if (snapshot.val() === false) {\n          callbackFn(false)\n          return\n        }\n        return sessionRef\n          .onDisconnect()\n          .update({\n            online: false,\n            lastChanged: ServerValue.TIMESTAMP,\n          })\n          .then(() => {\n            sessionRef.update({\n              online: true,\n              lastChanged: ServerValue.TIMESTAMP,\n            })\n            callbackFn(true)\n          })\n      })\n    },\n  )\n\n  return () => connectionRef.off()\n}\n\nfunction getCurrentUser() {\n  const user = firebaseAuth.currentUser\n  if (user == null) {\n    throw new Error('Unauthorized')\n  }\n  return user\n}\n\nfunction getChatRoomStatesRef() {\n  return firebaseDatabase.ref('chatRoomStates')\n}\n\nfunction getChatRoomStateRef(roomId: string) {\n  return getChatRoomStatesRef().child(roomId)\n}\n\nfunction getChatRoomsRef() {\n  return firebaseDatabase.ref('chatRooms')\n}\n\nfunction getChatRoomRef(roomId: string) {\n  return getChatRoomsRef().child(roomId)\n}\n\nfunction getChatRoomUsersRef(roomId: string) {\n  return getChatRoomRef(roomId).child('users')\n}\n\nfunction getChatRoomMessagesRef(roomId: string) {\n  return getChatRoomRef(roomId).child('messages')\n}\n\nfunction getSessionsRef() {\n  return firebaseDatabase.ref('sessions')\n}\n\nfunction getSessionRef() {\n  return getSessionsRef().child(getCurrentUser().uid)\n}\n\nfunction getInvitations() {\n  return firebaseDatabase.ref('invitations')\n}\n\nasync function addUserToChatRoom(roomId: string) {\n  const { uid, displayName } = getCurrentUser()\n  const chatRoomUsersRef = getChatRoomUsersRef(roomId)\n  const chatRoomUserRef = chatRoomUsersRef.child(uid)\n  const chatRoomStateRef = getChatRoomStateRef(roomId)\n  const sessionRef = getSessionRef()\n  try {\n    await chatRoomUserRef.set({\n      id: uid,\n      name: displayName,\n      joinedAt: ServerValue.TIMESTAMP,\n    })\n    const users = await chatRoomUsersRef.once('value')\n    await chatRoomStateRef.update({ countPeople: users.numChildren() })\n    await sessionRef.update({ currentRoomId: roomId })\n    const me = await chatRoomUserRef.once('value')\n    return me.val()\n  } catch (e) {\n    sessionRef.update({ currentRoomId: null })\n    chatRoomUserRef.remove()\n    throw e\n  }\n}\n\nasync function removeUserFromRoom(roomId: string) {\n  const { uid } = getCurrentUser()\n  const chatRoomStateRef = getChatRoomStateRef(roomId)\n  const chatRoomUsersRef = getChatRoomUsersRef(roomId)\n  const chatRoomUserRef = chatRoomUsersRef.child(uid)\n  const sessionRef = getSessionRef()\n  try {\n    await chatRoomUserRef.remove()\n    const users = await chatRoomUsersRef.once('value')\n    await chatRoomStateRef.update({ countPeople: users.numChildren() })\n    await sessionRef.update({ currentRoomId: null })\n  } catch {\n    sessionRef.update({ currentRoomId: null })\n    chatRoomUserRef.remove()\n  }\n}\n\nexport * from './types'\nexport {\n  ChatRoomEvent,\n  checkUserSession,\n  signIn,\n  signOut,\n  dispatchMessage,\n  subscribeConnectionState,\n  subscribeAuthState,\n  subscribeInvitation,\n  subscribeChatRoom,\n  subscribeChatRooms,\n  uploadFile,\n  fetchUsers,\n  sendInvitation,\n  consumeInvitation,\n}\n","export const ENTER_LOBBY = 'chat.enterLobby'\nexport const LEAVE_LOBBY = 'chat.leaveLobby'\nexport const ENTER_ROOM = 'chat.enterRoom'\nexport const LEAVE_ROOM = 'chat.leaveRoom'\nexport const DISPATCH_MESSAGE = 'chat.dispatchMessage'\nexport const SEND_INVITATION = 'chat.sendInvitation'\n","export const IS_BUSY = 'root.isBusy'\n","import { RouteConfig } from 'vue-router'\nimport RouteName from '@/router/route.name'\n\nconst main: RouteConfig = {\n  path: '/',\n  name: RouteName.Main,\n  component: () => import(/* webpackChunkName: \"main\" */ '@/views/main/PageMain'),\n}\nexport default main\n","import { RouteConfig } from 'vue-router'\nimport RouteName from '@/router/route.name'\n\nconst chatRoom: RouteConfig = {\n  path: '/rooms/:roomId',\n  name: RouteName.ChatRoom,\n  component: () => import(/* webpackChunkName: \"chat-room\" */ '@/views/chat-room/PageChatRoom'),\n}\n\nexport default chatRoom\n","import { RouteConfig } from 'vue-router'\nimport RouteName from '@/router/route.name'\n\nconst chatRooms: RouteConfig = {\n  path: '/rooms',\n  name: RouteName.ChatRoomList,\n  component: () => import(/* webpackChunkName: \"chat-room-list\" */ '@/views/chat-room-list/PageChatRoomList'),\n}\n\nexport default chatRooms\n","import { RouteConfig, RouterOptions } from 'vue-router'\nimport main from '@/router/main'\nimport chatRoom from '@/router/chat-room'\nimport chatRoomList from '@/router/chat-room-list'\nimport RouteName from '@/router/route.name'\n\nconst routes: RouteConfig[] = [\n  main,\n  chatRoomList,\n  chatRoom,\n  {\n    path: '*',\n    redirect: { name: RouteName.Main },\n  },\n]\n\nconst routerOptions: RouterOptions = {\n  mode: 'history',\n  base: process.env.BASE_URL,\n  routes,\n}\n\nexport default routerOptions\n","import Vue from 'vue'\nimport VueRouter, { Location, Route } from 'vue-router'\nimport routerOptions from './options'\nimport RouteName from '@/router/route.name'\nimport store from '@/store'\nimport { IS_SIGNED_IN } from '@/store/session/getters.type'\n\nVue.use(VueRouter)\n\nconst router = new VueRouter(routerOptions)\n\nasync function checkSession(to: Route, from: Route, next: (to?: Location) => void) {\n  if (to.name !== RouteName.Main && !store.getters[IS_SIGNED_IN]) {\n    next({ name: RouteName.Main })\n  } else {\n    next()\n  }\n}\n\n// 접속 페이지가 아닌 다른 페이지로 접근 했을때,\n// 서버 연결중이 아니면 접속 페이지로 이동하도록 확인\nrouter.beforeEach(checkSession)\n\nexport default router\n","import * as tsx from 'vue-tsx-support'\nimport { Component, Prop } from 'vue-property-decorator'\nimport './VButton.scss'\n\ninterface VButtonProps {\n  type?: string;\n  variant?: string;\n  disabled?: boolean;\n}\n\ninterface VButtonEvents {\n  onClick($event: Event): void\n}\n\n@Component\nexport default class VButton extends tsx.Component<VButtonProps, VButtonEvents> {\n  @Prop(String)\n  readonly variant!: string\n\n  get buttonType() {\n    return this.$attrs.type || 'button'\n  }\n\n  get styleVariant() {\n    return this.variant ? `button_${this.variant}` : ''\n  }\n\n  render() {\n    return (\n      <button\n        staticClass=\"button\"\n        class={this.styleVariant}\n        type={this.buttonType}\n        on={this.$listeners}\n      >\n        {this.$slots.default}\n      </button>\n    )\n  }\n}\n\n// VUE JSX HOT LOADER //\nif (module.hot) require(\"/Users/1100392/workspaces/vue-firebase-chat/node_modules/vue-jsx-hot-loader/src/api.js\")({ Vue: require('vue'), ctx: eval('this'), module: module, hotId: \"_vue_jsx_hot-9ecf2f78/VButton.tsx\" });","export const NEXT_DIALOG = 'dialog.nextDialog'\nexport const REQUEST_DIALOG = 'dialog.requestDialog'\n","import { Component, Vue } from 'vue-property-decorator'\nimport './VSpinner.scss'\n\n@Component\nexport default class VSpinner extends Vue {\n  render() {\n    return <div class=\"spinner\" />\n  }\n}\n\n// VUE JSX HOT LOADER //\nif (module.hot) require(\"/Users/1100392/workspaces/vue-firebase-chat/node_modules/vue-jsx-hot-loader/src/api.js\")({ Vue: require('vue'), ctx: eval('this'), module: module, hotId: \"_vue_jsx_hot-49407092/VSpinner.tsx\" });","import * as tsx from 'vue-tsx-support'\nimport { Component, Prop } from 'vue-property-decorator'\n\nimport './VModal.scss'\nimport VButton from '@/components/VButton/VButton'\n\ninterface VModalProps {\n  okLabel?: string;\n  closeLabel?: string;\n}\n\ninterface VModalEvents {\n  onOk(): void\n  onClose(): void\n}\n\n@Component\nexport default class VModal extends tsx.Component<VModalProps, VModalEvents> {\n  @Prop({ type: String, default: '확인' })\n  private readonly okLabel!: string\n\n  @Prop({ type: String, default: '닫기' })\n  private readonly closeLabel!: string\n\n  render() {\n    return (\n      <div class=\"dialog-background\">\n        <div class=\"dialog-window\">\n          <div class=\"dialog-body\">\n            {this.$slots.default}\n          </div>\n          <div class=\"dialog-footer\">\n            {this.closeLabel &&\n              <VButton\n                variant=\"light\"\n                class=\"dialog-footer__close-button\"\n                onClick={() => this.$emit('close')}\n              >\n                {this.closeLabel}\n              </VButton>\n            }\n            <VButton\n              variant=\"yellow\"\n              onClick={() => this.$emit('ok')}\n            >\n              {this.okLabel}\n            </VButton>\n          </div>\n        </div>\n      </div>\n    )\n  }\n}\n\n// VUE JSX HOT LOADER //\nif (module.hot) require(\"/Users/1100392/workspaces/vue-firebase-chat/node_modules/vue-jsx-hot-loader/src/api.js\")({ Vue: require('vue'), ctx: eval('this'), module: module, hotId: \"_vue_jsx_hot-20995912/VModal.tsx\" });","import * as tsx from 'vue-tsx-support'\nimport { Component, Prop } from 'vue-property-decorator'\nimport VModal from '@/components/VModal/VModal'\nimport { MessageDialog } from '@/store/dialog/types'\n\ninterface Props {\n  params: MessageDialog.Params;\n}\n\ninterface Events {\n  onOk(): void\n  onClose(): void\n}\n\n@Component\nexport default class DialogMessage extends tsx.Component<Props, Events> {\n  @Prop(Object)\n  private readonly params!: MessageDialog.Params\n\n  get message() {\n    return ([] as string[]).concat(this.params.message).map((message, index) => (\n      <div\n        key={index}\n        class=\"dialog-content-message\"\n      >\n        {message}\n      </div>\n    ))\n  }\n\n  render() {\n    return (\n      <VModal\n        okLabel={this.params.okText}\n        closeLabel={this.params.closeText}\n        onOk={() => this.$emit('ok')}\n        onClose={() => this.$emit('close')}\n      >\n        <div class=\"dialog-content\">\n          {this.message}\n        </div>\n      </VModal>\n    )\n  }\n}\n\n// VUE JSX HOT LOADER //\nif (module.hot) require(\"/Users/1100392/workspaces/vue-firebase-chat/node_modules/vue-jsx-hot-loader/src/api.js\")({ Vue: require('vue'), ctx: eval('this'), module: module, hotId: \"_vue_jsx_hot-0fce821c/DialogMessage.tsx\" });","import * as tsx from 'vue-tsx-support'\nimport { Component, Prop } from 'vue-property-decorator'\n\nimport './DialogInvitation.scss'\nimport VModal from '@/components/VModal/VModal'\nimport { ChatUser } from '@/services/backend'\nimport { WithGlobalSpinner } from '@/decorators/WithGlobalSpinner'\nimport { InvitationDialog } from '@/store/dialog/types'\n\ninterface Props {\n  params: InvitationDialog.Params;\n}\n\ninterface Events {\n  onOk(uid: string): void\n  onClose(): void\n}\n\n@Component({\n  components: { VModal },\n})\nexport default class DialogInvitation extends tsx.Component<Props, Events> {\n  @Prop(Object)\n  private readonly params!: InvitationDialog.Params\n\n  private users: ChatUser[] | null = null\n\n  private guest: string = ''\n\n  @WithGlobalSpinner\n  private async onOk() {\n    if (this.guest) {\n      this.$emit('ok', this.guest)\n    }\n  }\n\n  @WithGlobalSpinner\n  async mounted() {\n    const users = await this.params.usersPromise\n    this.users = users || []\n    if (this.users.length) {\n      this.guest = this.users[0].id\n    }\n  }\n\n  render() {\n    return (\n      <VModal\n        okLabel=\"초대\"\n        onOk={this.onOk}\n        onClose={() => this.$emit('close')}\n      >\n        <div class=\"dialog-content\">\n          <label\n            class=\"dialog-select-user-label\"\n            for=\"user\"\n          >\n            초대할 사람을 선택하세요.\n          </label>\n          <select\n            id=\"user\"\n            v-model={this.guest}\n            value={this.guest}\n            class=\"dialog-select-user\"\n          >\n            {this.users?.length &&\n              this.users.map(chatUser => (\n                <option\n                  key={chatUser.id}\n                  value={chatUser.id}\n                >\n                  {chatUser.name}\n                </option>\n              ))\n            }\n            {this.users && !this.users.length &&\n                <option\n                  disabled\n                  value=\"\"\n                >\n                  초대할 사람이 없습니다.\n                </option>\n            }\n          </select>\n        </div>\n      </VModal>\n    )\n  }\n}\n\n// VUE JSX HOT LOADER //\nif (module.hot) require(\"/Users/1100392/workspaces/vue-firebase-chat/node_modules/vue-jsx-hot-loader/src/api.js\")({ Vue: require('vue'), ctx: eval('this'), module: module, hotId: \"_vue_jsx_hot-4d927852/DialogInvitation.tsx\" });","import * as tsx from 'vue-tsx-support'\nimport { Component, Prop } from 'vue-property-decorator'\n\nimport VModal from '@/components/VModal/VModal'\nimport { ConfirmInvitationDialog } from '@/store/dialog/types'\n\ninterface Props {\n  params: ConfirmInvitationDialog.Params;\n}\n\ninterface Events {\n  onOk(roomId: string): void\n  onClose(): void\n}\n\n@Component\nexport default class DialogConfirmInvitation extends tsx.Component<Props, Events> {\n  @Prop(Object)\n  private readonly params!: ConfirmInvitationDialog.Params\n\n  render() {\n    return (\n      <VModal\n        okLabel=\"수락\"\n        onOk={() => this.$emit('ok', this.params.room.id)}\n        onClose={() => this.$emit('close')}\n      >\n        <div class=\"dialog-content\">\n          <div class=\"dialog-content-message\">\n            <strong>{this.params.inviter.name}</strong> 님이,\n          </div>\n          <div class=\"dialog-content-message\">\n            <strong>{this.params.room.name}</strong> 방으로 초대했습니다.\n          </div>\n        </div>\n      </VModal>\n    )\n  }\n}\n\n// VUE JSX HOT LOADER //\nif (module.hot) require(\"/Users/1100392/workspaces/vue-firebase-chat/node_modules/vue-jsx-hot-loader/src/api.js\")({ Vue: require('vue'), ctx: eval('this'), module: module, hotId: \"_vue_jsx_hot-39aed7d6/DialogConfirmInvitation.tsx\" });","import { Component, Vue } from 'vue-property-decorator'\nimport { Action, Getter } from 'vuex-class'\n\nimport './DialogContainer.scss'\nimport DialogMessage from '@/components/DialogMessage/DialogMessage'\nimport {\n  ConfirmInvitationDialog,\n  DialogType,\n  InvitationDialog,\n  MessageDialog,\n} from '@/store/dialog/types'\nimport {\n  GET_CURRENT_CONFIRM_INVITATION_DIALOG,\n  GET_CURRENT_INVITATION_DIALOG,\n  GET_CURRENT_MESSAGE_DIALOG,\n} from '@/store/dialog/getters.type'\nimport DialogInvitation from '@/components/DialogInvitation/DialogInvitation'\nimport { NEXT_DIALOG } from '@/store/dialog/actions.type'\nimport DialogConfirmInvitation from '@/components/DialogConfirmInvitation/DialogConfirmInvitation'\n\n@Component\nexport default class DialogContainer extends Vue {\n  @Getter(GET_CURRENT_MESSAGE_DIALOG)\n  private readonly currentMessageDialog!: MessageDialog.Params | null\n\n  @Getter(GET_CURRENT_INVITATION_DIALOG)\n  private readonly currentInvitationDialog!: InvitationDialog.Params | null\n\n  @Getter(GET_CURRENT_CONFIRM_INVITATION_DIALOG)\n  private readonly currentConfirmInvitationDialog!: ConfirmInvitationDialog.Params | null\n\n  @Action(NEXT_DIALOG)\n  private readonly nextDialog!: (dialogType: DialogType) => void\n\n  private handleOk(dialogType: DialogType, dialog: { handleOk?: (result: any) => void }, result?: any) {\n    dialog.handleOk?.(result)\n    this.nextDialog(dialogType)\n  }\n\n  private handleClose(dialogType: DialogType, dialog: { handleClose?: () => void }) {\n    dialog.handleClose?.()\n    this.nextDialog(dialogType)\n  }\n\n  render() {\n    return (\n      <div class=\"dialog-container\">\n        {this.currentInvitationDialog &&\n          <DialogInvitation params={this.currentInvitationDialog}\n            onOk={(uid) => this.handleOk(DialogType.INVITATION, this.currentInvitationDialog!, uid)}\n            onClose={() => this.handleClose(DialogType.INVITATION, this.currentInvitationDialog!)}\n          />\n        }\n        {this.currentConfirmInvitationDialog &&\n          <DialogConfirmInvitation params={this.currentConfirmInvitationDialog}\n            onOk={(roomId) => this.handleOk(DialogType.CONFIRM_INVITATION, this.currentConfirmInvitationDialog!, roomId)}\n            onClose={() => this.handleClose(DialogType.CONFIRM_INVITATION, this.currentConfirmInvitationDialog!)}\n          />\n        }\n        {this.currentMessageDialog &&\n          <DialogMessage params={this.currentMessageDialog}\n            onOk={() => this.handleOk(DialogType.MESSAGE, this.currentMessageDialog!)}\n            onClose={() => this.handleClose(DialogType.MESSAGE, this.currentMessageDialog!)}\n          />\n        }\n      </div>\n    )\n  }\n}\n\n// VUE JSX HOT LOADER //\nif (module.hot) require(\"/Users/1100392/workspaces/vue-firebase-chat/node_modules/vue-jsx-hot-loader/src/api.js\")({ Vue: require('vue'), ctx: eval('this'), module: module, hotId: \"_vue_jsx_hot-c8a73434/DialogContainer.tsx\" });","import { Component, Vue } from 'vue-property-decorator'\nimport { Getter } from 'vuex-class'\n\nimport '@/scss/index.scss'\nimport { IS_BUSY } from '@/store/root/getters.type'\nimport VSpinner from '@/components/VSpinner/VSpinner'\nimport DialogContainer from '@/components/DialogContainer/DialogContainer'\n\n@Component\nexport default class App extends Vue {\n  @Getter(IS_BUSY)\n  readonly isBusy!: boolean\n\n  render() {\n    return (\n      <div id=\"app\">\n        <router-view />\n        <DialogContainer />\n        <div class=\"global-spinner\" v-show={this.isBusy}>\n          <VSpinner />\n        </div>\n      </div>\n    )\n  }\n}\n\n// VUE JSX HOT LOADER //\nif (module.hot) require(\"/Users/1100392/workspaces/vue-firebase-chat/node_modules/vue-jsx-hot-loader/src/api.js\")({ Vue: require('vue'), ctx: eval('this'), module: module, hotId: \"_vue_jsx_hot-df853f0a/App.tsx\" });","import Vue from 'vue'\nimport { Component } from 'vue-property-decorator'\nimport App from './App'\nimport router from './router'\nimport store from './store'\n\nVue.config.productionTip = false\n\nComponent.registerHooks([\n  'beforeRouteEnter',\n  'beforeRouteUpdate',\n  'beforeRouteLeave',\n])\n\nrouter.onError((err) => console.warn(err))\n\nnew Vue({\n  router,\n  store,\n  render: h => h(App),\n}).$mount('#app')\n"],"sourceRoot":""}