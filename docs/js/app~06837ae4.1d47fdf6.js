(function(e){function t(t){for(var r,a,i=t[0],u=t[1],s=t[2],d=0,l=[];d<i.length;d++)a=i[d],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&l.push(o[a][0]),o[a]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);f&&f(t);while(l.length)l.shift()();return c.push.apply(c,s||[]),n()}function n(){for(var e,t=0;t<c.length;t++){for(var n=c[t],r=!0,a=1;a<n.length;a++){var i=n[a];0!==o[i]&&(r=!1)}r&&(c.splice(t--,1),e=u(u.s=n[0]))}return e}var r={},a={"app~06837ae4":0},o={"app~06837ae4":0},c=[];function i(e){return u.p+"js/"+({"main~31ecd969":"main~31ecd969","vendors~chat-room~chat-room-list~987e6011":"vendors~chat-room~chat-room-list~987e6011","chat-room-list~21833f8f":"chat-room-list~21833f8f","vendors~chat-room~d939e436":"vendors~chat-room~d939e436","chat-room~21833f8f":"chat-room~21833f8f"}[e]||e)+"."+{"main~31ecd969":"42aaeb72","vendors~chat-room~chat-room-list~987e6011":"739b3dc6","chat-room-list~21833f8f":"f3a7683c","vendors~chat-room~d939e436":"7abcce4d","chat-room~21833f8f":"4679503e"}[e]+".js"}function u(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,u),n.l=!0,n.exports}u.e=function(e){var t=[],n={"main~31ecd969":1,"chat-room-list~21833f8f":1,"chat-room~21833f8f":1};a[e]?t.push(a[e]):0!==a[e]&&n[e]&&t.push(a[e]=new Promise((function(t,n){for(var r="css/"+({"main~31ecd969":"main~31ecd969","vendors~chat-room~chat-room-list~987e6011":"vendors~chat-room~chat-room-list~987e6011","chat-room-list~21833f8f":"chat-room-list~21833f8f","vendors~chat-room~d939e436":"vendors~chat-room~d939e436","chat-room~21833f8f":"chat-room~21833f8f"}[e]||e)+"."+{"main~31ecd969":"15b94d15","vendors~chat-room~chat-room-list~987e6011":"31d6cfe0","chat-room-list~21833f8f":"52a8c9d7","vendors~chat-room~d939e436":"31d6cfe0","chat-room~21833f8f":"6b0ced50"}[e]+".css",o=u.p+r,c=document.getElementsByTagName("link"),i=0;i<c.length;i++){var s=c[i],d=s.getAttribute("data-href")||s.getAttribute("href");if("stylesheet"===s.rel&&(d===r||d===o))return t()}var l=document.getElementsByTagName("style");for(i=0;i<l.length;i++){s=l[i],d=s.getAttribute("data-href");if(d===r||d===o)return t()}var f=document.createElement("link");f.rel="stylesheet",f.type="text/css",f.onload=t,f.onerror=function(t){var r=t&&t.target&&t.target.src||o,c=new Error("Loading CSS chunk "+e+" failed.\n("+r+")");c.code="CSS_CHUNK_LOAD_FAILED",c.request=r,delete a[e],f.parentNode.removeChild(f),n(c)},f.href=o;var p=document.getElementsByTagName("head")[0];p.appendChild(f)})).then((function(){a[e]=0})));var r=o[e];if(0!==r)if(r)t.push(r[2]);else{var c=new Promise((function(t,n){r=o[e]=[t,n]}));t.push(r[2]=c);var s,d=document.createElement("script");d.charset="utf-8",d.timeout=120,u.nc&&d.setAttribute("nonce",u.nc),d.src=i(e);var l=new Error;s=function(t){d.onerror=d.onload=null,clearTimeout(f);var n=o[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;l.message="Loading chunk "+e+" failed.\n("+r+": "+a+")",l.name="ChunkLoadError",l.type=r,l.request=a,n[1](l)}o[e]=void 0}};var f=setTimeout((function(){s({type:"timeout",target:d})}),12e4);d.onerror=d.onload=s,document.head.appendChild(d)}return Promise.all(t)},u.m=e,u.c=r,u.d=function(e,t,n){u.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},u.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.t=function(e,t){if(1&t&&(e=u(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(u.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)u.d(n,r,function(t){return e[t]}.bind(null,r));return n},u.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return u.d(t,"a",t),t},u.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},u.p="/vue-firebase-chat/",u.oe=function(e){throw e};var s=window["webpackJsonp"]=window["webpackJsonp"]||[],d=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var f=d;c.push([0,"app~c5b24172","app~8a6c828a","app~7ffa8a2f","app~8b322766","app~1fb195ae","app~c1554789","app~d939e436","app~b58f7129","app~1c3a2c3f","app~d2305125"]),n()})({"0613":function(e,t,n){"use strict";n.d(t,"a",(function(){return ce}));var r,a,o,c=n("2b0e"),i=n("2f62"),u=n("ade3"),s=(n("4160"),n("159b"),n("96cf"),n("1da1")),d="session.setProfile",l="session.setConnected",f="session.setSignedIn",p="session.clear",m=n("5089"),h=n("4037"),b=n("7bd1"),v=n("5651"),O={state:function(){return{user:null,isConnecting:!1,isSignedIn:!1,unsubscribes:[]}},getters:(r={},Object(u["a"])(r,m["b"],(function(e){return e.isConnecting})),Object(u["a"])(r,m["c"],(function(e){return e.isSignedIn})),Object(u["a"])(r,m["d"],(function(e,t){return t[m["b"]]&&t[m["c"]]})),Object(u["a"])(r,m["a"],(function(e){return e.user})),r),mutations:(a={},Object(u["a"])(a,d,(function(e,t){e.user=t})),Object(u["a"])(a,l,(function(e,t){e.isConnecting=t})),Object(u["a"])(a,f,(function(e,t){e.isSignedIn=t})),Object(u["a"])(a,p,(function(e){e.unsubscribes.forEach((function(e){return e()})),e.user=null,e.isConnecting=!1,e.isSignedIn=!1,e.unsubscribes=[]})),a),actions:(o={},Object(u["a"])(o,h["a"],(function(e){return Object(s["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(b["c"])();case 2:if(n=t.sent,!n){t.next=8;break}return t.next=6,g(e);case 6:t.next=9;break;case 8:throw new Error("Unauthorized");case 9:return t.abrupt("return",n);case 10:case"end":return t.stop()}}),t)})))()})),Object(u["a"])(o,h["b"],(function(e,t){return Object(s["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,Object(b["g"])(t);case 2:return n.next=4,g(e);case 4:case"end":return n.stop()}}),n)})))()})),Object(u["a"])(o,h["c"],(function(e){return Object(s["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.commit,t.next=3,Object(b["h"])();case 3:n(p);case 4:case"end":return t.stop()}}),t)})))()})),o)};function g(e){var t=function(t){t&&e.commit(d,t),e.commit(f,null!=t)},n=function(t){e.getters[m["b"]]&&!t&&v["a"].$emit(b["a"].DISCONNECTED),e.commit(l,t)},r=function(e){v["a"].$emit(b["a"].INVITATION_RECEIVED,e)};e.commit(p),e.state.unsubscribes.push(Object(b["m"])(r),Object(b["i"])(t),Object(b["l"])(n))}n("c740"),n("d81d"),n("13d5"),n("a434"),n("b0c0"),n("d3b7"),n("3ca3"),n("ddb0");var j,y,I,E=n("2909"),_=n("c50a"),T="chat.setRooms",k="chat.setPeople",w="chat.setRoom",R="chat.clear",A="chat.addMessage",S="chat.addUser",C="chat.removeUser",D="chat.imageUploaded",N=n("26b2"),x=n("a47c"),M=b["b"].ContentType,P="RoomsKey",L="RoomKey",V={id:"",order:-1,name:"",countPeople:0},U={state:function(){return{rooms:[],people:[],messages:[],room:V,unsubscribes:{},imageMessageIndices:{}}},getters:(j={},Object(u["a"])(j,N["c"],(function(e){return e.rooms})),Object(u["a"])(j,N["d"],(function(e){return e.room})),Object(u["a"])(j,N["a"],(function(e){return e.messages})),Object(u["a"])(j,N["b"],(function(e){return e.people})),j),mutations:(y={},Object(u["a"])(y,T,(function(e,t){e.rooms=t})),Object(u["a"])(y,k,(function(e,t){e.people=t})),Object(u["a"])(y,w,(function(e,t){e.room=t})),Object(u["a"])(y,A,(function(e,t){t.contentType===b["b"].ContentType.Image&&(e.imageMessageIndices[t.id]=e.messages.length),e.messages.push(t)})),Object(u["a"])(y,S,(function(e,t){e.people.push(t)})),Object(u["a"])(y,C,(function(e,t){var n=e.people.findIndex((function(e){var n=e.id;return n===t.id}));e.people.splice(n,1)})),Object(u["a"])(y,D,(function(e,t){var n=e.imageMessageIndices[t.id];c["default"].set(e.messages,n,t),c["default"].delete(e.imageMessageIndices,t.id)})),Object(u["a"])(y,R,(function(e){e.messages=[],e.rooms=[],e.people=[],e.room=V})),y),actions:(I={},Object(u["a"])(I,x["b"],(function(e){return $(e)})),Object(u["a"])(I,x["d"],(function(e){return F(e,[P])})),Object(u["a"])(I,x["c"],(function(e,t){return e.commit(R),B(e,t)})),Object(u["a"])(I,x["e"],(function(e){return F(e,[L])})),Object(u["a"])(I,x["a"],(function(e,t){return Object(b["d"])(e.state.room.id,t)})),Object(u["a"])(I,x["f"],(function(e,t){var n=e.getters,r=n[N["d"]];return Object(b["f"])({room:{id:r.id,name:r.name},invitee:t})})),I)};function $(e){return G.apply(this,arguments)}function G(){return G=Object(s["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=Object(b["k"])((function(e){t.commit(T,e.reduce((function(e,t){return e[t.order]=t,e}),Object(E["a"])(t.state.rooms)))})),t.state.unsubscribes[P]=n,e.abrupt("return",n);case 3:case"end":return e.stop()}}),e)}))),G.apply(this,arguments)}function B(e,t){return q.apply(this,arguments)}function q(){return q=Object(s["a"])(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=function(e){return{id:Object(_["a"])(),type:b["b"].Type.System,contentType:M.Text,content:e,sender:{id:"",name:""},createdAt:Date.now()}},a=Object(b["j"])(n,(function(e,n){switch(e){case b["a"].ROOM_UPDATED:t.commit(w,n);break;case b["a"].USER_JOINED:t.commit(A,r("".concat(n.name,"님이 입장했습니다."))),t.commit(S,n);break;case b["a"].USER_LEAVE:t.commit(A,r("".concat(n.name,"님이 퇴장했습니다."))),t.commit(C,n);break;case b["a"].NEW_MESSAGE:t.commit(A,n);break;case b["a"].IMAGE_UPLOADED:t.commit(D,n);break;case b["a"].USER_LIST_LOADED:t.commit(k,n);break}})),t.state.unsubscribes[L]=a,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)}))),q.apply(this,arguments)}function F(e,t){return J.apply(this,arguments)}function J(){return J=Object(s["a"])(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(n.map((function(e){var n=t.state.unsubscribes[e];if(null!=n)return c["default"].delete(t.state.unsubscribes,e),n.then((function(e){return e()}))})));case 2:case"end":return e.stop()}}),e)}))),J.apply(this,arguments)}n("4de4");var W,z,K=n("c592"),H=n("4f76"),X=n("30e6"),Y={state:function(){var e;return e={},Object(u["a"])(e,H["a"].MESSAGE,{current:null,queue:[]}),Object(u["a"])(e,H["a"].INVITATION,{current:null,queue:[]}),Object(u["a"])(e,H["a"].CONFIRM_INVITATION,{current:null,queue:[]}),e},getters:(W={},Object(u["a"])(W,X["c"],(function(e){return e[H["a"].MESSAGE].current})),Object(u["a"])(W,X["b"],(function(e){return e[H["a"].INVITATION].current})),Object(u["a"])(W,X["a"],(function(e){return e[H["a"].CONFIRM_INVITATION].current})),W),actions:(z={},Object(u["a"])(z,K["a"],(function(e){var t=e.state;ne(t[H["a"].MESSAGE]),ne(t[H["a"].INVITATION]),ne(t[H["a"].CONFIRM_INVITATION])})),Object(u["a"])(z,K["c"],(function(e,t){var n=t.dialogType,r=t.params;switch(n){case H["a"].MESSAGE:te(e,r);break;case H["a"].INVITATION:Z(e,r);break;case H["a"].CONFIRM_INVITATION:ee(e,r);break}})),Object(u["a"])(z,K["b"],(function(e,t){e.state[t].current=null,setTimeout((function(){e.state[t].current=e.state[t].queue.pop()||null}),100)})),z)};function Q(e,t){var n=e.state,r=(e.dispatch,t.dialogType),a=t.params;null!=n[r].current?n[r].queue.unshift(a):n[r].current=a}function Z(e,t){var n=e.getters[m["a"]],r=e.getters[N["d"]];Q(e,{dialogType:H["a"].INVITATION,params:{usersPromise:Object(b["e"])().then((function(e){return e.filter((function(e){return n.uid!==e.id&&e.currentRoomId!==r.id}))})),handleOk:t.handleOk}})}function ee(e,t){Q(e,{dialogType:H["a"].CONFIRM_INVITATION,params:t})}function te(e,t){Q(e,{dialogType:H["a"].MESSAGE,params:t})}function ne(e){e.queue=[],e.current=null}var re=n("a665"),ae=n("70be"),oe={modules:{session:O,chat:U,dialog:Y},state:function(){return{isBusy:!0}},getters:Object(u["a"])({},re["a"],(function(e){return e.isBusy})),mutations:Object(u["a"])({},ae["a"],(function(e,t){e.isBusy=t}))};c["default"].use(i["a"]);var ce=new i["a"].Store(oe)},1887:function(e,t,n){},"26b2":function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"d",(function(){return a})),n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return c}));var r="chat.getRooms",a="chat.getRoom",o="chat.getMessages",c="chat.getPeople"},"30e6":function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return o}));var r="dialog.getCurrentMessageDialog",a="dialog.getCurrentInvitationDialog",o="dialog.getCurrentConfirmInvitationDialog"},4037:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return o}));var r="session.signIn",a="session.signOut",o="root.checkUserSession"},"4f76":function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e["MESSAGE"]="message",e["INVITATION"]="invitation",e["CONFIRM_INVITATION"]="confirm"}(r||(r={}))},5089:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return o})),n.d(t,"a",(function(){return c}));var r="session.isConnecting",a="session.isSignedIn",o="session.isValid",c="session.getProfile"},5651:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n("60a3"),a=new r["d"]({methods:{on:function(e,t,n){var r=this;this.$on(t,n),e.$on("hook:destroyed",(function(){return r.$off(t,n)}))}}})},"59e4":function(e,t,n){},"5e44":function(e,t,n){"use strict";var r;(function(e){e["Main"]="Main",e["ChatRoomList"]="ChatRoomList",e["ChatRoom"]="ChatRoom"})(r||(r={})),t["a"]=r},"70be":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r="root.setBusy"},7548:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));n("99af"),n("96cf");var r=n("1da1"),a=n("2fe1"),o=n("0613"),c=n("70be"),i=Object(a["a"])((function(e,t){var n,a,i=(null===(n=e.methods)||void 0===n?void 0:n[t])||e[t],u=(null===(a=e.methods)||void 0===a?void 0:a[t])?e.methods:e;if(!i)throw new Error("".concat(t," is ").concat(i,"."));u[t]=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,n,r,a=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(o["a"].commit(c["a"],!0),e.prev=1,t=a.length,n=new Array(t),r=0;r<t;r++)n[r]=a[r];return e.next=5,i.apply(this,n);case 5:return e.abrupt("return",e.sent);case 6:return e.prev=6,o["a"].commit(c["a"],!1),e.finish(6);case 9:case"end":return e.stop()}}),e,this,[[1,,6,9]])})))}));function u(e,t){i(e,t)}},"7bd1":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return u})),n.d(t,"c",(function(){return b})),n.d(t,"g",(function(){return v})),n.d(t,"h",(function(){return g})),n.d(t,"d",(function(){return j})),n.d(t,"l",(function(){return S})),n.d(t,"i",(function(){return T})),n.d(t,"m",(function(){return k})),n.d(t,"j",(function(){return R})),n.d(t,"k",(function(){return w})),n.d(t,"e",(function(){return I})),n.d(t,"f",(function(){return _}));n("4160"),n("a15b"),n("d81d"),n("b0c0"),n("d3b7"),n("3ca3"),n("159b"),n("ddb0"),n("bf19");var r,a=n("5530"),o=(n("96cf"),n("1da1")),c=n("59ca"),i=n.n(c);n("ea7b"),n("66ce"),n("588e"),n("000b");(function(e){(function(e){e["User"]="USER",e["System"]="SYSTEM"})(e.Type||(e.Type={})),function(e){e["Text"]="TEXT",e["Image"]="IMAGE"}(e.ContentType||(e.ContentType={}))})(r||(r={}));var u,s=n("5986"),d=r.ContentType,l=i.a.database.ServerValue,f=i.a.initializeApp(s),p=f.auth(),m=f.database(),h=f.storage();function b(){return new Promise((function(e,t){var n=p.onAuthStateChanged(Object(o["a"])(regeneratorRuntime.mark((function r(){var a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n(),r.prev=1,r.next=4,U().once("value");case 4:a=r.sent,e(a.val()),r.next=11;break;case 8:r.prev=8,r.t0=r["catch"](1),t(r.t0);case 11:case"end":return r.stop()}}),r,null,[[1,8]])}))))}))}function v(e){return O.apply(this,arguments)}function O(){return O=Object(o["a"])(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,p.signInAnonymously();case 2:return n=C(),e.next=5,V().orderByChild("name").equalTo(t).once("value");case 5:if(r=e.sent,a=!1,r.forEach((function(e){if(e.val().online)return a=!0,!0})),!a){e.next=11;break}throw p.signOut(),new Error("사용중인 이름입니다.");case 11:return e.next=13,Promise.all([U().update({name:t}),n.updateProfile({displayName:t})]);case 13:return e.abrupt("return",n);case 14:case"end":return e.stop()}}),e)}))),O.apply(this,arguments)}function g(){return U().remove(),p.signOut()}function j(e,t){var n=C(),c=Object(a["a"])(Object(a["a"])({},t),{},{sender:{id:n.uid,name:n.displayName},createdAt:l.TIMESTAMP});if(t.contentType===r.ContentType.Image){var i=t.content;return c.content=null,i.map(function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(r){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",M(e).child("messages").push(c).then((function(t){var a=[e,t.key,(new Date).toISOString(),n.uid,r.name].join("/");y(a,r).then((function(e){return t.update({content:e})}))})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}return M(e).child("messages").push(c)}function y(e,t){return h.ref(e).put(t).then((function(e){return e.ref.getDownloadURL()}))}function I(){return E.apply(this,arguments)}function E(){return E=Object(o["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,V().orderByChild("online").equalTo(!0).once("value");case 2:return t=e.sent,n=[],t.forEach((function(e){var t=e.val();n.push({id:e.key,name:t.name,currentRoomId:t.currentRoomId})})),e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)}))),E.apply(this,arguments)}function _(e){var t=e.room,n=e.invitee,r=C(),a=r.uid,o=r.displayName;return $().child(n).push({room:t,inviter:{id:a,name:o},createdAt:l.TIMESTAMP})}function T(e){return p.onAuthStateChanged((function(t){var n=(null===t||void 0===t?void 0:t.toJSON())||null;e(n)}))}function k(e){var t=C(),n=t.uid,r=$().child(n).orderByChild("createdAt").startAt(Date.now());return r.on("child_added",(function(t){return e(Object(a["a"])(Object(a["a"])({},t.val()),{},{id:t.key}))})),function(){return r.off()}}function w(e){return new Promise((function(t){var n=D().orderByChild("order");n.on("value",(function(r){var o=[];r.forEach((function(e){var t=e.val();o.push(Object(a["a"])(Object(a["a"])({},t),{},{countPeople:t.countPeople||0,id:e.key}))})),e(o),t((function(){return n.off()}))}))}))}function R(e,t){return A.apply(this,arguments)}function A(){return A=Object(o["a"])(regeneratorRuntime.mark((function e(t,n){var r,c,i,s,f,p,m,h,b,v,O;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=C(),c=r.uid,i=P(t),e.next=4,i.once("value");case 4:return s=e.sent,e.next=7,G(t);case 7:return f=e.sent,p=N(t),m=i.orderByChild("joinedAt").startAt(f.joinedAt),h=L(t).orderByChild("createdAt").startAt(f.joinedAt),b=m.ref.child(c).onDisconnect(),v=p.onDisconnect(),e.next=15,Promise.all([b.remove(),v.update({countPeople:l.increment(-1)})]);case 15:return O=[],s.forEach((function(e){O.push(Object(a["a"])(Object(a["a"])({},e.val()),{},{id:e.key}))})),n(u.USER_LIST_LOADED,O),p.on("value",(function(e){var t=e.val();n(u.ROOM_UPDATED,Object(a["a"])(Object(a["a"])({},t),{},{id:e.key}))})),m.on("child_added",(function(e){var t=e.val();n(u.USER_JOINED,t)})),m.on("child_removed",(function(e){var t=e.val();n(u.USER_LEAVE,t)})),h.on("child_added",(function(e){var t=e.val(),r=Object(a["a"])(Object(a["a"])({},t),{},{id:e.key});n(u.NEW_MESSAGE,r)})),h.on("child_changed",(function(e){var t=e.val();t.contentType===d.Image&&t.content&&n(u.IMAGE_UPLOADED,Object(a["a"])(Object(a["a"])({},t),{},{id:e.key}))})),e.abrupt("return",Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return p.off(),m.off(),h.off(),e.next=5,q(t);case 5:return e.next=7,Promise.all([v.cancel(),b.cancel()]);case 7:case"end":return e.stop()}}),e)}))));case 24:case"end":return e.stop()}}),e)}))),A.apply(this,arguments)}function S(e){var t=C(),n=t.uid,r=m.ref("/sessions/".concat(n)),a=m.ref(".info/connected"),o=Promise.resolve();return a.on("value",(function(t){o=o.then((function(){if(!1!==t.val())return r.onDisconnect().update({online:!1,lastChanged:l.TIMESTAMP}).then((function(){r.update({online:!0,lastChanged:l.TIMESTAMP}),e(!0)}));e(!1)}))})),function(){return a.off()}}function C(){var e=p.currentUser;if(null==e)throw new Error("Unauthorized");return e}function D(){return m.ref("chatRoomStates")}function N(e){return D().child(e)}function x(){return m.ref("chatRooms")}function M(e){return x().child(e)}function P(e){return M(e).child("users")}function L(e){return M(e).child("messages")}function V(){return m.ref("sessions")}function U(){return V().child(C().uid)}function $(){return m.ref("invitations")}function G(e){return B.apply(this,arguments)}function B(){return B=Object(o["a"])(regeneratorRuntime.mark((function e(t){var n,r,a,o,c,i,u,s,d;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=C(),r=n.uid,a=n.displayName,o=P(t),c=o.child(r),i=N(t),u=U(),e.prev=5,e.next=8,c.set({id:r,name:a,joinedAt:l.TIMESTAMP});case 8:return e.next=10,o.once("value");case 10:return s=e.sent,e.next=13,i.update({countPeople:s.numChildren()});case 13:return e.next=15,u.update({currentRoomId:t});case 15:return e.next=17,c.once("value");case 17:return d=e.sent,e.abrupt("return",d.val());case 21:throw e.prev=21,e.t0=e["catch"](5),u.update({currentRoomId:null}),c.remove(),e.t0;case 26:case"end":return e.stop()}}),e,null,[[5,21]])}))),B.apply(this,arguments)}function q(e){return F.apply(this,arguments)}function F(){return F=Object(o["a"])(regeneratorRuntime.mark((function e(t){var n,r,a,o,c,i,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=C(),r=n.uid,a=N(t),o=P(t),c=o.child(r),i=U(),e.prev=5,e.next=8,c.remove();case 8:return e.next=10,o.once("value");case 10:return u=e.sent,e.next=13,a.update({countPeople:u.numChildren()});case 13:return e.next=15,i.update({currentRoomId:null});case 15:e.next=21;break;case 17:e.prev=17,e.t0=e["catch"](5),i.update({currentRoomId:null}),c.remove();case 21:case"end":return e.stop()}}),e,null,[[5,17]])}))),F.apply(this,arguments)}(function(e){e["ROOM_UPDATED"]="ROOM_UPDATED",e["USER_LIST_LOADED"]="USER_LIST_LOADED",e["USER_JOINED"]="USER_JOINED",e["USER_LEAVE"]="USER_LEAVE",e["NEW_MESSAGE"]="NEW_MESSAGE",e["IMAGE_UPLOADED"]="IMAGE_UPLOADED",e["DISCONNECTED"]="DISCONNECTED",e["INVITATION_RECEIVED"]="INVITATION_RECEIVED"})(u||(u={}))},"831f":function(e,t,n){},8594:function(e,t,n){},"96e4":function(e,t,n){},a47c:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"d",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"e",(function(){return c})),n.d(t,"a",(function(){return i})),n.d(t,"f",(function(){return u}));var r="chat.enterLobby",a="chat.leaveLobby",o="chat.enterRoom",c="chat.leaveRoom",i="chat.dispatchMessage",u="chat.sendInvitation"},a665:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r="root.isBusy"},b446:function(e,t,n){"use strict";var r=n("2638"),a=n.n(r),o=n("d4ec"),c=n("bee2"),i=n("262e"),u=n("2caf"),s=n("9ab4"),d=n("48d3"),l=n("60a3"),f=(n("96e4"),function(e){Object(i["a"])(n,e);var t=Object(u["a"])(n);function n(){return Object(o["a"])(this,n),t.apply(this,arguments)}return Object(c["a"])(n,[{key:"render",value:function(){var e=arguments[0];return e("button",a()([{staticClass:"button",class:this.styleVariant,attrs:{type:this.buttonType}},{on:this.$listeners}]),[this.$slots.default])}},{key:"buttonType",get:function(){return this.$attrs.type||"button"}},{key:"styleVariant",get:function(){return this.variant?"button_".concat(this.variant):""}}]),n}(d["Component"]));Object(s["__decorate"])([Object(l["b"])(String)],f.prototype,"variant",void 0),f=Object(s["__decorate"])([l["a"]],f),t["a"]=f},baef:function(e,t,n){},c592:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return o}));var r="dialog.nextDialog",a="dialog.requestDialog",o="dialog.clearDialogs"},cd49:function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),a=n("60a3"),o=n("5530"),c=n("d4ec"),i=n("bee2"),u=n("262e"),s=n("2caf"),d=n("9ab4"),l=n("4bb5"),f=(n("8594"),n("a665")),p=(n("baef"),function(e){Object(u["a"])(n,e);var t=Object(s["a"])(n);function n(){return Object(c["a"])(this,n),t.apply(this,arguments)}return Object(i["a"])(n,[{key:"render",value:function(){var e=arguments[0];return e("div",{class:"spinner"})}}]),n}(a["d"]));p=Object(d["__decorate"])([a["a"]],p);var m=p;n("59e4"),n("99af"),n("d81d");var h=n("48d3"),b=(n("1887"),n("b446")),v=function(e){Object(u["a"])(n,e);var t=Object(s["a"])(n);function n(){return Object(c["a"])(this,n),t.apply(this,arguments)}return Object(i["a"])(n,[{key:"render",value:function(){var e=this,t=arguments[0];return t("div",{class:"dialog-background"},[t("div",{class:"dialog-window"},[t("div",{class:"dialog-body"},[this.$slots.default]),t("div",{class:"dialog-footer"},[this.closeLabel&&t(b["a"],{attrs:{variant:"light"},class:"dialog-footer__close-button",on:{click:function(){return e.$emit("close")}}},[this.closeLabel]),t(b["a"],{attrs:{variant:"yellow"},on:{click:function(){return e.$emit("ok")}}},[this.okLabel])])])])}}]),n}(h["Component"]);Object(d["__decorate"])([Object(a["b"])({type:String,default:"확인"})],v.prototype,"okLabel",void 0),Object(d["__decorate"])([Object(a["b"])({type:String,default:"닫기"})],v.prototype,"closeLabel",void 0),v=Object(d["__decorate"])([a["a"]],v);var O=v;var g=function(e){Object(u["a"])(n,e);var t=Object(s["a"])(n);function n(){return Object(c["a"])(this,n),t.apply(this,arguments)}return Object(i["a"])(n,[{key:"render",value:function(){var e=this,t=arguments[0];return t(O,{attrs:{okLabel:this.params.okText,closeLabel:this.params.closeText},on:{ok:function(){return e.$emit("ok")},close:function(){return e.$emit("close")}}},[t("div",{class:"dialog-content"},[this.message])])}},{key:"message",get:function(){var e=this.$createElement;return[].concat(this.params.message).map((function(t,n){return e("div",{key:n,class:"dialog-content-message"},[t])}))}}]),n}(h["Component"]);Object(d["__decorate"])([Object(a["b"])(Object)],g.prototype,"params",void 0),g=Object(d["__decorate"])([a["a"]],g);var j=g;var y=n("4f76"),I=n("30e6"),E=(n("4de4"),n("b0c0"),n("2638")),_=n.n(E),T=(n("96cf"),n("1da1")),k=(n("831f"),n("7548")),w=function(e){Object(u["a"])(n,e);var t=Object(s["a"])(n);function n(){var e;return Object(c["a"])(this,n),e=t.apply(this,arguments),e.users=null,e.guest="",e}return Object(i["a"])(n,[{key:"onOk",value:function(){var e=Object(T["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.guest&&this.$emit("ok",this.guest);case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"created",value:function(){var e=Object(T["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.params.usersPromise;case 2:t=e.sent,this.users=t||[],this.users.length&&(this.guest=this.users[0].id);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"render",value:function(){var e,t=this,n=arguments[0];return n(O,{attrs:{okLabel:"초대"},on:{ok:this.onOk,close:function(){return t.$emit("close")}}},[n("div",{class:"dialog-content"},[n("label",{class:"dialog-select-user-label",attrs:{for:"user"}},["초대할 사람을 선택하세요."]),n("select",_()([{on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));t.guest=e.target.multiple?n:n[0]}},attrs:{id:"user"},domProps:{value:this.guest},class:"dialog-select-user"},{directives:[{name:"model",value:t.guest,modifiers:{}}]}]),[(null===(e=this.users)||void 0===e?void 0:e.length)&&this.users.map((function(e){return n("option",{key:e.id,domProps:{value:e.id},attrs:{"data-test":"option"}},[e.name])})),this.users&&!this.users.length&&n("option",{attrs:{disabled:!0,value:""}},["초대할 사람이 없습니다."])])])])}}]),n}(h["Component"]);Object(d["__decorate"])([Object(a["b"])(Object)],w.prototype,"params",void 0),Object(d["__decorate"])([k["a"]],w.prototype,"onOk",null),Object(d["__decorate"])([k["a"]],w.prototype,"created",null),w=Object(d["__decorate"])([Object(a["a"])({components:{VModal:O}})],w);var R=w;var A=n("c592"),S=function(e){Object(u["a"])(n,e);var t=Object(s["a"])(n);function n(){return Object(c["a"])(this,n),t.apply(this,arguments)}return Object(i["a"])(n,[{key:"render",value:function(){var e=this,t=arguments[0];return t(O,{attrs:{okLabel:"수락"},on:{ok:function(){return e.$emit("ok",e.params.room.id)},close:function(){return e.$emit("close")}}},[t("div",{class:"dialog-content"},[t("div",{class:"dialog-content-message"},[t("strong",[this.params.inviter.name])," 님이,"]),t("div",{class:"dialog-content-message"},[t("strong",[this.params.room.name])," 방으로 초대했습니다."])])])}}]),n}(h["Component"]);Object(d["__decorate"])([Object(a["b"])(Object)],S.prototype,"params",void 0),S=Object(d["__decorate"])([a["a"]],S);var C=S;var D=function(e){Object(u["a"])(n,e);var t=Object(s["a"])(n);function n(){return Object(c["a"])(this,n),t.apply(this,arguments)}return Object(i["a"])(n,[{key:"handleOk",value:function(e,t,n){var r;null===(r=t.handleOk)||void 0===r||r.call(t,n),this.nextDialog(e)}},{key:"handleClose",value:function(e,t){var n;null===(n=t.handleClose)||void 0===n||n.call(t),this.nextDialog(e)}},{key:"render",value:function(){var e=this,t=arguments[0];return t("div",{class:"dialog-container"},[this.currentInvitationDialog&&t(R,{attrs:{params:this.currentInvitationDialog},on:{ok:function(t){return e.handleOk(y["a"].INVITATION,e.currentInvitationDialog,t)},close:function(){return e.handleClose(y["a"].INVITATION,e.currentInvitationDialog)}}}),this.currentConfirmInvitationDialog&&t(C,{attrs:{params:this.currentConfirmInvitationDialog},on:{ok:function(t){return e.handleOk(y["a"].CONFIRM_INVITATION,e.currentConfirmInvitationDialog,t)},close:function(){return e.handleClose(y["a"].CONFIRM_INVITATION,e.currentConfirmInvitationDialog)}}}),this.currentMessageDialog&&t(j,{attrs:{params:this.currentMessageDialog},on:{ok:function(){return e.handleOk(y["a"].MESSAGE,e.currentMessageDialog)},close:function(){return e.handleClose(y["a"].MESSAGE,e.currentMessageDialog)}}})])}}]),n}(a["d"]);Object(d["__decorate"])([Object(l["b"])(I["c"])],D.prototype,"currentMessageDialog",void 0),Object(d["__decorate"])([Object(l["b"])(I["b"])],D.prototype,"currentInvitationDialog",void 0),Object(d["__decorate"])([Object(l["b"])(I["a"])],D.prototype,"currentConfirmInvitationDialog",void 0),Object(d["__decorate"])([Object(l["a"])(A["b"])],D.prototype,"nextDialog",void 0),D=Object(d["__decorate"])([a["a"]],D);var N=D;var x=n("5651"),M=n("7bd1"),P=n("5e44"),L=function(e){Object(u["a"])(n,e);var t=Object(s["a"])(n);function n(){return Object(c["a"])(this,n),t.apply(this,arguments)}return Object(i["a"])(n,[{key:"created",value:function(){var e=this;x["a"].on(this,M["a"].DISCONNECTED,(function(){e.clearDialogs(),e.requestDialog({dialogType:y["a"].MESSAGE,params:{message:"서버와 연결이 끊겼습니다.",closeText:""}})})),x["a"].on(this,M["a"].INVITATION_RECEIVED,(function(t){e.requestDialog({dialogType:y["a"].CONFIRM_INVITATION,params:Object(o["a"])(Object(o["a"])({},t),{},{handleOk:function(){e.$router.push({name:P["a"].ChatRoom,params:{roomId:t.room.id}})}})})}))}},{key:"render",value:function(){var e=arguments[0];return e("div",{attrs:{id:"app"}},[e("router-view"),e(N),e("div",{class:"global-spinner",directives:[{name:"show",value:this.isBusy}]},[e(m)])])}}]),n}(a["d"]);Object(d["__decorate"])([Object(l["b"])(f["a"])],L.prototype,"isBusy",void 0),Object(d["__decorate"])([Object(l["a"])(A["c"])],L.prototype,"requestDialog",void 0),Object(d["__decorate"])([Object(l["a"])(A["a"])],L.prototype,"clearDialogs",void 0),L=Object(d["__decorate"])([a["a"]],L);var V=L;var U=n("8c4f"),$=(n("d3b7"),{path:"/",name:P["a"].Main,component:function(){return n.e("main~31ecd969").then(n.bind(null,"73eb"))}}),G=$,B={path:"/rooms/:roomId",name:P["a"].ChatRoom,component:function(){return Promise.all([n.e("vendors~chat-room~chat-room-list~987e6011"),n.e("vendors~chat-room~d939e436"),n.e("chat-room~21833f8f")]).then(n.bind(null,"f3f9"))}},q=B,F={path:"/rooms",name:P["a"].ChatRoomList,component:function(){return Promise.all([n.e("vendors~chat-room~chat-room-list~987e6011"),n.e("chat-room-list~21833f8f")]).then(n.bind(null,"66ef"))}},J=F,W=[G,J,q,{path:"*",redirect:{name:P["a"].Main}}],z={mode:"history",base:"/vue-firebase-chat/",routes:W},K=z,H=n("0613"),X=n("5089");r["default"].use(U["a"]);var Y=new U["a"](K);function Q(e,t,n){return Z.apply(this,arguments)}function Z(){return Z=Object(T["a"])(regeneratorRuntime.mark((function e(t,n,r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.name===P["a"].Main||H["a"].getters[X["c"]]?r():r({name:P["a"].Main});case 1:case"end":return e.stop()}}),e)}))),Z.apply(this,arguments)}Y.beforeEach(Q),r["default"].config.productionTip=!1,a["a"].registerHooks(["beforeRouteEnter","beforeRouteUpdate","beforeRouteLeave"]),Y.onError((function(e){})),new r["default"]({router:Y,store:H["a"],render:function(e){return e(V)}}).$mount("#app")}});
//# sourceMappingURL=app~06837ae4.1d47fdf6.js.map