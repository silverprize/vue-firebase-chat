{"version":3,"sources":["webpack:///./node_modules/@vue/babel-helper-vue-jsx-merge-props/dist/helper.js","webpack:///./node_modules/@firebase/storage/dist/index.esm.js","webpack:///./node_modules/@firebase/util/dist/index.cjs.js"],"names":["_extends","Object","assign","a","b","c","arguments","length","d","prototype","hasOwnProperty","call","apply","this","normalMerge","toArrayMerge","functionalMerge","mergeJsxProps","reduce","indexOf","Array","e","concat","f","g","h","i","mergeFn","module","exports","DEFAULT_HOST","CONFIG_STORAGE_BUCKET_KEY","DEFAULT_MAX_OPERATION_RETRY_TIME","DEFAULT_MAX_UPLOAD_RETRY_TIME","MIN_SAFE_INTEGER","FirebaseStorageError","code","message","code_","prependCode","message_","serverResponse_","name_","codeProp","codeEquals","serverResponseProp","setServerResponseProp","serverResponse","defineProperty","get","enumerable","configurable","Code","UNKNOWN","OBJECT_NOT_FOUND","BUCKET_NOT_FOUND","PROJECT_NOT_FOUND","QUOTA_EXCEEDED","UNAUTHENTICATED","UNAUTHORIZED","RETRY_LIMIT_EXCEEDED","INVALID_CHECKSUM","CANCELED","INVALID_EVENT_NAME","INVALID_URL","INVALID_DEFAULT_BUCKET","NO_DEFAULT_BUCKET","CANNOT_SLICE_BLOB","SERVER_FILE_WRONG_SIZE","NO_DOWNLOAD_URL","INVALID_ARGUMENT","INVALID_ARGUMENT_COUNT","APP_DELETED","INVALID_ROOT_OPERATION","INVALID_FORMAT","INTERNAL_ERROR","unknown","objectNotFound","path","quotaExceeded","bucket","unauthenticated","unauthorized","retryLimitExceeded","canceled","invalidUrl","url","invalidDefaultBucket","cannotSliceBlob","serverFileWrongSize","noDownloadURL","invalidArgument","index","fnName","invalidArgumentCount","argMin","argMax","real","countPart","plural","appDeleted","invalidRootOperation","name","invalidFormat","format","internalError","StringFormat","RAW","BASE64","BASE64URL","DATA_URL","formatValidator","stringFormat","StringData","data","contentType","dataFromString","stringData","utf8Bytes_","base64Bytes_","dataURLBytes_","dataURLContentType_","value","charCodeAt","push","valid","hi","lo","Uint8Array","percentEncodedBytes_","decoded","decodeURIComponent","hasMinus","hasUnder","invalidChar","hasPlus","hasSlash","replace","bytes","atob","array","DataURLParts","dataURL","base64","matches","match","middle","endsWith","substring","rest","dataUrl","parts","s","end","longEnough","ErrorCode","TaskEvent","STATE_CHANGED","InternalTaskState","RUNNING","PAUSING","PAUSED","SUCCESS","CANCELING","ERROR","TaskState","taskStateFromInternalTaskState","state","isDef","p","isJustDef","isFunction","isObject","isNonNullObject","isNonArrayObject","isArray","isString","String","isInteger","isNumber","Number","isNativeBlob","isNativeBlobDefined","Blob","NetworkXhrIo","_this","sent_","xhr_","XMLHttpRequest","errorCode_","NO_ERROR","sendPromise_","Promise","resolve","addEventListener","ABORT","NETWORK_ERROR","send","method","body","headers","open","key","setRequestHeader","toString","getErrorCode","getStatus","status","getResponseText","responseText","abort","getResponseHeader","header","addUploadProgressListener","listener","upload","removeUploadProgressListener","removeEventListener","XhrIoPool","createXhrIo","getBlobBuilder","BlobBuilder","WebKitBlobBuilder","getBlob","args","_i","undefined","bb","append","Error","sliceBlob","blob","start","webkitSlice","mozSlice","slice","FbsBlob","elideCopy","size","blobType","data_","type","ArrayBuffer","byteLength","set","size_","type_","startByte","endByte","realBlob","sliced","buffer","blobby","map","val","uint8Arrays","finalLength_1","forEach","merged_1","index_1","uploadData","Location","path_","fullServerUrl","encode","encodeURIComponent","bucketOnlyServerUrl","makeFromBucketSpec","bucketString","bucketLocation","makeFromUrl","location","bucketDomain","gsModify","loc","charAt","gsPath","gsRegex","RegExp","gsIndices","httpModify","version","firebaseStorageHost","firebaseStoragePath","firebaseStorageRegExp","firebaseStorageIndices","cloudStorageHost","cloudStoragePath","cloudStorageRegExp","cloudStorageIndices","groups","regex","indices","postModify","group","captures","exec","bucketValue","pathValue","jsonObjectOrNull","obj","JSON","parse","parent","lastIndexOf","newPath","child","childPath","canonicalChildPath","split","filter","component","join","lastComponent","makeUrl","urlPart","makeQueryString","params","queryPart","nextPart","noXform_","metadata","Mapping","server","local","writable","xform","mappings_","xformPath","fullPath","getMappings","mappings","mappingsXformPath","_metadata","nameMapping","xformSize","sizeMapping","addRef","authWrapper","generateRef","makeStorageReference","fromResource","resource","len","mapping","fromResourceString","resourceString","downloadUrlFromResourceString","tokens","tokensList","urls","token","base","queryString","alt","toResourceString","stringify","metadataValidator","MAX_RESULTS_KEY","MAX_MAX_RESULTS","PAGE_TOKEN_KEY","PREFIXES_KEY","ITEMS_KEY","fromBackendResponse","listResult","prefixes","items","nextPageToken","_a","pathWithoutTrailingSlash","reference","_b","_c","item","fromResponseString","listOptionsValidator","RequestInfo","handler","timeout","urlParams","errorHandler","progressCallback","successCodes","additionalRetryCodes","handlerCheck","cndn","metadataHandler","xhr","text","listHandler","downloadUrlHandler","sharedErrorHandler","err","newErr","objectErrorHandler","shared","getMetadata","maxOperationRetryTime","requestInfo","list","delimiter","pageToken","maxResults","isRoot","getDownloadUrl","updateMetadata","deleteObject","_xhr","_text","determineContentType_","metadataForUpload_","metadataClone","multipartUpload","genBoundary","str","Math","random","boundary","metadata_","metadataString","preBlobPart","postBlobPart","maxUploadRetryTime","ResumableUploadStatus","current","total","finalized","checkResumeHeader_","allowed","allowedStatus","createResumableUpload","metadataForUpload","getResumableUploadStatus","sizeString","isNaN","resumableUploadChunkSize","continueResumableUpload","chunkSize","status_","bytesLeft","bytesToUpload","min","uploadCommand","uploadStatus","newCurrent","Observer","nextOrObserver","error","complete","asFunctions","next","observer","UploadTaskSnapshot","bytesTransferred","totalBytes","task","ref","validate","specs","passed","minArgs","maxArgs","optional","validLength","validator","ArgSpec","self","and_","v1","v2","stringSpec","stringValidator","chainedValidator","uploadDataSpec","metadataSpec","listOptionSpec","nonNegativeNumberSpec","looseObjectSpec","isLooseObjectValidator","isLooseObject","nullFunctionSpec","async","argsToForward","then","UploadTask","transferred_","needToFetchStatus_","needToFetchMetadata_","observers_","error_","uploadUrl_","request_","chunkMultiplier_","resolve_","reject_","ref_","authWrapper_","location_","blob_","resumable_","shouldDoResumable_","state_","errorHandler_","completeTransitions_","transition_","metadataErrorHandler_","promise_","reject","start_","makeProgressCallback_","sizeBefore","loaded","updateProgress_","createResumable_","fetchStatus_","fetchMetadata_","continueUpload_","oneShotUpload_","resolveToken_","callback","getAuthToken","authToken","createRequest","makeRequest","getPromise","statusRequest","uploadRequest","newStatus","increaseMultiplier_","currentSize","metadataRequest","multipartRequest","transferred","old","notifyObservers_","cancel","wasPaused","externalState","on","completed","typeValidator","nextOrObserverMessage","nextValidator","observerValidator","nextOrObserverValidator","anyDefined","makeBinder","binder","addObserver_","removeObserver_","binderNextOrObserverValidator","binderSpecs","typeOnly","onFulfilled","onRejected","catch","notifyObserver_","splice","finishPromise_","observers","triggered","bind","snapshot","toCall","resume","pause","Reference","newRef","service","put","throwIfRoot_","putString","delete","listAll","accumulator","listAllHelper","opt","nextPage","label","sent","options","op","getDownloadURL","FailRequest","_appDelete","RequestMap","Map","id","addRequest","request","clear","v","AuthWrapper","app","authProvider","maker","requestMaker","pool","bucket_","appId_","deleted_","app_","extractBucket_","appId","authProvider_","storageRefMaker_","requestMaker_","pool_","service_","maxOperationRetryTime_","maxUploadRetryTime_","requestMap_","config","auth","getImmediate","getToken","response","accessToken","deleteApp","setMaxUploadRetryTime","time","setMaxOperationRetryTime","waitSeconds","timeoutId","hitTimeout","cancelState","triggeredCallback","triggerCallback","callWithDelay","millis","setTimeout","success","waitMillis","mustStop","stopped","stop","wasTimeout","clearTimeout","NetworkRequest","errorCallback","pendingXhr_","backoffId_","canceled_","appDelete_","url_","method_","headers_","body_","successCodes_","additionalRetryCodes_","callback_","errorCallback_","progressCallback_","timeout_","doTheRequest","backoffCallback","RequestEndStatus","progressListener","hitServer","isRetryStatusCode_","successCode","wasCanceled","progressEvent","lengthComputable","backoffDone","requestWentThrough","wasSuccessCode","result","appDelete","isFiveHundredCode","extraRetryCodes","isExtraRetryCode","isRequestSpecificRetryCode","addAuthHeader_","addVersionHeader_","SDK_VERSION","addGmpidHeader_","Service","authWrapperBucket","internals_","ServiceInternals","test","refFromURL","STORAGE_TYPE","factory","container","getProvider","registerStorage","instance","namespaceExports","Storage","INTERNAL","registerComponent","setServiceProps","setMultipleInstances","registerVersion","tslib","CONSTANTS","NODE_CLIENT","NODE_ADMIN","assert","assertion","assertionError","stringToByteArray","out","byteArrayToString","pos","c1","fromCharCode","c2","c3","c4","u","byteToCharMap_","charToByteMap_","byteToCharMapWebSafe_","charToByteMapWebSafe_","ENCODED_VALS_BASE","HAS_NATIVE_SUPPORT","encodeByteArray","input","webSafe","init_","byteToCharMap","output","byte1","haveByte2","byte2","haveByte3","byte3","outByte1","outByte2","outByte3","outByte4","encodeString","btoa","decodeString","decodeStringToByteArray","charToByteMap","haveByte4","byte4","ENCODED_VALS","ENCODED_VALS_WEBSAFE","base64Encode","utf8Bytes","base64Decode","deepCopy","deepExtend","target","source","constructor","Date","dateValue","getTime","prop","Deferred","promise","wrapCallback","getUA","navigator","isMobileCordova","window","isNode","global","process","isBrowser","isBrowserExtension","runtime","chrome","browser","isReactNative","isElectron","isIE","ua","isUWP","isNodeSdk","isSafari","userAgent","includes","ERROR_NAME","FirebaseError","_super","setPrototypeOf","captureStackTrace","ErrorFactory","create","__extends","serviceName","errors","customData","fullCode","template","replaceTemplate","fullMessage","keys","PATTERN","_","jsonEval","decode","claims","signature","isValidTimestamp","now","floor","validSince","validUntil","issuedAtTime","isValidFormat","isAdmin","contains","safeGet","isEmpty","fn","contextObj","res","querystring","querystringParams","_loop_1","arrayVal","entries","querystringDecode","Sha1","chain_","buf_","W_","pad_","inbuf_","total_","blockSize","reset","compress_","buf","offset","W","t","k","update","lengthMinusBlock","n","inbuf","digest","totalBits","j","createSubscribe","executor","onNoObservers","proxy","ObserverProxy","subscribe","unsubscribes","observerCount","forEachObserver","close","implementsAnyMethods","noop","unsub","unsubscribeOne","finalError","sendOne","console","onError","methods","methods_1","validateArgCount","minCount","maxCount","argCount","argError","errorPrefix","argumentNumber","argName","validateNamespace","namespace","validateCallback","validateContextObject","context","stringToByteArray$1","high","low","stringLength"],"mappings":"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","file":"js/app~8a6c828a.f2961894.js","sourcesContent":["\"use strict\";function _extends(){return _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_extends.apply(this,arguments)}var normalMerge=[\"attrs\",\"props\",\"domProps\"],toArrayMerge=[\"class\",\"style\",\"directives\"],functionalMerge=[\"on\",\"nativeOn\"],mergeJsxProps=function(a){return a.reduce(function(c,a){for(var b in a)if(!c[b])c[b]=a[b];else if(-1!==normalMerge.indexOf(b))c[b]=_extends({},c[b],a[b]);else if(-1!==toArrayMerge.indexOf(b)){var d=c[b]instanceof Array?c[b]:[c[b]],e=a[b]instanceof Array?a[b]:[a[b]];c[b]=d.concat(e)}else if(-1!==functionalMerge.indexOf(b)){for(var f in a[b])if(c[b][f]){var g=c[b][f]instanceof Array?c[b][f]:[c[b][f]],h=a[b][f]instanceof Array?a[b][f]:[a[b][f]];c[b][f]=g.concat(h)}else c[b][f]=a[b][f];}else if(\"hook\"==b)for(var i in a[b])c[b][i]=c[b][i]?mergeFn(c[b][i],a[b][i]):a[b][i];else c[b]=a[b];return c},{})},mergeFn=function(a,b){return function(){a&&a.apply(this,arguments),b&&b.apply(this,arguments)}};module.exports=mergeJsxProps;\n","import firebase from '@firebase/app';\nimport { __awaiter, __generator, __spreadArrays } from 'tslib';\nimport { Component } from '@firebase/component';\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @fileoverview Constants used in the Firebase Storage library.\r\n */\r\n/**\r\n * Domain name for firebase storage.\r\n */\r\nvar DEFAULT_HOST = 'firebasestorage.googleapis.com';\r\n/**\r\n * The key in Firebase config json for the storage bucket.\r\n */\r\nvar CONFIG_STORAGE_BUCKET_KEY = 'storageBucket';\r\n/**\r\n * 2 minutes\r\n *\r\n * The timeout for all operations except upload.\r\n */\r\nvar DEFAULT_MAX_OPERATION_RETRY_TIME = 2 * 60 * 1000;\r\n/**\r\n * 10 minutes\r\n *\r\n * The timeout for upload.\r\n */\r\nvar DEFAULT_MAX_UPLOAD_RETRY_TIME = 10 * 60 * 1000;\r\n/**\r\n * This is the value of Number.MIN_SAFE_INTEGER, which is not well supported\r\n * enough for us to use it directly.\r\n */\r\nvar MIN_SAFE_INTEGER = -9007199254740991;\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar FirebaseStorageError = /** @class */ (function () {\r\n    function FirebaseStorageError(code, message) {\r\n        this.code_ = prependCode(code);\r\n        this.message_ = 'Firebase Storage: ' + message;\r\n        this.serverResponse_ = null;\r\n        this.name_ = 'FirebaseError';\r\n    }\r\n    FirebaseStorageError.prototype.codeProp = function () {\r\n        return this.code;\r\n    };\r\n    FirebaseStorageError.prototype.codeEquals = function (code) {\r\n        return prependCode(code) === this.codeProp();\r\n    };\r\n    FirebaseStorageError.prototype.serverResponseProp = function () {\r\n        return this.serverResponse_;\r\n    };\r\n    FirebaseStorageError.prototype.setServerResponseProp = function (serverResponse) {\r\n        this.serverResponse_ = serverResponse;\r\n    };\r\n    Object.defineProperty(FirebaseStorageError.prototype, \"name\", {\r\n        get: function () {\r\n            return this.name_;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FirebaseStorageError.prototype, \"code\", {\r\n        get: function () {\r\n            return this.code_;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FirebaseStorageError.prototype, \"message\", {\r\n        get: function () {\r\n            return this.message_;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FirebaseStorageError.prototype, \"serverResponse\", {\r\n        get: function () {\r\n            return this.serverResponse_;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return FirebaseStorageError;\r\n}());\r\nvar Code = {\r\n    // Shared between all platforms\r\n    UNKNOWN: 'unknown',\r\n    OBJECT_NOT_FOUND: 'object-not-found',\r\n    BUCKET_NOT_FOUND: 'bucket-not-found',\r\n    PROJECT_NOT_FOUND: 'project-not-found',\r\n    QUOTA_EXCEEDED: 'quota-exceeded',\r\n    UNAUTHENTICATED: 'unauthenticated',\r\n    UNAUTHORIZED: 'unauthorized',\r\n    RETRY_LIMIT_EXCEEDED: 'retry-limit-exceeded',\r\n    INVALID_CHECKSUM: 'invalid-checksum',\r\n    CANCELED: 'canceled',\r\n    // JS specific\r\n    INVALID_EVENT_NAME: 'invalid-event-name',\r\n    INVALID_URL: 'invalid-url',\r\n    INVALID_DEFAULT_BUCKET: 'invalid-default-bucket',\r\n    NO_DEFAULT_BUCKET: 'no-default-bucket',\r\n    CANNOT_SLICE_BLOB: 'cannot-slice-blob',\r\n    SERVER_FILE_WRONG_SIZE: 'server-file-wrong-size',\r\n    NO_DOWNLOAD_URL: 'no-download-url',\r\n    INVALID_ARGUMENT: 'invalid-argument',\r\n    INVALID_ARGUMENT_COUNT: 'invalid-argument-count',\r\n    APP_DELETED: 'app-deleted',\r\n    INVALID_ROOT_OPERATION: 'invalid-root-operation',\r\n    INVALID_FORMAT: 'invalid-format',\r\n    INTERNAL_ERROR: 'internal-error'\r\n};\r\nfunction prependCode(code) {\r\n    return 'storage/' + code;\r\n}\r\nfunction unknown() {\r\n    var message = 'An unknown error occurred, please check the error payload for ' +\r\n        'server response.';\r\n    return new FirebaseStorageError(Code.UNKNOWN, message);\r\n}\r\nfunction objectNotFound(path) {\r\n    return new FirebaseStorageError(Code.OBJECT_NOT_FOUND, \"Object '\" + path + \"' does not exist.\");\r\n}\r\nfunction quotaExceeded(bucket) {\r\n    return new FirebaseStorageError(Code.QUOTA_EXCEEDED, \"Quota for bucket '\" +\r\n        bucket +\r\n        \"' exceeded, please view quota on \" +\r\n        'https://firebase.google.com/pricing/.');\r\n}\r\nfunction unauthenticated() {\r\n    var message = 'User is not authenticated, please authenticate using Firebase ' +\r\n        'Authentication and try again.';\r\n    return new FirebaseStorageError(Code.UNAUTHENTICATED, message);\r\n}\r\nfunction unauthorized(path) {\r\n    return new FirebaseStorageError(Code.UNAUTHORIZED, \"User does not have permission to access '\" + path + \"'.\");\r\n}\r\nfunction retryLimitExceeded() {\r\n    return new FirebaseStorageError(Code.RETRY_LIMIT_EXCEEDED, 'Max retry time for operation exceeded, please try again.');\r\n}\r\nfunction canceled() {\r\n    return new FirebaseStorageError(Code.CANCELED, 'User canceled the upload/download.');\r\n}\r\nfunction invalidUrl(url) {\r\n    return new FirebaseStorageError(Code.INVALID_URL, \"Invalid URL '\" + url + \"'.\");\r\n}\r\nfunction invalidDefaultBucket(bucket) {\r\n    return new FirebaseStorageError(Code.INVALID_DEFAULT_BUCKET, \"Invalid default bucket '\" + bucket + \"'.\");\r\n}\r\nfunction cannotSliceBlob() {\r\n    return new FirebaseStorageError(Code.CANNOT_SLICE_BLOB, 'Cannot slice blob for upload. Please retry the upload.');\r\n}\r\nfunction serverFileWrongSize() {\r\n    return new FirebaseStorageError(Code.SERVER_FILE_WRONG_SIZE, 'Server recorded incorrect upload file size, please retry the upload.');\r\n}\r\nfunction noDownloadURL() {\r\n    return new FirebaseStorageError(Code.NO_DOWNLOAD_URL, 'The given file does not have any download URLs.');\r\n}\r\nfunction invalidArgument(index, fnName, message) {\r\n    return new FirebaseStorageError(Code.INVALID_ARGUMENT, 'Invalid argument in `' + fnName + '` at index ' + index + ': ' + message);\r\n}\r\nfunction invalidArgumentCount(argMin, argMax, fnName, real) {\r\n    var countPart;\r\n    var plural;\r\n    if (argMin === argMax) {\r\n        countPart = argMin;\r\n        plural = argMin === 1 ? 'argument' : 'arguments';\r\n    }\r\n    else {\r\n        countPart = 'between ' + argMin + ' and ' + argMax;\r\n        plural = 'arguments';\r\n    }\r\n    return new FirebaseStorageError(Code.INVALID_ARGUMENT_COUNT, 'Invalid argument count in `' +\r\n        fnName +\r\n        '`: Expected ' +\r\n        countPart +\r\n        ' ' +\r\n        plural +\r\n        ', received ' +\r\n        real +\r\n        '.');\r\n}\r\nfunction appDeleted() {\r\n    return new FirebaseStorageError(Code.APP_DELETED, 'The Firebase app was deleted.');\r\n}\r\n/**\r\n * @param name The name of the operation that was invalid.\r\n */\r\nfunction invalidRootOperation(name) {\r\n    return new FirebaseStorageError(Code.INVALID_ROOT_OPERATION, \"The operation '\" +\r\n        name +\r\n        \"' cannot be performed on a root reference, create a non-root \" +\r\n        \"reference using child, such as .child('file.png').\");\r\n}\r\n/**\r\n * @param format The format that was not valid.\r\n * @param message A message describing the format violation.\r\n */\r\nfunction invalidFormat(format, message) {\r\n    return new FirebaseStorageError(Code.INVALID_FORMAT, \"String does not match format '\" + format + \"': \" + message);\r\n}\r\n/**\r\n * @param message A message describing the internal error.\r\n */\r\nfunction internalError(message) {\r\n    throw new FirebaseStorageError(Code.INTERNAL_ERROR, 'Internal error: ' + message);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar StringFormat = {\r\n    RAW: 'raw',\r\n    BASE64: 'base64',\r\n    BASE64URL: 'base64url',\r\n    DATA_URL: 'data_url'\r\n};\r\nfunction formatValidator(stringFormat) {\r\n    switch (stringFormat) {\r\n        case StringFormat.RAW:\r\n        case StringFormat.BASE64:\r\n        case StringFormat.BASE64URL:\r\n        case StringFormat.DATA_URL:\r\n            return;\r\n        default:\r\n            throw 'Expected one of the event types: [' +\r\n                StringFormat.RAW +\r\n                ', ' +\r\n                StringFormat.BASE64 +\r\n                ', ' +\r\n                StringFormat.BASE64URL +\r\n                ', ' +\r\n                StringFormat.DATA_URL +\r\n                '].';\r\n    }\r\n}\r\n/**\r\n * @struct\r\n */\r\nvar StringData = /** @class */ (function () {\r\n    function StringData(data, contentType) {\r\n        this.data = data;\r\n        this.contentType = contentType || null;\r\n    }\r\n    return StringData;\r\n}());\r\nfunction dataFromString(format, stringData) {\r\n    switch (format) {\r\n        case StringFormat.RAW:\r\n            return new StringData(utf8Bytes_(stringData));\r\n        case StringFormat.BASE64:\r\n        case StringFormat.BASE64URL:\r\n            return new StringData(base64Bytes_(format, stringData));\r\n        case StringFormat.DATA_URL:\r\n            return new StringData(dataURLBytes_(stringData), dataURLContentType_(stringData));\r\n        // do nothing\r\n    }\r\n    // assert(false);\r\n    throw unknown();\r\n}\r\nfunction utf8Bytes_(value) {\r\n    var b = [];\r\n    for (var i = 0; i < value.length; i++) {\r\n        var c = value.charCodeAt(i);\r\n        if (c <= 127) {\r\n            b.push(c);\r\n        }\r\n        else {\r\n            if (c <= 2047) {\r\n                b.push(192 | (c >> 6), 128 | (c & 63));\r\n            }\r\n            else {\r\n                if ((c & 64512) === 55296) {\r\n                    // The start of a surrogate pair.\r\n                    var valid = i < value.length - 1 && (value.charCodeAt(i + 1) & 64512) === 56320;\r\n                    if (!valid) {\r\n                        // The second surrogate wasn't there.\r\n                        b.push(239, 191, 189);\r\n                    }\r\n                    else {\r\n                        var hi = c;\r\n                        var lo = value.charCodeAt(++i);\r\n                        c = 65536 | ((hi & 1023) << 10) | (lo & 1023);\r\n                        b.push(240 | (c >> 18), 128 | ((c >> 12) & 63), 128 | ((c >> 6) & 63), 128 | (c & 63));\r\n                    }\r\n                }\r\n                else {\r\n                    if ((c & 64512) === 56320) {\r\n                        // Invalid low surrogate.\r\n                        b.push(239, 191, 189);\r\n                    }\r\n                    else {\r\n                        b.push(224 | (c >> 12), 128 | ((c >> 6) & 63), 128 | (c & 63));\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return new Uint8Array(b);\r\n}\r\nfunction percentEncodedBytes_(value) {\r\n    var decoded;\r\n    try {\r\n        decoded = decodeURIComponent(value);\r\n    }\r\n    catch (e) {\r\n        throw invalidFormat(StringFormat.DATA_URL, 'Malformed data URL.');\r\n    }\r\n    return utf8Bytes_(decoded);\r\n}\r\nfunction base64Bytes_(format, value) {\r\n    switch (format) {\r\n        case StringFormat.BASE64: {\r\n            var hasMinus = value.indexOf('-') !== -1;\r\n            var hasUnder = value.indexOf('_') !== -1;\r\n            if (hasMinus || hasUnder) {\r\n                var invalidChar = hasMinus ? '-' : '_';\r\n                throw invalidFormat(format, \"Invalid character '\" +\r\n                    invalidChar +\r\n                    \"' found: is it base64url encoded?\");\r\n            }\r\n            break;\r\n        }\r\n        case StringFormat.BASE64URL: {\r\n            var hasPlus = value.indexOf('+') !== -1;\r\n            var hasSlash = value.indexOf('/') !== -1;\r\n            if (hasPlus || hasSlash) {\r\n                var invalidChar = hasPlus ? '+' : '/';\r\n                throw invalidFormat(format, \"Invalid character '\" + invalidChar + \"' found: is it base64 encoded?\");\r\n            }\r\n            value = value.replace(/-/g, '+').replace(/_/g, '/');\r\n            break;\r\n        }\r\n        // do nothing\r\n    }\r\n    var bytes;\r\n    try {\r\n        bytes = atob(value);\r\n    }\r\n    catch (e) {\r\n        throw invalidFormat(format, 'Invalid character found');\r\n    }\r\n    var array = new Uint8Array(bytes.length);\r\n    for (var i = 0; i < bytes.length; i++) {\r\n        array[i] = bytes.charCodeAt(i);\r\n    }\r\n    return array;\r\n}\r\n/**\r\n * @struct\r\n */\r\nvar DataURLParts = /** @class */ (function () {\r\n    function DataURLParts(dataURL) {\r\n        this.base64 = false;\r\n        this.contentType = null;\r\n        var matches = dataURL.match(/^data:([^,]+)?,/);\r\n        if (matches === null) {\r\n            throw invalidFormat(StringFormat.DATA_URL, \"Must be formatted 'data:[<mediatype>][;base64],<data>\");\r\n        }\r\n        var middle = matches[1] || null;\r\n        if (middle != null) {\r\n            this.base64 = endsWith(middle, ';base64');\r\n            this.contentType = this.base64\r\n                ? middle.substring(0, middle.length - ';base64'.length)\r\n                : middle;\r\n        }\r\n        this.rest = dataURL.substring(dataURL.indexOf(',') + 1);\r\n    }\r\n    return DataURLParts;\r\n}());\r\nfunction dataURLBytes_(dataUrl) {\r\n    var parts = new DataURLParts(dataUrl);\r\n    if (parts.base64) {\r\n        return base64Bytes_(StringFormat.BASE64, parts.rest);\r\n    }\r\n    else {\r\n        return percentEncodedBytes_(parts.rest);\r\n    }\r\n}\r\nfunction dataURLContentType_(dataUrl) {\r\n    var parts = new DataURLParts(dataUrl);\r\n    return parts.contentType;\r\n}\r\nfunction endsWith(s, end) {\r\n    var longEnough = s.length >= end.length;\r\n    if (!longEnough) {\r\n        return false;\r\n    }\r\n    return s.substring(s.length - end.length) === end;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar TaskEvent = {\r\n    /** Triggered whenever the task changes or progress is updated. */\r\n    STATE_CHANGED: 'state_changed'\r\n};\r\nvar InternalTaskState = {\r\n    RUNNING: 'running',\r\n    PAUSING: 'pausing',\r\n    PAUSED: 'paused',\r\n    SUCCESS: 'success',\r\n    CANCELING: 'canceling',\r\n    CANCELED: 'canceled',\r\n    ERROR: 'error'\r\n};\r\nvar TaskState = {\r\n    /** The task is currently transferring data. */\r\n    RUNNING: 'running',\r\n    /** The task was paused by the user. */\r\n    PAUSED: 'paused',\r\n    /** The task completed successfully. */\r\n    SUCCESS: 'success',\r\n    /** The task was canceled. */\r\n    CANCELED: 'canceled',\r\n    /** The task failed with an error. */\r\n    ERROR: 'error'\r\n};\r\nfunction taskStateFromInternalTaskState(state) {\r\n    switch (state) {\r\n        case InternalTaskState.RUNNING:\r\n        case InternalTaskState.PAUSING:\r\n        case InternalTaskState.CANCELING:\r\n            return TaskState.RUNNING;\r\n        case InternalTaskState.PAUSED:\r\n            return TaskState.PAUSED;\r\n        case InternalTaskState.SUCCESS:\r\n            return TaskState.SUCCESS;\r\n        case InternalTaskState.CANCELED:\r\n            return TaskState.CANCELED;\r\n        case InternalTaskState.ERROR:\r\n            return TaskState.ERROR;\r\n        default:\r\n            // TODO(andysoto): assert(false);\r\n            return TaskState.ERROR;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @return False if the object is undefined or null, true otherwise.\r\n */\r\nfunction isDef(p) {\r\n    return p != null;\r\n}\r\nfunction isJustDef(p) {\r\n    return p !== void 0;\r\n}\r\nfunction isFunction(p) {\r\n    return typeof p === 'function';\r\n}\r\nfunction isObject(p) {\r\n    return typeof p === 'object';\r\n}\r\nfunction isNonNullObject(p) {\r\n    return isObject(p) && p !== null;\r\n}\r\nfunction isNonArrayObject(p) {\r\n    return isObject(p) && !Array.isArray(p);\r\n}\r\nfunction isString(p) {\r\n    return typeof p === 'string' || p instanceof String;\r\n}\r\nfunction isInteger(p) {\r\n    return isNumber(p) && Number.isInteger(p);\r\n}\r\nfunction isNumber(p) {\r\n    return typeof p === 'number' || p instanceof Number;\r\n}\r\nfunction isNativeBlob(p) {\r\n    return isNativeBlobDefined() && p instanceof Blob;\r\n}\r\nfunction isNativeBlobDefined() {\r\n    return typeof Blob !== 'undefined';\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @enum{number}\r\n */\r\nvar ErrorCode;\r\n(function (ErrorCode) {\r\n    ErrorCode[ErrorCode[\"NO_ERROR\"] = 0] = \"NO_ERROR\";\r\n    ErrorCode[ErrorCode[\"NETWORK_ERROR\"] = 1] = \"NETWORK_ERROR\";\r\n    ErrorCode[ErrorCode[\"ABORT\"] = 2] = \"ABORT\";\r\n})(ErrorCode || (ErrorCode = {}));\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * We use this instead of goog.net.XhrIo because goog.net.XhrIo is hyuuuuge and\r\n * doesn't work in React Native on Android.\r\n */\r\nvar NetworkXhrIo = /** @class */ (function () {\r\n    function NetworkXhrIo() {\r\n        var _this = this;\r\n        this.sent_ = false;\r\n        this.xhr_ = new XMLHttpRequest();\r\n        this.errorCode_ = ErrorCode.NO_ERROR;\r\n        this.sendPromise_ = new Promise(function (resolve) {\r\n            _this.xhr_.addEventListener('abort', function () {\r\n                _this.errorCode_ = ErrorCode.ABORT;\r\n                resolve(_this);\r\n            });\r\n            _this.xhr_.addEventListener('error', function () {\r\n                _this.errorCode_ = ErrorCode.NETWORK_ERROR;\r\n                resolve(_this);\r\n            });\r\n            _this.xhr_.addEventListener('load', function () {\r\n                resolve(_this);\r\n            });\r\n        });\r\n    }\r\n    /**\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.send = function (url, method, body, headers) {\r\n        if (this.sent_) {\r\n            throw internalError('cannot .send() more than once');\r\n        }\r\n        this.sent_ = true;\r\n        this.xhr_.open(method, url, true);\r\n        if (isDef(headers)) {\r\n            for (var key in headers) {\r\n                if (headers.hasOwnProperty(key)) {\r\n                    this.xhr_.setRequestHeader(key, headers[key].toString());\r\n                }\r\n            }\r\n        }\r\n        if (isDef(body)) {\r\n            this.xhr_.send(body);\r\n        }\r\n        else {\r\n            this.xhr_.send();\r\n        }\r\n        return this.sendPromise_;\r\n    };\r\n    /**\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.getErrorCode = function () {\r\n        if (!this.sent_) {\r\n            throw internalError('cannot .getErrorCode() before sending');\r\n        }\r\n        return this.errorCode_;\r\n    };\r\n    /**\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.getStatus = function () {\r\n        if (!this.sent_) {\r\n            throw internalError('cannot .getStatus() before sending');\r\n        }\r\n        try {\r\n            return this.xhr_.status;\r\n        }\r\n        catch (e) {\r\n            return -1;\r\n        }\r\n    };\r\n    /**\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.getResponseText = function () {\r\n        if (!this.sent_) {\r\n            throw internalError('cannot .getResponseText() before sending');\r\n        }\r\n        return this.xhr_.responseText;\r\n    };\r\n    /**\r\n     * Aborts the request.\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.abort = function () {\r\n        this.xhr_.abort();\r\n    };\r\n    /**\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.getResponseHeader = function (header) {\r\n        return this.xhr_.getResponseHeader(header);\r\n    };\r\n    /**\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.addUploadProgressListener = function (listener) {\r\n        if (isDef(this.xhr_.upload)) {\r\n            this.xhr_.upload.addEventListener('progress', listener);\r\n        }\r\n    };\r\n    /**\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.removeUploadProgressListener = function (listener) {\r\n        if (isDef(this.xhr_.upload)) {\r\n            this.xhr_.upload.removeEventListener('progress', listener);\r\n        }\r\n    };\r\n    return NetworkXhrIo;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Factory-like class for creating XhrIo instances.\r\n */\r\nvar XhrIoPool = /** @class */ (function () {\r\n    function XhrIoPool() {\r\n    }\r\n    XhrIoPool.prototype.createXhrIo = function () {\r\n        return new NetworkXhrIo();\r\n    };\r\n    return XhrIoPool;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getBlobBuilder() {\r\n    if (typeof BlobBuilder !== 'undefined') {\r\n        return BlobBuilder;\r\n    }\r\n    else if (typeof WebKitBlobBuilder !== 'undefined') {\r\n        return WebKitBlobBuilder;\r\n    }\r\n    else {\r\n        return undefined;\r\n    }\r\n}\r\n/**\r\n * Concatenates one or more values together and converts them to a Blob.\r\n *\r\n * @param args The values that will make up the resulting blob.\r\n * @return The blob.\r\n */\r\nfunction getBlob() {\r\n    var args = [];\r\n    for (var _i = 0; _i < arguments.length; _i++) {\r\n        args[_i] = arguments[_i];\r\n    }\r\n    var BlobBuilder = getBlobBuilder();\r\n    if (BlobBuilder !== undefined) {\r\n        var bb = new BlobBuilder();\r\n        for (var i = 0; i < args.length; i++) {\r\n            bb.append(args[i]);\r\n        }\r\n        return bb.getBlob();\r\n    }\r\n    else {\r\n        if (isNativeBlobDefined()) {\r\n            return new Blob(args);\r\n        }\r\n        else {\r\n            throw Error(\"This browser doesn't seem to support creating Blobs\");\r\n        }\r\n    }\r\n}\r\n/**\r\n * Slices the blob. The returned blob contains data from the start byte\r\n * (inclusive) till the end byte (exclusive). Negative indices cannot be used.\r\n *\r\n * @param blob The blob to be sliced.\r\n * @param start Index of the starting byte.\r\n * @param end Index of the ending byte.\r\n * @return The blob slice or null if not supported.\r\n */\r\nfunction sliceBlob(blob, start, end) {\r\n    if (blob.webkitSlice) {\r\n        return blob.webkitSlice(start, end);\r\n    }\r\n    else if (blob.mozSlice) {\r\n        return blob.mozSlice(start, end);\r\n    }\r\n    else if (blob.slice) {\r\n        return blob.slice(start, end);\r\n    }\r\n    return null;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @param opt_elideCopy If true, doesn't copy mutable input data\r\n *     (e.g. Uint8Arrays). Pass true only if you know the objects will not be\r\n *     modified after this blob's construction.\r\n */\r\nvar FbsBlob = /** @class */ (function () {\r\n    function FbsBlob(data, elideCopy) {\r\n        var size = 0;\r\n        var blobType = '';\r\n        if (isNativeBlob(data)) {\r\n            this.data_ = data;\r\n            size = data.size;\r\n            blobType = data.type;\r\n        }\r\n        else if (data instanceof ArrayBuffer) {\r\n            if (elideCopy) {\r\n                this.data_ = new Uint8Array(data);\r\n            }\r\n            else {\r\n                this.data_ = new Uint8Array(data.byteLength);\r\n                this.data_.set(new Uint8Array(data));\r\n            }\r\n            size = this.data_.length;\r\n        }\r\n        else if (data instanceof Uint8Array) {\r\n            if (elideCopy) {\r\n                this.data_ = data;\r\n            }\r\n            else {\r\n                this.data_ = new Uint8Array(data.length);\r\n                this.data_.set(data);\r\n            }\r\n            size = data.length;\r\n        }\r\n        this.size_ = size;\r\n        this.type_ = blobType;\r\n    }\r\n    FbsBlob.prototype.size = function () {\r\n        return this.size_;\r\n    };\r\n    FbsBlob.prototype.type = function () {\r\n        return this.type_;\r\n    };\r\n    FbsBlob.prototype.slice = function (startByte, endByte) {\r\n        if (isNativeBlob(this.data_)) {\r\n            var realBlob = this.data_;\r\n            var sliced = sliceBlob(realBlob, startByte, endByte);\r\n            if (sliced === null) {\r\n                return null;\r\n            }\r\n            return new FbsBlob(sliced);\r\n        }\r\n        else {\r\n            var slice = new Uint8Array(this.data_.buffer, startByte, endByte - startByte);\r\n            return new FbsBlob(slice, true);\r\n        }\r\n    };\r\n    FbsBlob.getBlob = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        if (isNativeBlobDefined()) {\r\n            var blobby = args.map(function (val) {\r\n                if (val instanceof FbsBlob) {\r\n                    return val.data_;\r\n                }\r\n                else {\r\n                    return val;\r\n                }\r\n            });\r\n            return new FbsBlob(getBlob.apply(null, blobby));\r\n        }\r\n        else {\r\n            var uint8Arrays = args.map(function (val) {\r\n                if (isString(val)) {\r\n                    return dataFromString(StringFormat.RAW, val).data;\r\n                }\r\n                else {\r\n                    // Blobs don't exist, so this has to be a Uint8Array.\r\n                    return val.data_;\r\n                }\r\n            });\r\n            var finalLength_1 = 0;\r\n            uint8Arrays.forEach(function (array) {\r\n                finalLength_1 += array.byteLength;\r\n            });\r\n            var merged_1 = new Uint8Array(finalLength_1);\r\n            var index_1 = 0;\r\n            uint8Arrays.forEach(function (array) {\r\n                for (var i = 0; i < array.length; i++) {\r\n                    merged_1[index_1++] = array[i];\r\n                }\r\n            });\r\n            return new FbsBlob(merged_1, true);\r\n        }\r\n    };\r\n    FbsBlob.prototype.uploadData = function () {\r\n        return this.data_;\r\n    };\r\n    return FbsBlob;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @struct\r\n */\r\nvar Location = /** @class */ (function () {\r\n    function Location(bucket, path) {\r\n        this.bucket = bucket;\r\n        this.path_ = path;\r\n    }\r\n    Object.defineProperty(Location.prototype, \"path\", {\r\n        get: function () {\r\n            return this.path_;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Location.prototype, \"isRoot\", {\r\n        get: function () {\r\n            return this.path.length === 0;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Location.prototype.fullServerUrl = function () {\r\n        var encode = encodeURIComponent;\r\n        return '/b/' + encode(this.bucket) + '/o/' + encode(this.path);\r\n    };\r\n    Location.prototype.bucketOnlyServerUrl = function () {\r\n        var encode = encodeURIComponent;\r\n        return '/b/' + encode(this.bucket) + '/o';\r\n    };\r\n    Location.makeFromBucketSpec = function (bucketString) {\r\n        var bucketLocation;\r\n        try {\r\n            bucketLocation = Location.makeFromUrl(bucketString);\r\n        }\r\n        catch (e) {\r\n            // Not valid URL, use as-is. This lets you put bare bucket names in\r\n            // config.\r\n            return new Location(bucketString, '');\r\n        }\r\n        if (bucketLocation.path === '') {\r\n            return bucketLocation;\r\n        }\r\n        else {\r\n            throw invalidDefaultBucket(bucketString);\r\n        }\r\n    };\r\n    Location.makeFromUrl = function (url) {\r\n        var location = null;\r\n        var bucketDomain = '([A-Za-z0-9.\\\\-_]+)';\r\n        function gsModify(loc) {\r\n            if (loc.path.charAt(loc.path.length - 1) === '/') {\r\n                loc.path_ = loc.path_.slice(0, -1);\r\n            }\r\n        }\r\n        var gsPath = '(/(.*))?$';\r\n        var gsRegex = new RegExp('^gs://' + bucketDomain + gsPath, 'i');\r\n        var gsIndices = { bucket: 1, path: 3 };\r\n        function httpModify(loc) {\r\n            loc.path_ = decodeURIComponent(loc.path);\r\n        }\r\n        var version = 'v[A-Za-z0-9_]+';\r\n        var firebaseStorageHost = DEFAULT_HOST.replace(/[.]/g, '\\\\.');\r\n        var firebaseStoragePath = '(/([^?#]*).*)?$';\r\n        var firebaseStorageRegExp = new RegExp(\"^https?://\" + firebaseStorageHost + \"/\" + version + \"/b/\" + bucketDomain + \"/o\" + firebaseStoragePath, 'i');\r\n        var firebaseStorageIndices = { bucket: 1, path: 3 };\r\n        var cloudStorageHost = '(?:storage.googleapis.com|storage.cloud.google.com)';\r\n        var cloudStoragePath = '([^?#]*)';\r\n        var cloudStorageRegExp = new RegExp(\"^https?://\" + cloudStorageHost + \"/\" + bucketDomain + \"/\" + cloudStoragePath, 'i');\r\n        var cloudStorageIndices = { bucket: 1, path: 2 };\r\n        var groups = [\r\n            { regex: gsRegex, indices: gsIndices, postModify: gsModify },\r\n            {\r\n                regex: firebaseStorageRegExp,\r\n                indices: firebaseStorageIndices,\r\n                postModify: httpModify\r\n            },\r\n            {\r\n                regex: cloudStorageRegExp,\r\n                indices: cloudStorageIndices,\r\n                postModify: httpModify\r\n            }\r\n        ];\r\n        for (var i = 0; i < groups.length; i++) {\r\n            var group = groups[i];\r\n            var captures = group.regex.exec(url);\r\n            if (captures) {\r\n                var bucketValue = captures[group.indices.bucket];\r\n                var pathValue = captures[group.indices.path];\r\n                if (!pathValue) {\r\n                    pathValue = '';\r\n                }\r\n                location = new Location(bucketValue, pathValue);\r\n                group.postModify(location);\r\n                break;\r\n            }\r\n        }\r\n        if (location == null) {\r\n            throw invalidUrl(url);\r\n        }\r\n        return location;\r\n    };\r\n    return Location;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns the Object resulting from parsing the given JSON, or null if the\r\n * given string does not represent a JSON object.\r\n */\r\nfunction jsonObjectOrNull(s) {\r\n    var obj;\r\n    try {\r\n        obj = JSON.parse(s);\r\n    }\r\n    catch (e) {\r\n        return null;\r\n    }\r\n    if (isNonArrayObject(obj)) {\r\n        return obj;\r\n    }\r\n    else {\r\n        return null;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @fileoverview Contains helper methods for manipulating paths.\r\n */\r\n/**\r\n * @return Null if the path is already at the root.\r\n */\r\nfunction parent(path) {\r\n    if (path.length === 0) {\r\n        return null;\r\n    }\r\n    var index = path.lastIndexOf('/');\r\n    if (index === -1) {\r\n        return '';\r\n    }\r\n    var newPath = path.slice(0, index);\r\n    return newPath;\r\n}\r\nfunction child(path, childPath) {\r\n    var canonicalChildPath = childPath\r\n        .split('/')\r\n        .filter(function (component) { return component.length > 0; })\r\n        .join('/');\r\n    if (path.length === 0) {\r\n        return canonicalChildPath;\r\n    }\r\n    else {\r\n        return path + '/' + canonicalChildPath;\r\n    }\r\n}\r\n/**\r\n * Returns the last component of a path.\r\n * '/foo/bar' -> 'bar'\r\n * '/foo/bar/baz/' -> 'baz/'\r\n * '/a' -> 'a'\r\n */\r\nfunction lastComponent(path) {\r\n    var index = path.lastIndexOf('/', path.length - 2);\r\n    if (index === -1) {\r\n        return path;\r\n    }\r\n    else {\r\n        return path.slice(index + 1);\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction makeUrl(urlPart) {\r\n    return \"https://\" + DEFAULT_HOST + \"/v0\" + urlPart;\r\n}\r\nfunction makeQueryString(params) {\r\n    var encode = encodeURIComponent;\r\n    var queryPart = '?';\r\n    for (var key in params) {\r\n        if (params.hasOwnProperty(key)) {\r\n            // @ts-ignore TODO: remove once typescript is upgraded to 3.5.x\r\n            var nextPart = encode(key) + '=' + encode(params[key]);\r\n            queryPart = queryPart + nextPart + '&';\r\n        }\r\n    }\r\n    // Chop off the extra '&' or '?' on the end\r\n    queryPart = queryPart.slice(0, -1);\r\n    return queryPart;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction noXform_(metadata, value) {\r\n    return value;\r\n}\r\n/**\r\n * @struct\r\n */\r\nvar Mapping = /** @class */ (function () {\r\n    function Mapping(server, local, writable, xform) {\r\n        this.server = server;\r\n        this.local = local || server;\r\n        this.writable = !!writable;\r\n        this.xform = xform || noXform_;\r\n    }\r\n    return Mapping;\r\n}());\r\nvar mappings_ = null;\r\nfunction xformPath(fullPath) {\r\n    if (!isString(fullPath) || fullPath.length < 2) {\r\n        return fullPath;\r\n    }\r\n    else {\r\n        return lastComponent(fullPath);\r\n    }\r\n}\r\nfunction getMappings() {\r\n    if (mappings_) {\r\n        return mappings_;\r\n    }\r\n    var mappings = [];\r\n    mappings.push(new Mapping('bucket'));\r\n    mappings.push(new Mapping('generation'));\r\n    mappings.push(new Mapping('metageneration'));\r\n    mappings.push(new Mapping('name', 'fullPath', true));\r\n    function mappingsXformPath(_metadata, fullPath) {\r\n        return xformPath(fullPath);\r\n    }\r\n    var nameMapping = new Mapping('name');\r\n    nameMapping.xform = mappingsXformPath;\r\n    mappings.push(nameMapping);\r\n    /**\r\n     * Coerces the second param to a number, if it is defined.\r\n     */\r\n    function xformSize(_metadata, size) {\r\n        if (isDef(size)) {\r\n            return Number(size);\r\n        }\r\n        else {\r\n            return size;\r\n        }\r\n    }\r\n    var sizeMapping = new Mapping('size');\r\n    sizeMapping.xform = xformSize;\r\n    mappings.push(sizeMapping);\r\n    mappings.push(new Mapping('timeCreated'));\r\n    mappings.push(new Mapping('updated'));\r\n    mappings.push(new Mapping('md5Hash', null, true));\r\n    mappings.push(new Mapping('cacheControl', null, true));\r\n    mappings.push(new Mapping('contentDisposition', null, true));\r\n    mappings.push(new Mapping('contentEncoding', null, true));\r\n    mappings.push(new Mapping('contentLanguage', null, true));\r\n    mappings.push(new Mapping('contentType', null, true));\r\n    mappings.push(new Mapping('metadata', 'customMetadata', true));\r\n    mappings_ = mappings;\r\n    return mappings_;\r\n}\r\nfunction addRef(metadata, authWrapper) {\r\n    function generateRef() {\r\n        var bucket = metadata['bucket'];\r\n        var path = metadata['fullPath'];\r\n        var loc = new Location(bucket, path);\r\n        return authWrapper.makeStorageReference(loc);\r\n    }\r\n    Object.defineProperty(metadata, 'ref', { get: generateRef });\r\n}\r\nfunction fromResource(authWrapper, resource, mappings) {\r\n    var metadata = {};\r\n    metadata['type'] = 'file';\r\n    var len = mappings.length;\r\n    for (var i = 0; i < len; i++) {\r\n        var mapping = mappings[i];\r\n        metadata[mapping.local] = mapping.xform(metadata, resource[mapping.server]);\r\n    }\r\n    addRef(metadata, authWrapper);\r\n    return metadata;\r\n}\r\nfunction fromResourceString(authWrapper, resourceString, mappings) {\r\n    var obj = jsonObjectOrNull(resourceString);\r\n    if (obj === null) {\r\n        return null;\r\n    }\r\n    var resource = obj;\r\n    return fromResource(authWrapper, resource, mappings);\r\n}\r\nfunction downloadUrlFromResourceString(metadata, resourceString) {\r\n    var obj = jsonObjectOrNull(resourceString);\r\n    if (obj === null) {\r\n        return null;\r\n    }\r\n    if (!isString(obj['downloadTokens'])) {\r\n        // This can happen if objects are uploaded through GCS and retrieved\r\n        // through list, so we don't want to throw an Error.\r\n        return null;\r\n    }\r\n    var tokens = obj['downloadTokens'];\r\n    if (tokens.length === 0) {\r\n        return null;\r\n    }\r\n    var encode = encodeURIComponent;\r\n    var tokensList = tokens.split(',');\r\n    var urls = tokensList.map(function (token) {\r\n        var bucket = metadata['bucket'];\r\n        var path = metadata['fullPath'];\r\n        var urlPart = '/b/' + encode(bucket) + '/o/' + encode(path);\r\n        var base = makeUrl(urlPart);\r\n        var queryString = makeQueryString({\r\n            alt: 'media',\r\n            token: token\r\n        });\r\n        return base + queryString;\r\n    });\r\n    return urls[0];\r\n}\r\nfunction toResourceString(metadata, mappings) {\r\n    var resource = {};\r\n    var len = mappings.length;\r\n    for (var i = 0; i < len; i++) {\r\n        var mapping = mappings[i];\r\n        if (mapping.writable) {\r\n            resource[mapping.server] = metadata[mapping.local];\r\n        }\r\n    }\r\n    return JSON.stringify(resource);\r\n}\r\nfunction metadataValidator(p) {\r\n    if (!isObject(p) || !p) {\r\n        throw 'Expected Metadata object.';\r\n    }\r\n    for (var key in p) {\r\n        if (p.hasOwnProperty(key)) {\r\n            var val = p[key];\r\n            if (key === 'customMetadata') {\r\n                if (!isObject(val)) {\r\n                    throw 'Expected object for \\'customMetadata\\' mapping.';\r\n                }\r\n            }\r\n            else {\r\n                if (isNonNullObject(val)) {\r\n                    throw \"Mapping for '\" + key + \"' cannot be an object.\";\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar MAX_RESULTS_KEY = 'maxResults';\r\nvar MAX_MAX_RESULTS = 1000;\r\nvar PAGE_TOKEN_KEY = 'pageToken';\r\nvar PREFIXES_KEY = 'prefixes';\r\nvar ITEMS_KEY = 'items';\r\nfunction fromBackendResponse(authWrapper, bucket, resource) {\r\n    var listResult = {\r\n        prefixes: [],\r\n        items: [],\r\n        nextPageToken: resource['nextPageToken']\r\n    };\r\n    if (resource[PREFIXES_KEY]) {\r\n        for (var _i = 0, _a = resource[PREFIXES_KEY]; _i < _a.length; _i++) {\r\n            var path = _a[_i];\r\n            var pathWithoutTrailingSlash = path.replace(/\\/$/, '');\r\n            var reference = authWrapper.makeStorageReference(new Location(bucket, pathWithoutTrailingSlash));\r\n            listResult.prefixes.push(reference);\r\n        }\r\n    }\r\n    if (resource[ITEMS_KEY]) {\r\n        for (var _b = 0, _c = resource[ITEMS_KEY]; _b < _c.length; _b++) {\r\n            var item = _c[_b];\r\n            var reference = authWrapper.makeStorageReference(new Location(bucket, item['name']));\r\n            listResult.items.push(reference);\r\n        }\r\n    }\r\n    return listResult;\r\n}\r\nfunction fromResponseString(authWrapper, bucket, resourceString) {\r\n    var obj = jsonObjectOrNull(resourceString);\r\n    if (obj === null) {\r\n        return null;\r\n    }\r\n    var resource = obj;\r\n    return fromBackendResponse(authWrapper, bucket, resource);\r\n}\r\nfunction listOptionsValidator(p) {\r\n    if (!isObject(p) || !p) {\r\n        throw 'Expected ListOptions object.';\r\n    }\r\n    for (var key in p) {\r\n        if (key === MAX_RESULTS_KEY) {\r\n            if (!isInteger(p[MAX_RESULTS_KEY]) ||\r\n                p[MAX_RESULTS_KEY] <= 0) {\r\n                throw 'Expected maxResults to be a positive number.';\r\n            }\r\n            if (p[MAX_RESULTS_KEY] > 1000) {\r\n                throw \"Expected maxResults to be less than or equal to \" + MAX_MAX_RESULTS + \".\";\r\n            }\r\n        }\r\n        else if (key === PAGE_TOKEN_KEY) {\r\n            if (p[PAGE_TOKEN_KEY] && !isString(p[PAGE_TOKEN_KEY])) {\r\n                throw 'Expected pageToken to be string.';\r\n            }\r\n        }\r\n        else {\r\n            throw 'Unknown option: ' + key;\r\n        }\r\n    }\r\n}\n\nvar RequestInfo = /** @class */ (function () {\r\n    function RequestInfo(url, method, \r\n    /**\r\n     * Returns the value with which to resolve the request's promise. Only called\r\n     * if the request is successful. Throw from this function to reject the\r\n     * returned Request's promise with the thrown error.\r\n     * Note: The XhrIo passed to this function may be reused after this callback\r\n     * returns. Do not keep a reference to it in any way.\r\n     */\r\n    handler, timeout) {\r\n        this.url = url;\r\n        this.method = method;\r\n        this.handler = handler;\r\n        this.timeout = timeout;\r\n        this.urlParams = {};\r\n        this.headers = {};\r\n        this.body = null;\r\n        this.errorHandler = null;\r\n        /**\r\n         * Called with the current number of bytes uploaded and total size (-1 if not\r\n         * computable) of the request body (i.e. used to report upload progress).\r\n         */\r\n        this.progressCallback = null;\r\n        this.successCodes = [200];\r\n        this.additionalRetryCodes = [];\r\n    }\r\n    return RequestInfo;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Throws the UNKNOWN FirebaseStorageError if cndn is false.\r\n */\r\nfunction handlerCheck(cndn) {\r\n    if (!cndn) {\r\n        throw unknown();\r\n    }\r\n}\r\nfunction metadataHandler(authWrapper, mappings) {\r\n    function handler(xhr, text) {\r\n        var metadata = fromResourceString(authWrapper, text, mappings);\r\n        handlerCheck(metadata !== null);\r\n        return metadata;\r\n    }\r\n    return handler;\r\n}\r\nfunction listHandler(authWrapper, bucket) {\r\n    function handler(xhr, text) {\r\n        var listResult = fromResponseString(authWrapper, bucket, text);\r\n        handlerCheck(listResult !== null);\r\n        return listResult;\r\n    }\r\n    return handler;\r\n}\r\nfunction downloadUrlHandler(authWrapper, mappings) {\r\n    function handler(xhr, text) {\r\n        var metadata = fromResourceString(authWrapper, text, mappings);\r\n        handlerCheck(metadata !== null);\r\n        return downloadUrlFromResourceString(metadata, text);\r\n    }\r\n    return handler;\r\n}\r\nfunction sharedErrorHandler(location) {\r\n    function errorHandler(xhr, err) {\r\n        var newErr;\r\n        if (xhr.getStatus() === 401) {\r\n            newErr = unauthenticated();\r\n        }\r\n        else {\r\n            if (xhr.getStatus() === 402) {\r\n                newErr = quotaExceeded(location.bucket);\r\n            }\r\n            else {\r\n                if (xhr.getStatus() === 403) {\r\n                    newErr = unauthorized(location.path);\r\n                }\r\n                else {\r\n                    newErr = err;\r\n                }\r\n            }\r\n        }\r\n        newErr.setServerResponseProp(err.serverResponseProp());\r\n        return newErr;\r\n    }\r\n    return errorHandler;\r\n}\r\nfunction objectErrorHandler(location) {\r\n    var shared = sharedErrorHandler(location);\r\n    function errorHandler(xhr, err) {\r\n        var newErr = shared(xhr, err);\r\n        if (xhr.getStatus() === 404) {\r\n            newErr = objectNotFound(location.path);\r\n        }\r\n        newErr.setServerResponseProp(err.serverResponseProp());\r\n        return newErr;\r\n    }\r\n    return errorHandler;\r\n}\r\nfunction getMetadata(authWrapper, location, mappings) {\r\n    var urlPart = location.fullServerUrl();\r\n    var url = makeUrl(urlPart);\r\n    var method = 'GET';\r\n    var timeout = authWrapper.maxOperationRetryTime();\r\n    var requestInfo = new RequestInfo(url, method, metadataHandler(authWrapper, mappings), timeout);\r\n    requestInfo.errorHandler = objectErrorHandler(location);\r\n    return requestInfo;\r\n}\r\nfunction list(authWrapper, location, delimiter, pageToken, maxResults) {\r\n    var urlParams = {};\r\n    if (location.isRoot) {\r\n        urlParams['prefix'] = '';\r\n    }\r\n    else {\r\n        urlParams['prefix'] = location.path + '/';\r\n    }\r\n    if (delimiter && delimiter.length > 0) {\r\n        urlParams['delimiter'] = delimiter;\r\n    }\r\n    if (pageToken) {\r\n        urlParams['pageToken'] = pageToken;\r\n    }\r\n    if (maxResults) {\r\n        urlParams['maxResults'] = maxResults;\r\n    }\r\n    var urlPart = location.bucketOnlyServerUrl();\r\n    var url = makeUrl(urlPart);\r\n    var method = 'GET';\r\n    var timeout = authWrapper.maxOperationRetryTime();\r\n    var requestInfo = new RequestInfo(url, method, listHandler(authWrapper, location.bucket), timeout);\r\n    requestInfo.urlParams = urlParams;\r\n    requestInfo.errorHandler = sharedErrorHandler(location);\r\n    return requestInfo;\r\n}\r\nfunction getDownloadUrl(authWrapper, location, mappings) {\r\n    var urlPart = location.fullServerUrl();\r\n    var url = makeUrl(urlPart);\r\n    var method = 'GET';\r\n    var timeout = authWrapper.maxOperationRetryTime();\r\n    var requestInfo = new RequestInfo(url, method, downloadUrlHandler(authWrapper, mappings), timeout);\r\n    requestInfo.errorHandler = objectErrorHandler(location);\r\n    return requestInfo;\r\n}\r\nfunction updateMetadata(authWrapper, location, metadata, mappings) {\r\n    var urlPart = location.fullServerUrl();\r\n    var url = makeUrl(urlPart);\r\n    var method = 'PATCH';\r\n    var body = toResourceString(metadata, mappings);\r\n    var headers = { 'Content-Type': 'application/json; charset=utf-8' };\r\n    var timeout = authWrapper.maxOperationRetryTime();\r\n    var requestInfo = new RequestInfo(url, method, metadataHandler(authWrapper, mappings), timeout);\r\n    requestInfo.headers = headers;\r\n    requestInfo.body = body;\r\n    requestInfo.errorHandler = objectErrorHandler(location);\r\n    return requestInfo;\r\n}\r\nfunction deleteObject(authWrapper, location) {\r\n    var urlPart = location.fullServerUrl();\r\n    var url = makeUrl(urlPart);\r\n    var method = 'DELETE';\r\n    var timeout = authWrapper.maxOperationRetryTime();\r\n    function handler(_xhr, _text) { }\r\n    var requestInfo = new RequestInfo(url, method, handler, timeout);\r\n    requestInfo.successCodes = [200, 204];\r\n    requestInfo.errorHandler = objectErrorHandler(location);\r\n    return requestInfo;\r\n}\r\nfunction determineContentType_(metadata, blob) {\r\n    return ((metadata && metadata['contentType']) ||\r\n        (blob && blob.type()) ||\r\n        'application/octet-stream');\r\n}\r\nfunction metadataForUpload_(location, blob, metadata) {\r\n    var metadataClone = Object.assign({}, metadata);\r\n    metadataClone['fullPath'] = location.path;\r\n    metadataClone['size'] = blob.size();\r\n    if (!metadataClone['contentType']) {\r\n        metadataClone['contentType'] = determineContentType_(null, blob);\r\n    }\r\n    return metadataClone;\r\n}\r\nfunction multipartUpload(authWrapper, location, mappings, blob, metadata) {\r\n    var urlPart = location.bucketOnlyServerUrl();\r\n    var headers = {\r\n        'X-Goog-Upload-Protocol': 'multipart'\r\n    };\r\n    function genBoundary() {\r\n        var str = '';\r\n        for (var i = 0; i < 2; i++) {\r\n            str =\r\n                str +\r\n                    Math.random()\r\n                        .toString()\r\n                        .slice(2);\r\n        }\r\n        return str;\r\n    }\r\n    var boundary = genBoundary();\r\n    headers['Content-Type'] = 'multipart/related; boundary=' + boundary;\r\n    var metadata_ = metadataForUpload_(location, blob, metadata);\r\n    var metadataString = toResourceString(metadata_, mappings);\r\n    var preBlobPart = '--' +\r\n        boundary +\r\n        '\\r\\n' +\r\n        'Content-Type: application/json; charset=utf-8\\r\\n\\r\\n' +\r\n        metadataString +\r\n        '\\r\\n--' +\r\n        boundary +\r\n        '\\r\\n' +\r\n        'Content-Type: ' +\r\n        metadata_['contentType'] +\r\n        '\\r\\n\\r\\n';\r\n    var postBlobPart = '\\r\\n--' + boundary + '--';\r\n    var body = FbsBlob.getBlob(preBlobPart, blob, postBlobPart);\r\n    if (body === null) {\r\n        throw cannotSliceBlob();\r\n    }\r\n    var urlParams = { name: metadata_['fullPath'] };\r\n    var url = makeUrl(urlPart);\r\n    var method = 'POST';\r\n    var timeout = authWrapper.maxUploadRetryTime();\r\n    var requestInfo = new RequestInfo(url, method, metadataHandler(authWrapper, mappings), timeout);\r\n    requestInfo.urlParams = urlParams;\r\n    requestInfo.headers = headers;\r\n    requestInfo.body = body.uploadData();\r\n    requestInfo.errorHandler = sharedErrorHandler(location);\r\n    return requestInfo;\r\n}\r\n/**\r\n * @param current The number of bytes that have been uploaded so far.\r\n * @param total The total number of bytes in the upload.\r\n * @param opt_finalized True if the server has finished the upload.\r\n * @param opt_metadata The upload metadata, should\r\n *     only be passed if opt_finalized is true.\r\n * @struct\r\n */\r\nvar ResumableUploadStatus = /** @class */ (function () {\r\n    function ResumableUploadStatus(current, total, finalized, metadata) {\r\n        this.current = current;\r\n        this.total = total;\r\n        this.finalized = !!finalized;\r\n        this.metadata = metadata || null;\r\n    }\r\n    return ResumableUploadStatus;\r\n}());\r\nfunction checkResumeHeader_(xhr, allowed) {\r\n    var status = null;\r\n    try {\r\n        status = xhr.getResponseHeader('X-Goog-Upload-Status');\r\n    }\r\n    catch (e) {\r\n        handlerCheck(false);\r\n    }\r\n    var allowedStatus = allowed || ['active'];\r\n    handlerCheck(!!status && allowedStatus.indexOf(status) !== -1);\r\n    return status;\r\n}\r\nfunction createResumableUpload(authWrapper, location, mappings, blob, metadata) {\r\n    var urlPart = location.bucketOnlyServerUrl();\r\n    var metadataForUpload = metadataForUpload_(location, blob, metadata);\r\n    var urlParams = { name: metadataForUpload['fullPath'] };\r\n    var url = makeUrl(urlPart);\r\n    var method = 'POST';\r\n    var headers = {\r\n        'X-Goog-Upload-Protocol': 'resumable',\r\n        'X-Goog-Upload-Command': 'start',\r\n        'X-Goog-Upload-Header-Content-Length': blob.size(),\r\n        'X-Goog-Upload-Header-Content-Type': metadataForUpload['contentType'],\r\n        'Content-Type': 'application/json; charset=utf-8'\r\n    };\r\n    var body = toResourceString(metadataForUpload, mappings);\r\n    var timeout = authWrapper.maxUploadRetryTime();\r\n    function handler(xhr) {\r\n        checkResumeHeader_(xhr);\r\n        var url;\r\n        try {\r\n            url = xhr.getResponseHeader('X-Goog-Upload-URL');\r\n        }\r\n        catch (e) {\r\n            handlerCheck(false);\r\n        }\r\n        handlerCheck(isString(url));\r\n        return url;\r\n    }\r\n    var requestInfo = new RequestInfo(url, method, handler, timeout);\r\n    requestInfo.urlParams = urlParams;\r\n    requestInfo.headers = headers;\r\n    requestInfo.body = body;\r\n    requestInfo.errorHandler = sharedErrorHandler(location);\r\n    return requestInfo;\r\n}\r\n/**\r\n * @param url From a call to fbs.requests.createResumableUpload.\r\n */\r\nfunction getResumableUploadStatus(authWrapper, location, url, blob) {\r\n    var headers = { 'X-Goog-Upload-Command': 'query' };\r\n    function handler(xhr) {\r\n        var status = checkResumeHeader_(xhr, ['active', 'final']);\r\n        var sizeString = null;\r\n        try {\r\n            sizeString = xhr.getResponseHeader('X-Goog-Upload-Size-Received');\r\n        }\r\n        catch (e) {\r\n            handlerCheck(false);\r\n        }\r\n        if (!sizeString) {\r\n            // null or empty string\r\n            handlerCheck(false);\r\n        }\r\n        var size = Number(sizeString);\r\n        handlerCheck(!isNaN(size));\r\n        return new ResumableUploadStatus(size, blob.size(), status === 'final');\r\n    }\r\n    var method = 'POST';\r\n    var timeout = authWrapper.maxUploadRetryTime();\r\n    var requestInfo = new RequestInfo(url, method, handler, timeout);\r\n    requestInfo.headers = headers;\r\n    requestInfo.errorHandler = sharedErrorHandler(location);\r\n    return requestInfo;\r\n}\r\n/**\r\n * Any uploads via the resumable upload API must transfer a number of bytes\r\n * that is a multiple of this number.\r\n */\r\nvar resumableUploadChunkSize = 256 * 1024;\r\n/**\r\n * @param url From a call to fbs.requests.createResumableUpload.\r\n * @param chunkSize Number of bytes to upload.\r\n * @param status The previous status.\r\n *     If not passed or null, we start from the beginning.\r\n * @throws fbs.Error If the upload is already complete, the passed in status\r\n *     has a final size inconsistent with the blob, or the blob cannot be sliced\r\n *     for upload.\r\n */\r\nfunction continueResumableUpload(location, authWrapper, url, blob, chunkSize, mappings, status, progressCallback) {\r\n    // TODO(andysoto): standardize on internal asserts\r\n    // assert(!(opt_status && opt_status.finalized));\r\n    var status_ = new ResumableUploadStatus(0, 0);\r\n    if (status) {\r\n        status_.current = status.current;\r\n        status_.total = status.total;\r\n    }\r\n    else {\r\n        status_.current = 0;\r\n        status_.total = blob.size();\r\n    }\r\n    if (blob.size() !== status_.total) {\r\n        throw serverFileWrongSize();\r\n    }\r\n    var bytesLeft = status_.total - status_.current;\r\n    var bytesToUpload = bytesLeft;\r\n    if (chunkSize > 0) {\r\n        bytesToUpload = Math.min(bytesToUpload, chunkSize);\r\n    }\r\n    var startByte = status_.current;\r\n    var endByte = startByte + bytesToUpload;\r\n    var uploadCommand = bytesToUpload === bytesLeft ? 'upload, finalize' : 'upload';\r\n    var headers = {\r\n        'X-Goog-Upload-Command': uploadCommand,\r\n        'X-Goog-Upload-Offset': status_.current\r\n    };\r\n    var body = blob.slice(startByte, endByte);\r\n    if (body === null) {\r\n        throw cannotSliceBlob();\r\n    }\r\n    function handler(xhr, text) {\r\n        // TODO(andysoto): Verify the MD5 of each uploaded range:\r\n        // the 'x-range-md5' header comes back with status code 308 responses.\r\n        // We'll only be able to bail out though, because you can't re-upload a\r\n        // range that you previously uploaded.\r\n        var uploadStatus = checkResumeHeader_(xhr, ['active', 'final']);\r\n        var newCurrent = status_.current + bytesToUpload;\r\n        var size = blob.size();\r\n        var metadata;\r\n        if (uploadStatus === 'final') {\r\n            metadata = metadataHandler(authWrapper, mappings)(xhr, text);\r\n        }\r\n        else {\r\n            metadata = null;\r\n        }\r\n        return new ResumableUploadStatus(newCurrent, size, uploadStatus === 'final', metadata);\r\n    }\r\n    var method = 'POST';\r\n    var timeout = authWrapper.maxUploadRetryTime();\r\n    var requestInfo = new RequestInfo(url, method, handler, timeout);\r\n    requestInfo.headers = headers;\r\n    requestInfo.body = body.uploadData();\r\n    requestInfo.progressCallback = progressCallback || null;\r\n    requestInfo.errorHandler = sharedErrorHandler(location);\r\n    return requestInfo;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @struct\r\n */\r\nvar Observer = /** @class */ (function () {\r\n    function Observer(nextOrObserver, error, complete) {\r\n        var asFunctions = isFunction(nextOrObserver) ||\r\n            isDef(error) ||\r\n            isDef(complete);\r\n        if (asFunctions) {\r\n            this.next = nextOrObserver;\r\n            this.error = error || null;\r\n            this.complete = complete || null;\r\n        }\r\n        else {\r\n            var observer = nextOrObserver;\r\n            this.next = observer.next || null;\r\n            this.error = observer.error || null;\r\n            this.complete = observer.complete || null;\r\n        }\r\n    }\r\n    return Observer;\r\n}());\n\nvar UploadTaskSnapshot = /** @class */ (function () {\r\n    function UploadTaskSnapshot(bytesTransferred, totalBytes, state, metadata, task, ref) {\r\n        this.bytesTransferred = bytesTransferred;\r\n        this.totalBytes = totalBytes;\r\n        this.state = state;\r\n        this.metadata = metadata;\r\n        this.task = task;\r\n        this.ref = ref;\r\n    }\r\n    return UploadTaskSnapshot;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @param name Name of the function.\r\n * @param specs Argument specs.\r\n * @param passed The actual arguments passed to the function.\r\n * @throws {fbs.Error} If the arguments are invalid.\r\n */\r\nfunction validate(name, specs, passed) {\r\n    var minArgs = specs.length;\r\n    var maxArgs = specs.length;\r\n    for (var i = 0; i < specs.length; i++) {\r\n        if (specs[i].optional) {\r\n            minArgs = i;\r\n            break;\r\n        }\r\n    }\r\n    var validLength = minArgs <= passed.length && passed.length <= maxArgs;\r\n    if (!validLength) {\r\n        throw invalidArgumentCount(minArgs, maxArgs, name, passed.length);\r\n    }\r\n    for (var i = 0; i < passed.length; i++) {\r\n        try {\r\n            specs[i].validator(passed[i]);\r\n        }\r\n        catch (e) {\r\n            if (e instanceof Error) {\r\n                throw invalidArgument(i, name, e.message);\r\n            }\r\n            else {\r\n                throw invalidArgument(i, name, e);\r\n            }\r\n        }\r\n    }\r\n}\r\n/**\r\n * @struct\r\n */\r\nvar ArgSpec = /** @class */ (function () {\r\n    function ArgSpec(validator, optional) {\r\n        var self = this;\r\n        this.validator = function (p) {\r\n            if (self.optional && !isJustDef(p)) {\r\n                return;\r\n            }\r\n            validator(p);\r\n        };\r\n        this.optional = !!optional;\r\n    }\r\n    return ArgSpec;\r\n}());\r\nfunction and_(v1, v2) {\r\n    return function (p) {\r\n        v1(p);\r\n        v2(p);\r\n    };\r\n}\r\nfunction stringSpec(validator, optional) {\r\n    function stringValidator(p) {\r\n        if (!isString(p)) {\r\n            throw 'Expected string.';\r\n        }\r\n    }\r\n    var chainedValidator;\r\n    if (validator) {\r\n        chainedValidator = and_(stringValidator, validator);\r\n    }\r\n    else {\r\n        chainedValidator = stringValidator;\r\n    }\r\n    return new ArgSpec(chainedValidator, optional);\r\n}\r\nfunction uploadDataSpec() {\r\n    function validator(p) {\r\n        var valid = p instanceof Uint8Array ||\r\n            p instanceof ArrayBuffer ||\r\n            (isNativeBlobDefined() && p instanceof Blob);\r\n        if (!valid) {\r\n            throw 'Expected Blob or File.';\r\n        }\r\n    }\r\n    return new ArgSpec(validator);\r\n}\r\nfunction metadataSpec(optional) {\r\n    return new ArgSpec(metadataValidator, optional);\r\n}\r\nfunction listOptionSpec(optional) {\r\n    return new ArgSpec(listOptionsValidator, optional);\r\n}\r\nfunction nonNegativeNumberSpec() {\r\n    function validator(p) {\r\n        var valid = isNumber(p) && p >= 0;\r\n        if (!valid) {\r\n            throw 'Expected a number 0 or greater.';\r\n        }\r\n    }\r\n    return new ArgSpec(validator);\r\n}\r\nfunction looseObjectSpec(validator, optional) {\r\n    function isLooseObjectValidator(p) {\r\n        var isLooseObject = p === null || (isDef(p) && p instanceof Object);\r\n        if (!isLooseObject) {\r\n            throw 'Expected an Object.';\r\n        }\r\n        if (validator !== undefined && validator !== null) {\r\n            validator(p);\r\n        }\r\n    }\r\n    return new ArgSpec(isLooseObjectValidator, optional);\r\n}\r\nfunction nullFunctionSpec(optional) {\r\n    function validator(p) {\r\n        var valid = p === null || isFunction(p);\r\n        if (!valid) {\r\n            throw 'Expected a Function.';\r\n        }\r\n    }\r\n    return new ArgSpec(validator, optional);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns a function that invokes f with its arguments asynchronously as a\r\n * microtask, i.e. as soon as possible after the current script returns back\r\n * into browser code.\r\n */\r\nfunction async(f) {\r\n    return function () {\r\n        var argsToForward = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            argsToForward[_i] = arguments[_i];\r\n        }\r\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n        Promise.resolve().then(function () { return f.apply(void 0, argsToForward); });\r\n    };\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Represents a blob being uploaded. Can be used to pause/resume/cancel the\r\n * upload and manage callbacks for various events.\r\n */\r\nvar UploadTask = /** @class */ (function () {\r\n    /**\r\n     * @param ref The firebaseStorage.Reference object this task came\r\n     *     from, untyped to avoid cyclic dependencies.\r\n     * @param blob The blob to upload.\r\n     */\r\n    function UploadTask(ref, authWrapper, location, mappings, blob, metadata) {\r\n        var _this = this;\r\n        if (metadata === void 0) { metadata = null; }\r\n        this.transferred_ = 0;\r\n        this.needToFetchStatus_ = false;\r\n        this.needToFetchMetadata_ = false;\r\n        this.observers_ = [];\r\n        this.error_ = null;\r\n        this.uploadUrl_ = null;\r\n        this.request_ = null;\r\n        this.chunkMultiplier_ = 1;\r\n        this.resolve_ = null;\r\n        this.reject_ = null;\r\n        this.ref_ = ref;\r\n        this.authWrapper_ = authWrapper;\r\n        this.location_ = location;\r\n        this.blob_ = blob;\r\n        this.metadata_ = metadata;\r\n        this.mappings_ = mappings;\r\n        this.resumable_ = this.shouldDoResumable_(this.blob_);\r\n        this.state_ = InternalTaskState.RUNNING;\r\n        this.errorHandler_ = function (error) {\r\n            _this.request_ = null;\r\n            _this.chunkMultiplier_ = 1;\r\n            if (error.codeEquals(Code.CANCELED)) {\r\n                _this.needToFetchStatus_ = true;\r\n                _this.completeTransitions_();\r\n            }\r\n            else {\r\n                _this.error_ = error;\r\n                _this.transition_(InternalTaskState.ERROR);\r\n            }\r\n        };\r\n        this.metadataErrorHandler_ = function (error) {\r\n            _this.request_ = null;\r\n            if (error.codeEquals(Code.CANCELED)) {\r\n                _this.completeTransitions_();\r\n            }\r\n            else {\r\n                _this.error_ = error;\r\n                _this.transition_(InternalTaskState.ERROR);\r\n            }\r\n        };\r\n        this.promise_ = new Promise(function (resolve, reject) {\r\n            _this.resolve_ = resolve;\r\n            _this.reject_ = reject;\r\n            _this.start_();\r\n        });\r\n        // Prevent uncaught rejections on the internal promise from bubbling out\r\n        // to the top level with a dummy handler.\r\n        this.promise_.then(null, function () { });\r\n    }\r\n    UploadTask.prototype.makeProgressCallback_ = function () {\r\n        var _this = this;\r\n        var sizeBefore = this.transferred_;\r\n        return function (loaded) { return _this.updateProgress_(sizeBefore + loaded); };\r\n    };\r\n    UploadTask.prototype.shouldDoResumable_ = function (blob) {\r\n        return blob.size() > 256 * 1024;\r\n    };\r\n    UploadTask.prototype.start_ = function () {\r\n        if (this.state_ !== InternalTaskState.RUNNING) {\r\n            // This can happen if someone pauses us in a resume callback, for example.\r\n            return;\r\n        }\r\n        if (this.request_ !== null) {\r\n            return;\r\n        }\r\n        if (this.resumable_) {\r\n            if (this.uploadUrl_ === null) {\r\n                this.createResumable_();\r\n            }\r\n            else {\r\n                if (this.needToFetchStatus_) {\r\n                    this.fetchStatus_();\r\n                }\r\n                else {\r\n                    if (this.needToFetchMetadata_) {\r\n                        // Happens if we miss the metadata on upload completion.\r\n                        this.fetchMetadata_();\r\n                    }\r\n                    else {\r\n                        this.continueUpload_();\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this.oneShotUpload_();\r\n        }\r\n    };\r\n    UploadTask.prototype.resolveToken_ = function (callback) {\r\n        var _this = this;\r\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n        this.authWrapper_.getAuthToken().then(function (authToken) {\r\n            switch (_this.state_) {\r\n                case InternalTaskState.RUNNING:\r\n                    callback(authToken);\r\n                    break;\r\n                case InternalTaskState.CANCELING:\r\n                    _this.transition_(InternalTaskState.CANCELED);\r\n                    break;\r\n                case InternalTaskState.PAUSING:\r\n                    _this.transition_(InternalTaskState.PAUSED);\r\n                    break;\r\n            }\r\n        });\r\n    };\r\n    // TODO(andysoto): assert false\r\n    UploadTask.prototype.createResumable_ = function () {\r\n        var _this = this;\r\n        this.resolveToken_(function (authToken) {\r\n            var requestInfo = createResumableUpload(_this.authWrapper_, _this.location_, _this.mappings_, _this.blob_, _this.metadata_);\r\n            var createRequest = _this.authWrapper_.makeRequest(requestInfo, authToken);\r\n            _this.request_ = createRequest;\r\n            createRequest.getPromise().then(function (url) {\r\n                _this.request_ = null;\r\n                _this.uploadUrl_ = url;\r\n                _this.needToFetchStatus_ = false;\r\n                _this.completeTransitions_();\r\n            }, _this.errorHandler_);\r\n        });\r\n    };\r\n    UploadTask.prototype.fetchStatus_ = function () {\r\n        var _this = this;\r\n        // TODO(andysoto): assert(this.uploadUrl_ !== null);\r\n        var url = this.uploadUrl_;\r\n        this.resolveToken_(function (authToken) {\r\n            var requestInfo = getResumableUploadStatus(_this.authWrapper_, _this.location_, url, _this.blob_);\r\n            var statusRequest = _this.authWrapper_.makeRequest(requestInfo, authToken);\r\n            _this.request_ = statusRequest;\r\n            statusRequest.getPromise().then(function (status) {\r\n                status = status;\r\n                _this.request_ = null;\r\n                _this.updateProgress_(status.current);\r\n                _this.needToFetchStatus_ = false;\r\n                if (status.finalized) {\r\n                    _this.needToFetchMetadata_ = true;\r\n                }\r\n                _this.completeTransitions_();\r\n            }, _this.errorHandler_);\r\n        });\r\n    };\r\n    UploadTask.prototype.continueUpload_ = function () {\r\n        var _this = this;\r\n        var chunkSize = resumableUploadChunkSize * this.chunkMultiplier_;\r\n        var status = new ResumableUploadStatus(this.transferred_, this.blob_.size());\r\n        // TODO(andysoto): assert(this.uploadUrl_ !== null);\r\n        var url = this.uploadUrl_;\r\n        this.resolveToken_(function (authToken) {\r\n            var requestInfo;\r\n            try {\r\n                requestInfo = continueResumableUpload(_this.location_, _this.authWrapper_, url, _this.blob_, chunkSize, _this.mappings_, status, _this.makeProgressCallback_());\r\n            }\r\n            catch (e) {\r\n                _this.error_ = e;\r\n                _this.transition_(InternalTaskState.ERROR);\r\n                return;\r\n            }\r\n            var uploadRequest = _this.authWrapper_.makeRequest(requestInfo, authToken);\r\n            _this.request_ = uploadRequest;\r\n            uploadRequest\r\n                .getPromise()\r\n                .then(function (newStatus) {\r\n                _this.increaseMultiplier_();\r\n                _this.request_ = null;\r\n                _this.updateProgress_(newStatus.current);\r\n                if (newStatus.finalized) {\r\n                    _this.metadata_ = newStatus.metadata;\r\n                    _this.transition_(InternalTaskState.SUCCESS);\r\n                }\r\n                else {\r\n                    _this.completeTransitions_();\r\n                }\r\n            }, _this.errorHandler_);\r\n        });\r\n    };\r\n    UploadTask.prototype.increaseMultiplier_ = function () {\r\n        var currentSize = resumableUploadChunkSize * this.chunkMultiplier_;\r\n        // Max chunk size is 32M.\r\n        if (currentSize < 32 * 1024 * 1024) {\r\n            this.chunkMultiplier_ *= 2;\r\n        }\r\n    };\r\n    UploadTask.prototype.fetchMetadata_ = function () {\r\n        var _this = this;\r\n        this.resolveToken_(function (authToken) {\r\n            var requestInfo = getMetadata(_this.authWrapper_, _this.location_, _this.mappings_);\r\n            var metadataRequest = _this.authWrapper_.makeRequest(requestInfo, authToken);\r\n            _this.request_ = metadataRequest;\r\n            metadataRequest.getPromise().then(function (metadata) {\r\n                _this.request_ = null;\r\n                _this.metadata_ = metadata;\r\n                _this.transition_(InternalTaskState.SUCCESS);\r\n            }, _this.metadataErrorHandler_);\r\n        });\r\n    };\r\n    UploadTask.prototype.oneShotUpload_ = function () {\r\n        var _this = this;\r\n        this.resolveToken_(function (authToken) {\r\n            var requestInfo = multipartUpload(_this.authWrapper_, _this.location_, _this.mappings_, _this.blob_, _this.metadata_);\r\n            var multipartRequest = _this.authWrapper_.makeRequest(requestInfo, authToken);\r\n            _this.request_ = multipartRequest;\r\n            multipartRequest.getPromise().then(function (metadata) {\r\n                _this.request_ = null;\r\n                _this.metadata_ = metadata;\r\n                _this.updateProgress_(_this.blob_.size());\r\n                _this.transition_(InternalTaskState.SUCCESS);\r\n            }, _this.errorHandler_);\r\n        });\r\n    };\r\n    UploadTask.prototype.updateProgress_ = function (transferred) {\r\n        var old = this.transferred_;\r\n        this.transferred_ = transferred;\r\n        // A progress update can make the \"transferred\" value smaller (e.g. a\r\n        // partial upload not completed by server, after which the \"transferred\"\r\n        // value may reset to the value at the beginning of the request).\r\n        if (this.transferred_ !== old) {\r\n            this.notifyObservers_();\r\n        }\r\n    };\r\n    UploadTask.prototype.transition_ = function (state) {\r\n        if (this.state_ === state) {\r\n            return;\r\n        }\r\n        switch (state) {\r\n            case InternalTaskState.CANCELING:\r\n                // TODO(andysoto):\r\n                // assert(this.state_ === InternalTaskState.RUNNING ||\r\n                //        this.state_ === InternalTaskState.PAUSING);\r\n                this.state_ = state;\r\n                if (this.request_ !== null) {\r\n                    this.request_.cancel();\r\n                }\r\n                break;\r\n            case InternalTaskState.PAUSING:\r\n                // TODO(andysoto):\r\n                // assert(this.state_ === InternalTaskState.RUNNING);\r\n                this.state_ = state;\r\n                if (this.request_ !== null) {\r\n                    this.request_.cancel();\r\n                }\r\n                break;\r\n            case InternalTaskState.RUNNING:\r\n                // TODO(andysoto):\r\n                // assert(this.state_ === InternalTaskState.PAUSED ||\r\n                //        this.state_ === InternalTaskState.PAUSING);\r\n                var wasPaused = this.state_ === InternalTaskState.PAUSED;\r\n                this.state_ = state;\r\n                if (wasPaused) {\r\n                    this.notifyObservers_();\r\n                    this.start_();\r\n                }\r\n                break;\r\n            case InternalTaskState.PAUSED:\r\n                // TODO(andysoto):\r\n                // assert(this.state_ === InternalTaskState.PAUSING);\r\n                this.state_ = state;\r\n                this.notifyObservers_();\r\n                break;\r\n            case InternalTaskState.CANCELED:\r\n                // TODO(andysoto):\r\n                // assert(this.state_ === InternalTaskState.PAUSED ||\r\n                //        this.state_ === InternalTaskState.CANCELING);\r\n                this.error_ = canceled();\r\n                this.state_ = state;\r\n                this.notifyObservers_();\r\n                break;\r\n            case InternalTaskState.ERROR:\r\n                // TODO(andysoto):\r\n                // assert(this.state_ === InternalTaskState.RUNNING ||\r\n                //        this.state_ === InternalTaskState.PAUSING ||\r\n                //        this.state_ === InternalTaskState.CANCELING);\r\n                this.state_ = state;\r\n                this.notifyObservers_();\r\n                break;\r\n            case InternalTaskState.SUCCESS:\r\n                // TODO(andysoto):\r\n                // assert(this.state_ === InternalTaskState.RUNNING ||\r\n                //        this.state_ === InternalTaskState.PAUSING ||\r\n                //        this.state_ === InternalTaskState.CANCELING);\r\n                this.state_ = state;\r\n                this.notifyObservers_();\r\n                break;\r\n        }\r\n    };\r\n    UploadTask.prototype.completeTransitions_ = function () {\r\n        switch (this.state_) {\r\n            case InternalTaskState.PAUSING:\r\n                this.transition_(InternalTaskState.PAUSED);\r\n                break;\r\n            case InternalTaskState.CANCELING:\r\n                this.transition_(InternalTaskState.CANCELED);\r\n                break;\r\n            case InternalTaskState.RUNNING:\r\n                this.start_();\r\n                break;\r\n        }\r\n    };\r\n    Object.defineProperty(UploadTask.prototype, \"snapshot\", {\r\n        get: function () {\r\n            var externalState = taskStateFromInternalTaskState(this.state_);\r\n            return new UploadTaskSnapshot(this.transferred_, this.blob_.size(), externalState, this.metadata_, this, this.ref_);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Adds a callback for an event.\r\n     * @param type The type of event to listen for.\r\n     */\r\n    UploadTask.prototype.on = function (type, nextOrObserver, error, completed) {\r\n        function typeValidator() {\r\n            if (type !== TaskEvent.STATE_CHANGED) {\r\n                throw \"Expected one of the event types: [\" + TaskEvent.STATE_CHANGED + \"].\";\r\n            }\r\n        }\r\n        var nextOrObserverMessage = 'Expected a function or an Object with one of ' +\r\n            '`next`, `error`, `complete` properties.';\r\n        var nextValidator = nullFunctionSpec(true).validator;\r\n        var observerValidator = looseObjectSpec(null, true).validator;\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        function nextOrObserverValidator(p) {\r\n            try {\r\n                nextValidator(p);\r\n                return;\r\n            }\r\n            catch (e) { }\r\n            try {\r\n                observerValidator(p);\r\n                var anyDefined = isJustDef(p['next']) ||\r\n                    isJustDef(p['error']) ||\r\n                    isJustDef(p['complete']);\r\n                if (!anyDefined) {\r\n                    throw '';\r\n                }\r\n                return;\r\n            }\r\n            catch (e) {\r\n                throw nextOrObserverMessage;\r\n            }\r\n        }\r\n        var specs = [\r\n            stringSpec(typeValidator),\r\n            looseObjectSpec(nextOrObserverValidator, true),\r\n            nullFunctionSpec(true),\r\n            nullFunctionSpec(true)\r\n        ];\r\n        validate('on', specs, arguments);\r\n        var self = this;\r\n        function makeBinder(specs) {\r\n            function binder(nextOrObserver, error, complete) {\r\n                if (specs !== null) {\r\n                    validate('on', specs, arguments);\r\n                }\r\n                var observer = new Observer(nextOrObserver, error, completed);\r\n                self.addObserver_(observer);\r\n                return function () {\r\n                    self.removeObserver_(observer);\r\n                };\r\n            }\r\n            return binder;\r\n        }\r\n        function binderNextOrObserverValidator(p) {\r\n            if (p === null) {\r\n                throw nextOrObserverMessage;\r\n            }\r\n            nextOrObserverValidator(p);\r\n        }\r\n        var binderSpecs = [\r\n            looseObjectSpec(binderNextOrObserverValidator),\r\n            nullFunctionSpec(true),\r\n            nullFunctionSpec(true)\r\n        ];\r\n        var typeOnly = !(isJustDef(nextOrObserver) ||\r\n            isJustDef(error) ||\r\n            isJustDef(completed));\r\n        if (typeOnly) {\r\n            return makeBinder(binderSpecs);\r\n        }\r\n        else {\r\n            return makeBinder(null)(nextOrObserver, error, completed);\r\n        }\r\n    };\r\n    /**\r\n     * This object behaves like a Promise, and resolves with its snapshot data\r\n     * when the upload completes.\r\n     * @param onFulfilled The fulfillment callback. Promise chaining works as normal.\r\n     * @param onRejected The rejection callback.\r\n     */\r\n    UploadTask.prototype.then = function (onFulfilled, onRejected) {\r\n        // These casts are needed so that TypeScript can infer the types of the\r\n        // resulting Promise.\r\n        return this.promise_.then(onFulfilled, onRejected);\r\n    };\r\n    /**\r\n     * Equivalent to calling `then(null, onRejected)`.\r\n     */\r\n    UploadTask.prototype.catch = function (onRejected) {\r\n        return this.then(null, onRejected);\r\n    };\r\n    /**\r\n     * Adds the given observer.\r\n     */\r\n    UploadTask.prototype.addObserver_ = function (observer) {\r\n        this.observers_.push(observer);\r\n        this.notifyObserver_(observer);\r\n    };\r\n    /**\r\n     * Removes the given observer.\r\n     */\r\n    UploadTask.prototype.removeObserver_ = function (observer) {\r\n        var i = this.observers_.indexOf(observer);\r\n        if (i !== -1) {\r\n            this.observers_.splice(i, 1);\r\n        }\r\n    };\r\n    UploadTask.prototype.notifyObservers_ = function () {\r\n        var _this = this;\r\n        this.finishPromise_();\r\n        var observers = this.observers_.slice();\r\n        observers.forEach(function (observer) {\r\n            _this.notifyObserver_(observer);\r\n        });\r\n    };\r\n    UploadTask.prototype.finishPromise_ = function () {\r\n        if (this.resolve_ !== null) {\r\n            var triggered = true;\r\n            switch (taskStateFromInternalTaskState(this.state_)) {\r\n                case TaskState.SUCCESS:\r\n                    async(this.resolve_.bind(null, this.snapshot))();\r\n                    break;\r\n                case TaskState.CANCELED:\r\n                case TaskState.ERROR:\r\n                    var toCall = this.reject_;\r\n                    async(toCall.bind(null, this.error_))();\r\n                    break;\r\n                default:\r\n                    triggered = false;\r\n                    break;\r\n            }\r\n            if (triggered) {\r\n                this.resolve_ = null;\r\n                this.reject_ = null;\r\n            }\r\n        }\r\n    };\r\n    UploadTask.prototype.notifyObserver_ = function (observer) {\r\n        var externalState = taskStateFromInternalTaskState(this.state_);\r\n        switch (externalState) {\r\n            case TaskState.RUNNING:\r\n            case TaskState.PAUSED:\r\n                if (observer.next) {\r\n                    async(observer.next.bind(observer, this.snapshot))();\r\n                }\r\n                break;\r\n            case TaskState.SUCCESS:\r\n                if (observer.complete) {\r\n                    async(observer.complete.bind(observer))();\r\n                }\r\n                break;\r\n            case TaskState.CANCELED:\r\n            case TaskState.ERROR:\r\n                if (observer.error) {\r\n                    async(observer.error.bind(observer, this.error_))();\r\n                }\r\n                break;\r\n            default:\r\n                // TODO(andysoto): assert(false);\r\n                if (observer.error) {\r\n                    async(observer.error.bind(observer, this.error_))();\r\n                }\r\n        }\r\n    };\r\n    /**\r\n     * Resumes a paused task. Has no effect on a currently running or failed task.\r\n     * @return True if the operation took effect, false if ignored.\r\n     */\r\n    UploadTask.prototype.resume = function () {\r\n        validate('resume', [], arguments);\r\n        var valid = this.state_ === InternalTaskState.PAUSED ||\r\n            this.state_ === InternalTaskState.PAUSING;\r\n        if (valid) {\r\n            this.transition_(InternalTaskState.RUNNING);\r\n        }\r\n        return valid;\r\n    };\r\n    /**\r\n     * Pauses a currently running task. Has no effect on a paused or failed task.\r\n     * @return True if the operation took effect, false if ignored.\r\n     */\r\n    UploadTask.prototype.pause = function () {\r\n        validate('pause', [], arguments);\r\n        var valid = this.state_ === InternalTaskState.RUNNING;\r\n        if (valid) {\r\n            this.transition_(InternalTaskState.PAUSING);\r\n        }\r\n        return valid;\r\n    };\r\n    /**\r\n     * Cancels a currently running or paused task. Has no effect on a complete or\r\n     * failed task.\r\n     * @return True if the operation took effect, false if ignored.\r\n     */\r\n    UploadTask.prototype.cancel = function () {\r\n        validate('cancel', [], arguments);\r\n        var valid = this.state_ === InternalTaskState.RUNNING ||\r\n            this.state_ === InternalTaskState.PAUSING;\r\n        if (valid) {\r\n            this.transition_(InternalTaskState.CANCELING);\r\n        }\r\n        return valid;\r\n    };\r\n    return UploadTask;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Provides methods to interact with a bucket in the Firebase Storage service.\r\n * @param location An fbs.location, or the URL at\r\n *     which to base this object, in one of the following forms:\r\n *         gs://<bucket>/<object-path>\r\n *         http[s]://firebasestorage.googleapis.com/\r\n *                     <api-version>/b/<bucket>/o/<object-path>\r\n *     Any query or fragment strings will be ignored in the http[s]\r\n *     format. If no value is passed, the storage object will use a URL based on\r\n *     the project ID of the base firebase.App instance.\r\n */\r\nvar Reference = /** @class */ (function () {\r\n    function Reference(authWrapper, location) {\r\n        this.authWrapper = authWrapper;\r\n        if (location instanceof Location) {\r\n            this.location = location;\r\n        }\r\n        else {\r\n            this.location = Location.makeFromUrl(location);\r\n        }\r\n    }\r\n    /**\r\n     * @return The URL for the bucket and path this object references,\r\n     *     in the form gs://<bucket>/<object-path>\r\n     * @override\r\n     */\r\n    Reference.prototype.toString = function () {\r\n        validate('toString', [], arguments);\r\n        return 'gs://' + this.location.bucket + '/' + this.location.path;\r\n    };\r\n    Reference.prototype.newRef = function (authWrapper, location) {\r\n        return new Reference(authWrapper, location);\r\n    };\r\n    Reference.prototype.mappings = function () {\r\n        return getMappings();\r\n    };\r\n    /**\r\n     * @return A reference to the object obtained by\r\n     *     appending childPath, removing any duplicate, beginning, or trailing\r\n     *     slashes.\r\n     */\r\n    Reference.prototype.child = function (childPath) {\r\n        validate('child', [stringSpec()], arguments);\r\n        var newPath = child(this.location.path, childPath);\r\n        var location = new Location(this.location.bucket, newPath);\r\n        return this.newRef(this.authWrapper, location);\r\n    };\r\n    Object.defineProperty(Reference.prototype, \"parent\", {\r\n        /**\r\n         * @return A reference to the parent of the\r\n         *     current object, or null if the current object is the root.\r\n         */\r\n        get: function () {\r\n            var newPath = parent(this.location.path);\r\n            if (newPath === null) {\r\n                return null;\r\n            }\r\n            var location = new Location(this.location.bucket, newPath);\r\n            return this.newRef(this.authWrapper, location);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Reference.prototype, \"root\", {\r\n        /**\r\n         * @return An reference to the root of this\r\n         *     object's bucket.\r\n         */\r\n        get: function () {\r\n            var location = new Location(this.location.bucket, '');\r\n            return this.newRef(this.authWrapper, location);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Reference.prototype, \"bucket\", {\r\n        get: function () {\r\n            return this.location.bucket;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Reference.prototype, \"fullPath\", {\r\n        get: function () {\r\n            return this.location.path;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Reference.prototype, \"name\", {\r\n        get: function () {\r\n            return lastComponent(this.location.path);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Reference.prototype, \"storage\", {\r\n        get: function () {\r\n            return this.authWrapper.service();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Uploads a blob to this object's location.\r\n     * @param data The blob to upload.\r\n     * @return An UploadTask that lets you control and\r\n     *     observe the upload.\r\n     */\r\n    Reference.prototype.put = function (data, metadata) {\r\n        if (metadata === void 0) { metadata = null; }\r\n        validate('put', [uploadDataSpec(), metadataSpec(true)], arguments);\r\n        this.throwIfRoot_('put');\r\n        return new UploadTask(this, this.authWrapper, this.location, this.mappings(), new FbsBlob(data), metadata);\r\n    };\r\n    /**\r\n     * Uploads a string to this object's location.\r\n     * @param value The string to upload.\r\n     * @param format The format of the string to upload.\r\n     * @return An UploadTask that lets you control and\r\n     *     observe the upload.\r\n     */\r\n    Reference.prototype.putString = function (value, format, metadata) {\r\n        if (format === void 0) { format = StringFormat.RAW; }\r\n        validate('putString', [stringSpec(), stringSpec(formatValidator, true), metadataSpec(true)], arguments);\r\n        this.throwIfRoot_('putString');\r\n        var data = dataFromString(format, value);\r\n        var metadataClone = Object.assign({}, metadata);\r\n        if (!isDef(metadataClone['contentType']) &&\r\n            isDef(data.contentType)) {\r\n            metadataClone['contentType'] = data.contentType;\r\n        }\r\n        return new UploadTask(this, this.authWrapper, this.location, this.mappings(), new FbsBlob(data.data, true), metadataClone);\r\n    };\r\n    /**\r\n     * Deletes the object at this location.\r\n     * @return A promise that resolves if the deletion succeeds.\r\n     */\r\n    Reference.prototype.delete = function () {\r\n        var _this = this;\r\n        validate('delete', [], arguments);\r\n        this.throwIfRoot_('delete');\r\n        return this.authWrapper.getAuthToken().then(function (authToken) {\r\n            var requestInfo = deleteObject(_this.authWrapper, _this.location);\r\n            return _this.authWrapper.makeRequest(requestInfo, authToken).getPromise();\r\n        });\r\n    };\r\n    /**\r\n     * List all items (files) and prefixes (folders) under this storage reference.\r\n     *\r\n     * This is a helper method for calling list() repeatedly until there are\r\n     * no more results. The default pagination size is 1000.\r\n     *\r\n     * Note: The results may not be consistent if objects are changed while this\r\n     * operation is running.\r\n     *\r\n     * Warning: listAll may potentially consume too many resources if there are\r\n     * too many results.\r\n     *\r\n     * @return A Promise that resolves with all the items and prefixes under\r\n     *      the current storage reference. `prefixes` contains references to\r\n     *      sub-directories and `items` contains references to objects in this\r\n     *      folder. `nextPageToken` is never returned.\r\n     */\r\n    Reference.prototype.listAll = function () {\r\n        validate('listAll', [], arguments);\r\n        var accumulator = {\r\n            prefixes: [],\r\n            items: []\r\n        };\r\n        return this.listAllHelper(accumulator).then(function () { return accumulator; });\r\n    };\r\n    Reference.prototype.listAllHelper = function (accumulator, pageToken) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var opt, nextPage;\r\n            var _a, _b;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        opt = {\r\n                            // maxResults is 1000 by default.\r\n                            pageToken: pageToken\r\n                        };\r\n                        return [4 /*yield*/, this.list(opt)];\r\n                    case 1:\r\n                        nextPage = _c.sent();\r\n                        (_a = accumulator.prefixes).push.apply(_a, nextPage.prefixes);\r\n                        (_b = accumulator.items).push.apply(_b, nextPage.items);\r\n                        if (!(nextPage.nextPageToken != null)) return [3 /*break*/, 3];\r\n                        return [4 /*yield*/, this.listAllHelper(accumulator, nextPage.nextPageToken)];\r\n                    case 2:\r\n                        _c.sent();\r\n                        _c.label = 3;\r\n                    case 3: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * List items (files) and prefixes (folders) under this storage reference.\r\n     *\r\n     * List API is only available for Firebase Rules Version 2.\r\n     *\r\n     * GCS is a key-blob store. Firebase Storage imposes the semantic of '/'\r\n     * delimited folder structure.\r\n     * Refer to GCS's List API if you want to learn more.\r\n     *\r\n     * To adhere to Firebase Rules's Semantics, Firebase Storage does not\r\n     * support objects whose paths end with \"/\" or contain two consecutive\r\n     * \"/\"s. Firebase Storage List API will filter these unsupported objects.\r\n     * list() may fail if there are too many unsupported objects in the bucket.\r\n     *\r\n     * @param options See ListOptions for details.\r\n     * @return A Promise that resolves with the items and prefixes.\r\n     *      `prefixes` contains references to sub-folders and `items`\r\n     *      contains references to objects in this folder. `nextPageToken`\r\n     *      can be used to get the rest of the results.\r\n     */\r\n    Reference.prototype.list = function (options) {\r\n        validate('list', [listOptionSpec(true)], arguments);\r\n        var self = this;\r\n        return this.authWrapper.getAuthToken().then(function (authToken) {\r\n            var op = options || {};\r\n            var requestInfo = list(self.authWrapper, self.location, \r\n            /*delimiter= */ '/', op.pageToken, op.maxResults);\r\n            return self.authWrapper.makeRequest(requestInfo, authToken).getPromise();\r\n        });\r\n    };\r\n    /**\r\n     *     A promise that resolves with the metadata for this object. If this\r\n     *     object doesn't exist or metadata cannot be retreived, the promise is\r\n     *     rejected.\r\n     */\r\n    Reference.prototype.getMetadata = function () {\r\n        var _this = this;\r\n        validate('getMetadata', [], arguments);\r\n        this.throwIfRoot_('getMetadata');\r\n        return this.authWrapper.getAuthToken().then(function (authToken) {\r\n            var requestInfo = getMetadata(_this.authWrapper, _this.location, _this.mappings());\r\n            return _this.authWrapper.makeRequest(requestInfo, authToken).getPromise();\r\n        });\r\n    };\r\n    /**\r\n     * Updates the metadata for this object.\r\n     * @param metadata The new metadata for the object.\r\n     *     Only values that have been explicitly set will be changed. Explicitly\r\n     *     setting a value to null will remove the metadata.\r\n     * @return A promise that resolves\r\n     *     with the new metadata for this object.\r\n     *     @see firebaseStorage.Reference.prototype.getMetadata\r\n     */\r\n    Reference.prototype.updateMetadata = function (metadata) {\r\n        var _this = this;\r\n        validate('updateMetadata', [metadataSpec()], arguments);\r\n        this.throwIfRoot_('updateMetadata');\r\n        return this.authWrapper.getAuthToken().then(function (authToken) {\r\n            var requestInfo = updateMetadata(_this.authWrapper, _this.location, metadata, _this.mappings());\r\n            return _this.authWrapper.makeRequest(requestInfo, authToken).getPromise();\r\n        });\r\n    };\r\n    /**\r\n     * @return A promise that resolves with the download\r\n     *     URL for this object.\r\n     */\r\n    Reference.prototype.getDownloadURL = function () {\r\n        var _this = this;\r\n        validate('getDownloadURL', [], arguments);\r\n        this.throwIfRoot_('getDownloadURL');\r\n        return this.authWrapper.getAuthToken().then(function (authToken) {\r\n            var requestInfo = getDownloadUrl(_this.authWrapper, _this.location, _this.mappings());\r\n            return _this.authWrapper\r\n                .makeRequest(requestInfo, authToken)\r\n                .getPromise()\r\n                .then(function (url) {\r\n                if (url === null) {\r\n                    throw noDownloadURL();\r\n                }\r\n                return url;\r\n            });\r\n        });\r\n    };\r\n    Reference.prototype.throwIfRoot_ = function (name) {\r\n        if (this.location.path === '') {\r\n            throw invalidRootOperation(name);\r\n        }\r\n    };\r\n    return Reference;\r\n}());\n\n/**\r\n * A request whose promise always fails.\r\n * @struct\r\n * @template T\r\n */\r\nvar FailRequest = /** @class */ (function () {\r\n    function FailRequest(error) {\r\n        this.promise_ = Promise.reject(error);\r\n    }\r\n    /** @inheritDoc */\r\n    FailRequest.prototype.getPromise = function () {\r\n        return this.promise_;\r\n    };\r\n    /** @inheritDoc */\r\n    FailRequest.prototype.cancel = function (_appDelete) {\r\n    };\r\n    return FailRequest;\r\n}());\n\nvar RequestMap = /** @class */ (function () {\r\n    function RequestMap() {\r\n        this.map = new Map();\r\n        this.id = MIN_SAFE_INTEGER;\r\n    }\r\n    /**\r\n     * Registers the given request with this map.\r\n     * The request is unregistered when it completes.\r\n     *\r\n     * @param request The request to register.\r\n     */\r\n    RequestMap.prototype.addRequest = function (request) {\r\n        var _this = this;\r\n        var id = this.id;\r\n        this.id++;\r\n        this.map.set(id, request);\r\n        request.getPromise().then(function () { return _this.map.delete(id); }, function () { return _this.map.delete(id); });\r\n    };\r\n    /**\r\n     * Cancels all registered requests.\r\n     */\r\n    RequestMap.prototype.clear = function () {\r\n        this.map.forEach(function (v) {\r\n            v && v.cancel(true);\r\n        });\r\n        this.map.clear();\r\n    };\r\n    return RequestMap;\r\n}());\n\n/**\r\n * @param app If null, getAuthToken always resolves with null.\r\n * @param service The storage service associated with this auth wrapper.\r\n *     Untyped to avoid circular type dependencies.\r\n * @struct\r\n */\r\nvar AuthWrapper = /** @class */ (function () {\r\n    function AuthWrapper(app, authProvider, maker, requestMaker, service, pool) {\r\n        var _a;\r\n        this.bucket_ = null;\r\n        this.appId_ = null;\r\n        this.deleted_ = false;\r\n        this.app_ = app;\r\n        if (this.app_ !== null) {\r\n            var options = this.app_.options;\r\n            if (isDef(options)) {\r\n                this.bucket_ = AuthWrapper.extractBucket_(options);\r\n                this.appId_ = (_a = options.appId) !== null && _a !== void 0 ? _a : null;\r\n            }\r\n        }\r\n        this.authProvider_ = authProvider;\r\n        this.storageRefMaker_ = maker;\r\n        this.requestMaker_ = requestMaker;\r\n        this.pool_ = pool;\r\n        this.service_ = service;\r\n        this.maxOperationRetryTime_ = DEFAULT_MAX_OPERATION_RETRY_TIME;\r\n        this.maxUploadRetryTime_ = DEFAULT_MAX_UPLOAD_RETRY_TIME;\r\n        this.requestMap_ = new RequestMap();\r\n    }\r\n    AuthWrapper.extractBucket_ = function (config) {\r\n        var bucketString = config[CONFIG_STORAGE_BUCKET_KEY] || null;\r\n        if (bucketString == null) {\r\n            return null;\r\n        }\r\n        var loc = Location.makeFromBucketSpec(bucketString);\r\n        return loc.bucket;\r\n    };\r\n    AuthWrapper.prototype.getAuthToken = function () {\r\n        var auth = this.authProvider_.getImmediate({ optional: true });\r\n        if (auth) {\r\n            return auth.getToken().then(function (response) {\r\n                if (response !== null) {\r\n                    return response.accessToken;\r\n                }\r\n                else {\r\n                    return null;\r\n                }\r\n            }, function () { return null; });\r\n        }\r\n        else {\r\n            return Promise.resolve(null);\r\n        }\r\n    };\r\n    AuthWrapper.prototype.bucket = function () {\r\n        if (this.deleted_) {\r\n            throw appDeleted();\r\n        }\r\n        else {\r\n            return this.bucket_;\r\n        }\r\n    };\r\n    /**\r\n     * The service associated with this auth wrapper. Untyped to avoid circular\r\n     * type dependencies.\r\n     */\r\n    AuthWrapper.prototype.service = function () {\r\n        return this.service_;\r\n    };\r\n    /**\r\n     * Returns a new firebaseStorage.Reference object referencing this AuthWrapper\r\n     * at the given Location.\r\n     * @param loc The Location.\r\n     * @return Actually a firebaseStorage.Reference, typing not allowed\r\n     *     because of circular dependency problems.\r\n     */\r\n    AuthWrapper.prototype.makeStorageReference = function (loc) {\r\n        return this.storageRefMaker_(this, loc);\r\n    };\r\n    AuthWrapper.prototype.makeRequest = function (requestInfo, authToken) {\r\n        if (!this.deleted_) {\r\n            var request = this.requestMaker_(requestInfo, this.appId_, authToken, this.pool_);\r\n            this.requestMap_.addRequest(request);\r\n            return request;\r\n        }\r\n        else {\r\n            return new FailRequest(appDeleted());\r\n        }\r\n    };\r\n    /**\r\n     * Stop running requests and prevent more from being created.\r\n     */\r\n    AuthWrapper.prototype.deleteApp = function () {\r\n        this.deleted_ = true;\r\n        this.app_ = null;\r\n        this.requestMap_.clear();\r\n    };\r\n    AuthWrapper.prototype.maxUploadRetryTime = function () {\r\n        return this.maxUploadRetryTime_;\r\n    };\r\n    AuthWrapper.prototype.setMaxUploadRetryTime = function (time) {\r\n        this.maxUploadRetryTime_ = time;\r\n    };\r\n    AuthWrapper.prototype.maxOperationRetryTime = function () {\r\n        return this.maxOperationRetryTime_;\r\n    };\r\n    AuthWrapper.prototype.setMaxOperationRetryTime = function (time) {\r\n        this.maxOperationRetryTime_ = time;\r\n    };\r\n    return AuthWrapper;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @param f May be invoked\r\n *     before the function returns.\r\n * @param callback Get all the arguments passed to the function\r\n *     passed to f, including the initial boolean.\r\n */\r\nfunction start(f, callback, timeout) {\r\n    // TODO(andysoto): make this code cleaner (probably refactor into an actual\r\n    // type instead of a bunch of functions with state shared in the closure)\r\n    var waitSeconds = 1;\r\n    // Would type this as \"number\" but that doesn't work for Node so ¯\\_(ツ)_/¯\r\n    // TODO: find a way to exclude Node type definition for storage because storage only works in browser\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    var timeoutId = null;\r\n    var hitTimeout = false;\r\n    var cancelState = 0;\r\n    function canceled() {\r\n        return cancelState === 2;\r\n    }\r\n    var triggeredCallback = false;\r\n    // TODO: This disable can be removed and the 'ignoreRestArgs' option added to\r\n    // the no-explicit-any rule when ESlint releases it.\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    function triggerCallback() {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        if (!triggeredCallback) {\r\n            triggeredCallback = true;\r\n            callback.apply(null, args);\r\n        }\r\n    }\r\n    function callWithDelay(millis) {\r\n        timeoutId = setTimeout(function () {\r\n            timeoutId = null;\r\n            f(handler, canceled());\r\n        }, millis);\r\n    }\r\n    // TODO: This disable can be removed and the 'ignoreRestArgs' option added to\r\n    // the no-explicit-any rule when ESlint releases it.\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    function handler(success) {\r\n        var args = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            args[_i - 1] = arguments[_i];\r\n        }\r\n        if (triggeredCallback) {\r\n            return;\r\n        }\r\n        if (success) {\r\n            triggerCallback.call.apply(triggerCallback, __spreadArrays([null, success], args));\r\n            return;\r\n        }\r\n        var mustStop = canceled() || hitTimeout;\r\n        if (mustStop) {\r\n            triggerCallback.call.apply(triggerCallback, __spreadArrays([null, success], args));\r\n            return;\r\n        }\r\n        if (waitSeconds < 64) {\r\n            /* TODO(andysoto): don't back off so quickly if we know we're offline. */\r\n            waitSeconds *= 2;\r\n        }\r\n        var waitMillis;\r\n        if (cancelState === 1) {\r\n            cancelState = 2;\r\n            waitMillis = 0;\r\n        }\r\n        else {\r\n            waitMillis = (waitSeconds + Math.random()) * 1000;\r\n        }\r\n        callWithDelay(waitMillis);\r\n    }\r\n    var stopped = false;\r\n    function stop(wasTimeout) {\r\n        if (stopped) {\r\n            return;\r\n        }\r\n        stopped = true;\r\n        if (triggeredCallback) {\r\n            return;\r\n        }\r\n        if (timeoutId !== null) {\r\n            if (!wasTimeout) {\r\n                cancelState = 2;\r\n            }\r\n            clearTimeout(timeoutId);\r\n            callWithDelay(0);\r\n        }\r\n        else {\r\n            if (!wasTimeout) {\r\n                cancelState = 1;\r\n            }\r\n        }\r\n    }\r\n    callWithDelay(0);\r\n    setTimeout(function () {\r\n        hitTimeout = true;\r\n        stop(true);\r\n    }, timeout);\r\n    return stop;\r\n}\r\n/**\r\n * Stops the retry loop from repeating.\r\n * If the function is currently \"in between\" retries, it is invoked immediately\r\n * with the second parameter as \"true\". Otherwise, it will be invoked once more\r\n * after the current invocation finishes iff the current invocation would have\r\n * triggered another retry.\r\n */\r\nfunction stop(id) {\r\n    id(false);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @struct\r\n * @template T\r\n */\r\nvar NetworkRequest = /** @class */ (function () {\r\n    function NetworkRequest(url, method, headers, body, successCodes, additionalRetryCodes, callback, errorCallback, timeout, progressCallback, pool) {\r\n        var _this = this;\r\n        this.pendingXhr_ = null;\r\n        this.backoffId_ = null;\r\n        this.resolve_ = null;\r\n        this.reject_ = null;\r\n        this.canceled_ = false;\r\n        this.appDelete_ = false;\r\n        this.url_ = url;\r\n        this.method_ = method;\r\n        this.headers_ = headers;\r\n        this.body_ = body;\r\n        this.successCodes_ = successCodes.slice();\r\n        this.additionalRetryCodes_ = additionalRetryCodes.slice();\r\n        this.callback_ = callback;\r\n        this.errorCallback_ = errorCallback;\r\n        this.progressCallback_ = progressCallback;\r\n        this.timeout_ = timeout;\r\n        this.pool_ = pool;\r\n        this.promise_ = new Promise(function (resolve, reject) {\r\n            _this.resolve_ = resolve;\r\n            _this.reject_ = reject;\r\n            _this.start_();\r\n        });\r\n    }\r\n    /**\r\n     * Actually starts the retry loop.\r\n     */\r\n    NetworkRequest.prototype.start_ = function () {\r\n        var self = this;\r\n        function doTheRequest(backoffCallback, canceled) {\r\n            if (canceled) {\r\n                backoffCallback(false, new RequestEndStatus(false, null, true));\r\n                return;\r\n            }\r\n            var xhr = self.pool_.createXhrIo();\r\n            self.pendingXhr_ = xhr;\r\n            function progressListener(progressEvent) {\r\n                var loaded = progressEvent.loaded;\r\n                var total = progressEvent.lengthComputable ? progressEvent.total : -1;\r\n                if (self.progressCallback_ !== null) {\r\n                    self.progressCallback_(loaded, total);\r\n                }\r\n            }\r\n            if (self.progressCallback_ !== null) {\r\n                xhr.addUploadProgressListener(progressListener);\r\n            }\r\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n            xhr\r\n                .send(self.url_, self.method_, self.body_, self.headers_)\r\n                .then(function (xhr) {\r\n                if (self.progressCallback_ !== null) {\r\n                    xhr.removeUploadProgressListener(progressListener);\r\n                }\r\n                self.pendingXhr_ = null;\r\n                xhr = xhr;\r\n                var hitServer = xhr.getErrorCode() === ErrorCode.NO_ERROR;\r\n                var status = xhr.getStatus();\r\n                if (!hitServer || self.isRetryStatusCode_(status)) {\r\n                    var wasCanceled = xhr.getErrorCode() === ErrorCode.ABORT;\r\n                    backoffCallback(false, new RequestEndStatus(false, null, wasCanceled));\r\n                    return;\r\n                }\r\n                var successCode = self.successCodes_.indexOf(status) !== -1;\r\n                backoffCallback(true, new RequestEndStatus(successCode, xhr));\r\n            });\r\n        }\r\n        /**\r\n         * @param requestWentThrough True if the request eventually went\r\n         *     through, false if it hit the retry limit or was canceled.\r\n         */\r\n        function backoffDone(requestWentThrough, status) {\r\n            var resolve = self.resolve_;\r\n            var reject = self.reject_;\r\n            var xhr = status.xhr;\r\n            if (status.wasSuccessCode) {\r\n                try {\r\n                    var result = self.callback_(xhr, xhr.getResponseText());\r\n                    if (isJustDef(result)) {\r\n                        resolve(result);\r\n                    }\r\n                    else {\r\n                        resolve();\r\n                    }\r\n                }\r\n                catch (e) {\r\n                    reject(e);\r\n                }\r\n            }\r\n            else {\r\n                if (xhr !== null) {\r\n                    var err = unknown();\r\n                    err.setServerResponseProp(xhr.getResponseText());\r\n                    if (self.errorCallback_) {\r\n                        reject(self.errorCallback_(xhr, err));\r\n                    }\r\n                    else {\r\n                        reject(err);\r\n                    }\r\n                }\r\n                else {\r\n                    if (status.canceled) {\r\n                        var err = self.appDelete_ ? appDeleted() : canceled();\r\n                        reject(err);\r\n                    }\r\n                    else {\r\n                        var err = retryLimitExceeded();\r\n                        reject(err);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (this.canceled_) {\r\n            backoffDone(false, new RequestEndStatus(false, null, true));\r\n        }\r\n        else {\r\n            this.backoffId_ = start(doTheRequest, backoffDone, this.timeout_);\r\n        }\r\n    };\r\n    /** @inheritDoc */\r\n    NetworkRequest.prototype.getPromise = function () {\r\n        return this.promise_;\r\n    };\r\n    /** @inheritDoc */\r\n    NetworkRequest.prototype.cancel = function (appDelete) {\r\n        this.canceled_ = true;\r\n        this.appDelete_ = appDelete || false;\r\n        if (this.backoffId_ !== null) {\r\n            stop(this.backoffId_);\r\n        }\r\n        if (this.pendingXhr_ !== null) {\r\n            this.pendingXhr_.abort();\r\n        }\r\n    };\r\n    NetworkRequest.prototype.isRetryStatusCode_ = function (status) {\r\n        // The codes for which to retry came from this page:\r\n        // https://cloud.google.com/storage/docs/exponential-backoff\r\n        var isFiveHundredCode = status >= 500 && status < 600;\r\n        var extraRetryCodes = [\r\n            // Request Timeout: web server didn't receive full request in time.\r\n            408,\r\n            // Too Many Requests: you're getting rate-limited, basically.\r\n            429\r\n        ];\r\n        var isExtraRetryCode = extraRetryCodes.indexOf(status) !== -1;\r\n        var isRequestSpecificRetryCode = this.additionalRetryCodes_.indexOf(status) !== -1;\r\n        return isFiveHundredCode || isExtraRetryCode || isRequestSpecificRetryCode;\r\n    };\r\n    return NetworkRequest;\r\n}());\r\n/**\r\n * A collection of information about the result of a network request.\r\n * @param opt_canceled Defaults to false.\r\n * @struct\r\n */\r\nvar RequestEndStatus = /** @class */ (function () {\r\n    function RequestEndStatus(wasSuccessCode, xhr, canceled) {\r\n        this.wasSuccessCode = wasSuccessCode;\r\n        this.xhr = xhr;\r\n        this.canceled = !!canceled;\r\n    }\r\n    return RequestEndStatus;\r\n}());\r\nfunction addAuthHeader_(headers, authToken) {\r\n    if (authToken !== null && authToken.length > 0) {\r\n        headers['Authorization'] = 'Firebase ' + authToken;\r\n    }\r\n}\r\nfunction addVersionHeader_(headers) {\r\n    var version = typeof firebase !== 'undefined' ? firebase.SDK_VERSION : 'AppManager';\r\n    headers['X-Firebase-Storage-Version'] = 'webjs/' + version;\r\n}\r\nfunction addGmpidHeader_(headers, appId) {\r\n    if (appId) {\r\n        headers['X-Firebase-GMPID'] = appId;\r\n    }\r\n}\r\n/**\r\n * @template T\r\n */\r\nfunction makeRequest(requestInfo, appId, authToken, pool) {\r\n    var queryPart = makeQueryString(requestInfo.urlParams);\r\n    var url = requestInfo.url + queryPart;\r\n    var headers = Object.assign({}, requestInfo.headers);\r\n    addGmpidHeader_(headers, appId);\r\n    addAuthHeader_(headers, authToken);\r\n    addVersionHeader_(headers);\r\n    return new NetworkRequest(url, requestInfo.method, headers, requestInfo.body, requestInfo.successCodes, requestInfo.additionalRetryCodes, requestInfo.handler, requestInfo.errorHandler, requestInfo.timeout, requestInfo.progressCallback, pool);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * A service that provides firebaseStorage.Reference instances.\r\n * @param opt_url gs:// url to a custom Storage Bucket\r\n *\r\n * @struct\r\n */\r\nvar Service = /** @class */ (function () {\r\n    function Service(app, authProvider, pool, url) {\r\n        this.bucket_ = null;\r\n        function maker(authWrapper, loc) {\r\n            return new Reference(authWrapper, loc);\r\n        }\r\n        this.authWrapper_ = new AuthWrapper(app, authProvider, maker, makeRequest, this, pool);\r\n        this.app_ = app;\r\n        if (url != null) {\r\n            this.bucket_ = Location.makeFromBucketSpec(url);\r\n        }\r\n        else {\r\n            var authWrapperBucket = this.authWrapper_.bucket();\r\n            if (authWrapperBucket != null) {\r\n                this.bucket_ = new Location(authWrapperBucket, '');\r\n            }\r\n        }\r\n        this.internals_ = new ServiceInternals(this);\r\n    }\r\n    /**\r\n     * Returns a firebaseStorage.Reference for the given path in the default\r\n     * bucket.\r\n     */\r\n    Service.prototype.ref = function (path) {\r\n        function validator(path) {\r\n            if (typeof path !== 'string') {\r\n                throw 'Path is not a string.';\r\n            }\r\n            if (/^[A-Za-z]+:\\/\\//.test(path)) {\r\n                throw 'Expected child path but got a URL, use refFromURL instead.';\r\n            }\r\n        }\r\n        validate('ref', [stringSpec(validator, true)], arguments);\r\n        if (this.bucket_ == null) {\r\n            throw new Error('No Storage Bucket defined in Firebase Options.');\r\n        }\r\n        var ref = new Reference(this.authWrapper_, this.bucket_);\r\n        if (path != null) {\r\n            return ref.child(path);\r\n        }\r\n        else {\r\n            return ref;\r\n        }\r\n    };\r\n    /**\r\n     * Returns a firebaseStorage.Reference object for the given absolute URL,\r\n     * which must be a gs:// or http[s]:// URL.\r\n     */\r\n    Service.prototype.refFromURL = function (url) {\r\n        function validator(p) {\r\n            if (typeof p !== 'string') {\r\n                throw 'Path is not a string.';\r\n            }\r\n            if (!/^[A-Za-z]+:\\/\\//.test(p)) {\r\n                throw 'Expected full URL but got a child path, use ref instead.';\r\n            }\r\n            try {\r\n                Location.makeFromUrl(p);\r\n            }\r\n            catch (e) {\r\n                throw 'Expected valid full URL but got an invalid one.';\r\n            }\r\n        }\r\n        validate('refFromURL', [stringSpec(validator, false)], arguments);\r\n        return new Reference(this.authWrapper_, url);\r\n    };\r\n    Object.defineProperty(Service.prototype, \"maxUploadRetryTime\", {\r\n        get: function () {\r\n            return this.authWrapper_.maxUploadRetryTime();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Service.prototype.setMaxUploadRetryTime = function (time) {\r\n        validate('setMaxUploadRetryTime', [nonNegativeNumberSpec()], arguments);\r\n        this.authWrapper_.setMaxUploadRetryTime(time);\r\n    };\r\n    Service.prototype.setMaxOperationRetryTime = function (time) {\r\n        validate('setMaxOperationRetryTime', [nonNegativeNumberSpec()], arguments);\r\n        this.authWrapper_.setMaxOperationRetryTime(time);\r\n    };\r\n    Object.defineProperty(Service.prototype, \"app\", {\r\n        get: function () {\r\n            return this.app_;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Service.prototype, \"INTERNAL\", {\r\n        get: function () {\r\n            return this.internals_;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return Service;\r\n}());\r\n/**\r\n * @struct\r\n */\r\nvar ServiceInternals = /** @class */ (function () {\r\n    function ServiceInternals(service) {\r\n        this.service_ = service;\r\n    }\r\n    /**\r\n     * Called when the associated app is deleted.\r\n     * @see {!fbs.AuthWrapper.prototype.deleteApp}\r\n     */\r\n    ServiceInternals.prototype.delete = function () {\r\n        this.service_.authWrapper_.deleteApp();\r\n        return Promise.resolve();\r\n    };\r\n    return ServiceInternals;\r\n}());\n\nvar name = \"@firebase/storage\";\nvar version = \"0.3.35\";\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Type constant for Firebase Storage.\r\n */\r\nvar STORAGE_TYPE = 'storage';\r\nfunction factory(container, url) {\r\n    // Dependencies\r\n    var app = container.getProvider('app').getImmediate();\r\n    var authProvider = container.getProvider('auth-internal');\r\n    return new Service(app, authProvider, new XhrIoPool(), url);\r\n}\r\nfunction registerStorage(instance) {\r\n    var namespaceExports = {\r\n        // no-inline\r\n        TaskState: TaskState,\r\n        TaskEvent: TaskEvent,\r\n        StringFormat: StringFormat,\r\n        Storage: Service,\r\n        Reference: Reference\r\n    };\r\n    instance.INTERNAL.registerComponent(new Component(STORAGE_TYPE, factory, \"PUBLIC\" /* PUBLIC */)\r\n        .setServiceProps(namespaceExports)\r\n        .setMultipleInstances(true));\r\n    instance.registerVersion(name, version);\r\n}\r\nregisterStorage(firebase);\n\nexport { registerStorage };\n//# sourceMappingURL=index.esm.js.map\n","'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar tslib = require('tslib');\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @fileoverview Firebase constants.  Some of these (@defines) can be overridden at compile-time.\r\n */\r\nvar CONSTANTS = {\r\n    /**\r\n     * @define {boolean} Whether this is the client Node.js SDK.\r\n     */\r\n    NODE_CLIENT: false,\r\n    /**\r\n     * @define {boolean} Whether this is the Admin Node.js SDK.\r\n     */\r\n    NODE_ADMIN: false,\r\n    /**\r\n     * Firebase SDK Version\r\n     */\r\n    SDK_VERSION: '${JSCORE_VERSION}'\r\n};\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Throws an error if the provided assertion is falsy\r\n */\r\nvar assert = function (assertion, message) {\r\n    if (!assertion) {\r\n        throw assertionError(message);\r\n    }\r\n};\r\n/**\r\n * Returns an Error object suitable for throwing.\r\n */\r\nvar assertionError = function (message) {\r\n    return new Error('Firebase Database (' +\r\n        CONSTANTS.SDK_VERSION +\r\n        ') INTERNAL ASSERT FAILED: ' +\r\n        message);\r\n};\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar stringToByteArray = function (str) {\r\n    // TODO(user): Use native implementations if/when available\r\n    var out = [];\r\n    var p = 0;\r\n    for (var i = 0; i < str.length; i++) {\r\n        var c = str.charCodeAt(i);\r\n        if (c < 128) {\r\n            out[p++] = c;\r\n        }\r\n        else if (c < 2048) {\r\n            out[p++] = (c >> 6) | 192;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n        else if ((c & 0xfc00) === 0xd800 &&\r\n            i + 1 < str.length &&\r\n            (str.charCodeAt(i + 1) & 0xfc00) === 0xdc00) {\r\n            // Surrogate Pair\r\n            c = 0x10000 + ((c & 0x03ff) << 10) + (str.charCodeAt(++i) & 0x03ff);\r\n            out[p++] = (c >> 18) | 240;\r\n            out[p++] = ((c >> 12) & 63) | 128;\r\n            out[p++] = ((c >> 6) & 63) | 128;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n        else {\r\n            out[p++] = (c >> 12) | 224;\r\n            out[p++] = ((c >> 6) & 63) | 128;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n    }\r\n    return out;\r\n};\r\n/**\r\n * Turns an array of numbers into the string given by the concatenation of the\r\n * characters to which the numbers correspond.\r\n * @param bytes Array of numbers representing characters.\r\n * @return Stringification of the array.\r\n */\r\nvar byteArrayToString = function (bytes) {\r\n    // TODO(user): Use native implementations if/when available\r\n    var out = [];\r\n    var pos = 0, c = 0;\r\n    while (pos < bytes.length) {\r\n        var c1 = bytes[pos++];\r\n        if (c1 < 128) {\r\n            out[c++] = String.fromCharCode(c1);\r\n        }\r\n        else if (c1 > 191 && c1 < 224) {\r\n            var c2 = bytes[pos++];\r\n            out[c++] = String.fromCharCode(((c1 & 31) << 6) | (c2 & 63));\r\n        }\r\n        else if (c1 > 239 && c1 < 365) {\r\n            // Surrogate Pair\r\n            var c2 = bytes[pos++];\r\n            var c3 = bytes[pos++];\r\n            var c4 = bytes[pos++];\r\n            var u = (((c1 & 7) << 18) | ((c2 & 63) << 12) | ((c3 & 63) << 6) | (c4 & 63)) -\r\n                0x10000;\r\n            out[c++] = String.fromCharCode(0xd800 + (u >> 10));\r\n            out[c++] = String.fromCharCode(0xdc00 + (u & 1023));\r\n        }\r\n        else {\r\n            var c2 = bytes[pos++];\r\n            var c3 = bytes[pos++];\r\n            out[c++] = String.fromCharCode(((c1 & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));\r\n        }\r\n    }\r\n    return out.join('');\r\n};\r\n// We define it as an object literal instead of a class because a class compiled down to es5 can't\r\n// be treeshaked. https://github.com/rollup/rollup/issues/1691\r\n// Static lookup maps, lazily populated by init_()\r\nvar base64 = {\r\n    /**\r\n     * Maps bytes to characters.\r\n     */\r\n    byteToCharMap_: null,\r\n    /**\r\n     * Maps characters to bytes.\r\n     */\r\n    charToByteMap_: null,\r\n    /**\r\n     * Maps bytes to websafe characters.\r\n     * @private\r\n     */\r\n    byteToCharMapWebSafe_: null,\r\n    /**\r\n     * Maps websafe characters to bytes.\r\n     * @private\r\n     */\r\n    charToByteMapWebSafe_: null,\r\n    /**\r\n     * Our default alphabet, shared between\r\n     * ENCODED_VALS and ENCODED_VALS_WEBSAFE\r\n     */\r\n    ENCODED_VALS_BASE: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' + 'abcdefghijklmnopqrstuvwxyz' + '0123456789',\r\n    /**\r\n     * Our default alphabet. Value 64 (=) is special; it means \"nothing.\"\r\n     */\r\n    get ENCODED_VALS() {\r\n        return this.ENCODED_VALS_BASE + '+/=';\r\n    },\r\n    /**\r\n     * Our websafe alphabet.\r\n     */\r\n    get ENCODED_VALS_WEBSAFE() {\r\n        return this.ENCODED_VALS_BASE + '-_.';\r\n    },\r\n    /**\r\n     * Whether this browser supports the atob and btoa functions. This extension\r\n     * started at Mozilla but is now implemented by many browsers. We use the\r\n     * ASSUME_* variables to avoid pulling in the full useragent detection library\r\n     * but still allowing the standard per-browser compilations.\r\n     *\r\n     */\r\n    HAS_NATIVE_SUPPORT: typeof atob === 'function',\r\n    /**\r\n     * Base64-encode an array of bytes.\r\n     *\r\n     * @param input An array of bytes (numbers with\r\n     *     value in [0, 255]) to encode.\r\n     * @param webSafe Boolean indicating we should use the\r\n     *     alternative alphabet.\r\n     * @return The base64 encoded string.\r\n     */\r\n    encodeByteArray: function (input, webSafe) {\r\n        if (!Array.isArray(input)) {\r\n            throw Error('encodeByteArray takes an array as a parameter');\r\n        }\r\n        this.init_();\r\n        var byteToCharMap = webSafe\r\n            ? this.byteToCharMapWebSafe_\r\n            : this.byteToCharMap_;\r\n        var output = [];\r\n        for (var i = 0; i < input.length; i += 3) {\r\n            var byte1 = input[i];\r\n            var haveByte2 = i + 1 < input.length;\r\n            var byte2 = haveByte2 ? input[i + 1] : 0;\r\n            var haveByte3 = i + 2 < input.length;\r\n            var byte3 = haveByte3 ? input[i + 2] : 0;\r\n            var outByte1 = byte1 >> 2;\r\n            var outByte2 = ((byte1 & 0x03) << 4) | (byte2 >> 4);\r\n            var outByte3 = ((byte2 & 0x0f) << 2) | (byte3 >> 6);\r\n            var outByte4 = byte3 & 0x3f;\r\n            if (!haveByte3) {\r\n                outByte4 = 64;\r\n                if (!haveByte2) {\r\n                    outByte3 = 64;\r\n                }\r\n            }\r\n            output.push(byteToCharMap[outByte1], byteToCharMap[outByte2], byteToCharMap[outByte3], byteToCharMap[outByte4]);\r\n        }\r\n        return output.join('');\r\n    },\r\n    /**\r\n     * Base64-encode a string.\r\n     *\r\n     * @param input A string to encode.\r\n     * @param webSafe If true, we should use the\r\n     *     alternative alphabet.\r\n     * @return The base64 encoded string.\r\n     */\r\n    encodeString: function (input, webSafe) {\r\n        // Shortcut for Mozilla browsers that implement\r\n        // a native base64 encoder in the form of \"btoa/atob\"\r\n        if (this.HAS_NATIVE_SUPPORT && !webSafe) {\r\n            return btoa(input);\r\n        }\r\n        return this.encodeByteArray(stringToByteArray(input), webSafe);\r\n    },\r\n    /**\r\n     * Base64-decode a string.\r\n     *\r\n     * @param input to decode.\r\n     * @param webSafe True if we should use the\r\n     *     alternative alphabet.\r\n     * @return string representing the decoded value.\r\n     */\r\n    decodeString: function (input, webSafe) {\r\n        // Shortcut for Mozilla browsers that implement\r\n        // a native base64 encoder in the form of \"btoa/atob\"\r\n        if (this.HAS_NATIVE_SUPPORT && !webSafe) {\r\n            return atob(input);\r\n        }\r\n        return byteArrayToString(this.decodeStringToByteArray(input, webSafe));\r\n    },\r\n    /**\r\n     * Base64-decode a string.\r\n     *\r\n     * In base-64 decoding, groups of four characters are converted into three\r\n     * bytes.  If the encoder did not apply padding, the input length may not\r\n     * be a multiple of 4.\r\n     *\r\n     * In this case, the last group will have fewer than 4 characters, and\r\n     * padding will be inferred.  If the group has one or two characters, it decodes\r\n     * to one byte.  If the group has three characters, it decodes to two bytes.\r\n     *\r\n     * @param input Input to decode.\r\n     * @param webSafe True if we should use the web-safe alphabet.\r\n     * @return bytes representing the decoded value.\r\n     */\r\n    decodeStringToByteArray: function (input, webSafe) {\r\n        this.init_();\r\n        var charToByteMap = webSafe\r\n            ? this.charToByteMapWebSafe_\r\n            : this.charToByteMap_;\r\n        var output = [];\r\n        for (var i = 0; i < input.length;) {\r\n            var byte1 = charToByteMap[input.charAt(i++)];\r\n            var haveByte2 = i < input.length;\r\n            var byte2 = haveByte2 ? charToByteMap[input.charAt(i)] : 0;\r\n            ++i;\r\n            var haveByte3 = i < input.length;\r\n            var byte3 = haveByte3 ? charToByteMap[input.charAt(i)] : 64;\r\n            ++i;\r\n            var haveByte4 = i < input.length;\r\n            var byte4 = haveByte4 ? charToByteMap[input.charAt(i)] : 64;\r\n            ++i;\r\n            if (byte1 == null || byte2 == null || byte3 == null || byte4 == null) {\r\n                throw Error();\r\n            }\r\n            var outByte1 = (byte1 << 2) | (byte2 >> 4);\r\n            output.push(outByte1);\r\n            if (byte3 !== 64) {\r\n                var outByte2 = ((byte2 << 4) & 0xf0) | (byte3 >> 2);\r\n                output.push(outByte2);\r\n                if (byte4 !== 64) {\r\n                    var outByte3 = ((byte3 << 6) & 0xc0) | byte4;\r\n                    output.push(outByte3);\r\n                }\r\n            }\r\n        }\r\n        return output;\r\n    },\r\n    /**\r\n     * Lazy static initialization function. Called before\r\n     * accessing any of the static map variables.\r\n     * @private\r\n     */\r\n    init_: function () {\r\n        if (!this.byteToCharMap_) {\r\n            this.byteToCharMap_ = {};\r\n            this.charToByteMap_ = {};\r\n            this.byteToCharMapWebSafe_ = {};\r\n            this.charToByteMapWebSafe_ = {};\r\n            // We want quick mappings back and forth, so we precompute two maps.\r\n            for (var i = 0; i < this.ENCODED_VALS.length; i++) {\r\n                this.byteToCharMap_[i] = this.ENCODED_VALS.charAt(i);\r\n                this.charToByteMap_[this.byteToCharMap_[i]] = i;\r\n                this.byteToCharMapWebSafe_[i] = this.ENCODED_VALS_WEBSAFE.charAt(i);\r\n                this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]] = i;\r\n                // Be forgiving when decoding and correctly decode both encodings.\r\n                if (i >= this.ENCODED_VALS_BASE.length) {\r\n                    this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)] = i;\r\n                    this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)] = i;\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n/**\r\n * URL-safe base64 encoding\r\n */\r\nvar base64Encode = function (str) {\r\n    var utf8Bytes = stringToByteArray(str);\r\n    return base64.encodeByteArray(utf8Bytes, true);\r\n};\r\n/**\r\n * URL-safe base64 decoding\r\n *\r\n * NOTE: DO NOT use the global atob() function - it does NOT support the\r\n * base64Url variant encoding.\r\n *\r\n * @param str To be decoded\r\n * @return Decoded result, if possible\r\n */\r\nvar base64Decode = function (str) {\r\n    try {\r\n        return base64.decodeString(str, true);\r\n    }\r\n    catch (e) {\r\n        console.error('base64Decode failed: ', e);\r\n    }\r\n    return null;\r\n};\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Do a deep-copy of basic JavaScript Objects or Arrays.\r\n */\r\nfunction deepCopy(value) {\r\n    return deepExtend(undefined, value);\r\n}\r\n/**\r\n * Copy properties from source to target (recursively allows extension\r\n * of Objects and Arrays).  Scalar values in the target are over-written.\r\n * If target is undefined, an object of the appropriate type will be created\r\n * (and returned).\r\n *\r\n * We recursively copy all child properties of plain Objects in the source- so\r\n * that namespace- like dictionaries are merged.\r\n *\r\n * Note that the target can be a function, in which case the properties in\r\n * the source Object are copied onto it as static properties of the Function.\r\n */\r\nfunction deepExtend(target, source) {\r\n    if (!(source instanceof Object)) {\r\n        return source;\r\n    }\r\n    switch (source.constructor) {\r\n        case Date:\r\n            // Treat Dates like scalars; if the target date object had any child\r\n            // properties - they will be lost!\r\n            var dateValue = source;\r\n            return new Date(dateValue.getTime());\r\n        case Object:\r\n            if (target === undefined) {\r\n                target = {};\r\n            }\r\n            break;\r\n        case Array:\r\n            // Always copy the array source and overwrite the target.\r\n            target = [];\r\n            break;\r\n        default:\r\n            // Not a plain Object - treat it as a scalar.\r\n            return source;\r\n    }\r\n    for (var prop in source) {\r\n        if (!source.hasOwnProperty(prop)) {\r\n            continue;\r\n        }\r\n        target[prop] = deepExtend(target[prop], source[prop]);\r\n    }\r\n    return target;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar Deferred = /** @class */ (function () {\r\n    function Deferred() {\r\n        var _this = this;\r\n        this.reject = function () { };\r\n        this.resolve = function () { };\r\n        this.promise = new Promise(function (resolve, reject) {\r\n            _this.resolve = resolve;\r\n            _this.reject = reject;\r\n        });\r\n    }\r\n    /**\r\n     * Our API internals are not promiseified and cannot because our callback APIs have subtle expectations around\r\n     * invoking promises inline, which Promises are forbidden to do. This method accepts an optional node-style callback\r\n     * and returns a node-style callback which will resolve or reject the Deferred's promise.\r\n     */\r\n    Deferred.prototype.wrapCallback = function (callback) {\r\n        var _this = this;\r\n        return function (error, value) {\r\n            if (error) {\r\n                _this.reject(error);\r\n            }\r\n            else {\r\n                _this.resolve(value);\r\n            }\r\n            if (typeof callback === 'function') {\r\n                // Attaching noop handler just in case developer wasn't expecting\r\n                // promises\r\n                _this.promise.catch(function () { });\r\n                // Some of our callbacks don't expect a value and our own tests\r\n                // assert that the parameter length is 1\r\n                if (callback.length === 1) {\r\n                    callback(error);\r\n                }\r\n                else {\r\n                    callback(error, value);\r\n                }\r\n            }\r\n        };\r\n    };\r\n    return Deferred;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns navigator.userAgent string or '' if it's not defined.\r\n * @return user agent string\r\n */\r\nfunction getUA() {\r\n    if (typeof navigator !== 'undefined' &&\r\n        typeof navigator['userAgent'] === 'string') {\r\n        return navigator['userAgent'];\r\n    }\r\n    else {\r\n        return '';\r\n    }\r\n}\r\n/**\r\n * Detect Cordova / PhoneGap / Ionic frameworks on a mobile device.\r\n *\r\n * Deliberately does not rely on checking `file://` URLs (as this fails PhoneGap\r\n * in the Ripple emulator) nor Cordova `onDeviceReady`, which would normally\r\n * wait for a callback.\r\n */\r\nfunction isMobileCordova() {\r\n    return (typeof window !== 'undefined' &&\r\n        // @ts-ignore Setting up an broadly applicable index signature for Window\r\n        // just to deal with this case would probably be a bad idea.\r\n        !!(window['cordova'] || window['phonegap'] || window['PhoneGap']) &&\r\n        /ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(getUA()));\r\n}\r\n/**\r\n * Detect Node.js.\r\n *\r\n * @return true if Node.js environment is detected.\r\n */\r\n// Node detection logic from: https://github.com/iliakan/detect-node/\r\nfunction isNode() {\r\n    try {\r\n        return (Object.prototype.toString.call(global.process) === '[object process]');\r\n    }\r\n    catch (e) {\r\n        return false;\r\n    }\r\n}\r\n/**\r\n * Detect Browser Environment\r\n */\r\nfunction isBrowser() {\r\n    return typeof self === 'object' && self.self === self;\r\n}\r\nfunction isBrowserExtension() {\r\n    var runtime = typeof chrome === 'object'\r\n        ? chrome.runtime\r\n        : typeof browser === 'object'\r\n            ? browser.runtime\r\n            : undefined;\r\n    return typeof runtime === 'object' && runtime.id !== undefined;\r\n}\r\n/**\r\n * Detect React Native.\r\n *\r\n * @return true if ReactNative environment is detected.\r\n */\r\nfunction isReactNative() {\r\n    return (typeof navigator === 'object' && navigator['product'] === 'ReactNative');\r\n}\r\n/** Detects Electron apps. */\r\nfunction isElectron() {\r\n    return getUA().indexOf('Electron/') >= 0;\r\n}\r\n/** Detects Internet Explorer. */\r\nfunction isIE() {\r\n    var ua = getUA();\r\n    return ua.indexOf('MSIE ') >= 0 || ua.indexOf('Trident/') >= 0;\r\n}\r\n/** Detects Universal Windows Platform apps. */\r\nfunction isUWP() {\r\n    return getUA().indexOf('MSAppHost/') >= 0;\r\n}\r\n/**\r\n * Detect whether the current SDK build is the Node version.\r\n *\r\n * @return true if it's the Node SDK build.\r\n */\r\nfunction isNodeSdk() {\r\n    return CONSTANTS.NODE_CLIENT === true || CONSTANTS.NODE_ADMIN === true;\r\n}\r\n/** Returns true if we are running in Safari. */\r\nfunction isSafari() {\r\n    return (!isNode() &&\r\n        navigator.userAgent.includes('Safari') &&\r\n        !navigator.userAgent.includes('Chrome'));\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar ERROR_NAME = 'FirebaseError';\r\n// Based on code from:\r\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error#Custom_Error_Types\r\nvar FirebaseError = /** @class */ (function (_super) {\r\n    tslib.__extends(FirebaseError, _super);\r\n    function FirebaseError(code, message) {\r\n        var _this = _super.call(this, message) || this;\r\n        _this.code = code;\r\n        _this.name = ERROR_NAME;\r\n        // Fix For ES5\r\n        // https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\r\n        Object.setPrototypeOf(_this, FirebaseError.prototype);\r\n        // Maintains proper stack trace for where our error was thrown.\r\n        // Only available on V8.\r\n        if (Error.captureStackTrace) {\r\n            Error.captureStackTrace(_this, ErrorFactory.prototype.create);\r\n        }\r\n        return _this;\r\n    }\r\n    return FirebaseError;\r\n}(Error));\r\nvar ErrorFactory = /** @class */ (function () {\r\n    function ErrorFactory(service, serviceName, errors) {\r\n        this.service = service;\r\n        this.serviceName = serviceName;\r\n        this.errors = errors;\r\n    }\r\n    ErrorFactory.prototype.create = function (code) {\r\n        var data = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            data[_i - 1] = arguments[_i];\r\n        }\r\n        var customData = data[0] || {};\r\n        var fullCode = this.service + \"/\" + code;\r\n        var template = this.errors[code];\r\n        var message = template ? replaceTemplate(template, customData) : 'Error';\r\n        // Service Name: Error message (service/code).\r\n        var fullMessage = this.serviceName + \": \" + message + \" (\" + fullCode + \").\";\r\n        var error = new FirebaseError(fullCode, fullMessage);\r\n        // Keys with an underscore at the end of their name are not included in\r\n        // error.data for some reason.\r\n        // TODO: Replace with Object.entries when lib is updated to es2017.\r\n        for (var _a = 0, _b = Object.keys(customData); _a < _b.length; _a++) {\r\n            var key = _b[_a];\r\n            if (key.slice(-1) !== '_') {\r\n                if (key in error) {\r\n                    console.warn(\"Overwriting FirebaseError base field \\\"\" + key + \"\\\" can cause unexpected behavior.\");\r\n                }\r\n                error[key] = customData[key];\r\n            }\r\n        }\r\n        return error;\r\n    };\r\n    return ErrorFactory;\r\n}());\r\nfunction replaceTemplate(template, data) {\r\n    return template.replace(PATTERN, function (_, key) {\r\n        var value = data[key];\r\n        return value != null ? value.toString() : \"<\" + key + \"?>\";\r\n    });\r\n}\r\nvar PATTERN = /\\{\\$([^}]+)}/g;\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Evaluates a JSON string into a javascript object.\r\n *\r\n * @param {string} str A string containing JSON.\r\n * @return {*} The javascript object representing the specified JSON.\r\n */\r\nfunction jsonEval(str) {\r\n    return JSON.parse(str);\r\n}\r\n/**\r\n * Returns JSON representing a javascript object.\r\n * @param {*} data Javascript object to be stringified.\r\n * @return {string} The JSON contents of the object.\r\n */\r\nfunction stringify(data) {\r\n    return JSON.stringify(data);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Decodes a Firebase auth. token into constituent parts.\r\n *\r\n * Notes:\r\n * - May return with invalid / incomplete claims if there's no native base64 decoding support.\r\n * - Doesn't check if the token is actually valid.\r\n */\r\nvar decode = function (token) {\r\n    var header = {}, claims = {}, data = {}, signature = '';\r\n    try {\r\n        var parts = token.split('.');\r\n        header = jsonEval(base64Decode(parts[0]) || '');\r\n        claims = jsonEval(base64Decode(parts[1]) || '');\r\n        signature = parts[2];\r\n        data = claims['d'] || {};\r\n        delete claims['d'];\r\n    }\r\n    catch (e) { }\r\n    return {\r\n        header: header,\r\n        claims: claims,\r\n        data: data,\r\n        signature: signature\r\n    };\r\n};\r\n/**\r\n * Decodes a Firebase auth. token and checks the validity of its time-based claims. Will return true if the\r\n * token is within the time window authorized by the 'nbf' (not-before) and 'iat' (issued-at) claims.\r\n *\r\n * Notes:\r\n * - May return a false negative if there's no native base64 decoding support.\r\n * - Doesn't check if the token is actually valid.\r\n */\r\nvar isValidTimestamp = function (token) {\r\n    var claims = decode(token).claims;\r\n    var now = Math.floor(new Date().getTime() / 1000);\r\n    var validSince = 0, validUntil = 0;\r\n    if (typeof claims === 'object') {\r\n        if (claims.hasOwnProperty('nbf')) {\r\n            validSince = claims['nbf'];\r\n        }\r\n        else if (claims.hasOwnProperty('iat')) {\r\n            validSince = claims['iat'];\r\n        }\r\n        if (claims.hasOwnProperty('exp')) {\r\n            validUntil = claims['exp'];\r\n        }\r\n        else {\r\n            // token will expire after 24h by default\r\n            validUntil = validSince + 86400;\r\n        }\r\n    }\r\n    return (!!now &&\r\n        !!validSince &&\r\n        !!validUntil &&\r\n        now >= validSince &&\r\n        now <= validUntil);\r\n};\r\n/**\r\n * Decodes a Firebase auth. token and returns its issued at time if valid, null otherwise.\r\n *\r\n * Notes:\r\n * - May return null if there's no native base64 decoding support.\r\n * - Doesn't check if the token is actually valid.\r\n */\r\nvar issuedAtTime = function (token) {\r\n    var claims = decode(token).claims;\r\n    if (typeof claims === 'object' && claims.hasOwnProperty('iat')) {\r\n        return claims['iat'];\r\n    }\r\n    return null;\r\n};\r\n/**\r\n * Decodes a Firebase auth. token and checks the validity of its format. Expects a valid issued-at time.\r\n *\r\n * Notes:\r\n * - May return a false negative if there's no native base64 decoding support.\r\n * - Doesn't check if the token is actually valid.\r\n */\r\nvar isValidFormat = function (token) {\r\n    var decoded = decode(token), claims = decoded.claims;\r\n    return !!claims && typeof claims === 'object' && claims.hasOwnProperty('iat');\r\n};\r\n/**\r\n * Attempts to peer into an auth token and determine if it's an admin auth token by looking at the claims portion.\r\n *\r\n * Notes:\r\n * - May return a false negative if there's no native base64 decoding support.\r\n * - Doesn't check if the token is actually valid.\r\n */\r\nvar isAdmin = function (token) {\r\n    var claims = decode(token).claims;\r\n    return typeof claims === 'object' && claims['admin'] === true;\r\n};\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction contains(obj, key) {\r\n    return Object.prototype.hasOwnProperty.call(obj, key);\r\n}\r\nfunction safeGet(obj, key) {\r\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\r\n        return obj[key];\r\n    }\r\n    else {\r\n        return undefined;\r\n    }\r\n}\r\nfunction isEmpty(obj) {\r\n    for (var key in obj) {\r\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\nfunction map(obj, fn, contextObj) {\r\n    var res = {};\r\n    for (var key in obj) {\r\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\r\n            res[key] = fn.call(contextObj, obj[key], key, obj);\r\n        }\r\n    }\r\n    return res;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns a querystring-formatted string (e.g. &arg=val&arg2=val2) from a\r\n * params object (e.g. {arg: 'val', arg2: 'val2'})\r\n * Note: You must prepend it with ? when adding it to a URL.\r\n */\r\nfunction querystring(querystringParams) {\r\n    var params = [];\r\n    var _loop_1 = function (key, value) {\r\n        if (Array.isArray(value)) {\r\n            value.forEach(function (arrayVal) {\r\n                params.push(encodeURIComponent(key) + '=' + encodeURIComponent(arrayVal));\r\n            });\r\n        }\r\n        else {\r\n            params.push(encodeURIComponent(key) + '=' + encodeURIComponent(value));\r\n        }\r\n    };\r\n    for (var _i = 0, _a = Object.entries(querystringParams); _i < _a.length; _i++) {\r\n        var _b = _a[_i], key = _b[0], value = _b[1];\r\n        _loop_1(key, value);\r\n    }\r\n    return params.length ? '&' + params.join('&') : '';\r\n}\r\n/**\r\n * Decodes a querystring (e.g. ?arg=val&arg2=val2) into a params object\r\n * (e.g. {arg: 'val', arg2: 'val2'})\r\n */\r\nfunction querystringDecode(querystring) {\r\n    var obj = {};\r\n    var tokens = querystring.replace(/^\\?/, '').split('&');\r\n    tokens.forEach(function (token) {\r\n        if (token) {\r\n            var key = token.split('=');\r\n            obj[key[0]] = key[1];\r\n        }\r\n    });\r\n    return obj;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @fileoverview SHA-1 cryptographic hash.\r\n * Variable names follow the notation in FIPS PUB 180-3:\r\n * http://csrc.nist.gov/publications/fips/fips180-3/fips180-3_final.pdf.\r\n *\r\n * Usage:\r\n *   var sha1 = new sha1();\r\n *   sha1.update(bytes);\r\n *   var hash = sha1.digest();\r\n *\r\n * Performance:\r\n *   Chrome 23:   ~400 Mbit/s\r\n *   Firefox 16:  ~250 Mbit/s\r\n *\r\n */\r\n/**\r\n * SHA-1 cryptographic hash constructor.\r\n *\r\n * The properties declared here are discussed in the above algorithm document.\r\n * @constructor\r\n * @final\r\n * @struct\r\n */\r\nvar Sha1 = /** @class */ (function () {\r\n    function Sha1() {\r\n        /**\r\n         * Holds the previous values of accumulated variables a-e in the compress_\r\n         * function.\r\n         * @private\r\n         */\r\n        this.chain_ = [];\r\n        /**\r\n         * A buffer holding the partially computed hash result.\r\n         * @private\r\n         */\r\n        this.buf_ = [];\r\n        /**\r\n         * An array of 80 bytes, each a part of the message to be hashed.  Referred to\r\n         * as the message schedule in the docs.\r\n         * @private\r\n         */\r\n        this.W_ = [];\r\n        /**\r\n         * Contains data needed to pad messages less than 64 bytes.\r\n         * @private\r\n         */\r\n        this.pad_ = [];\r\n        /**\r\n         * @private {number}\r\n         */\r\n        this.inbuf_ = 0;\r\n        /**\r\n         * @private {number}\r\n         */\r\n        this.total_ = 0;\r\n        this.blockSize = 512 / 8;\r\n        this.pad_[0] = 128;\r\n        for (var i = 1; i < this.blockSize; ++i) {\r\n            this.pad_[i] = 0;\r\n        }\r\n        this.reset();\r\n    }\r\n    Sha1.prototype.reset = function () {\r\n        this.chain_[0] = 0x67452301;\r\n        this.chain_[1] = 0xefcdab89;\r\n        this.chain_[2] = 0x98badcfe;\r\n        this.chain_[3] = 0x10325476;\r\n        this.chain_[4] = 0xc3d2e1f0;\r\n        this.inbuf_ = 0;\r\n        this.total_ = 0;\r\n    };\r\n    /**\r\n     * Internal compress helper function.\r\n     * @param buf Block to compress.\r\n     * @param offset Offset of the block in the buffer.\r\n     * @private\r\n     */\r\n    Sha1.prototype.compress_ = function (buf, offset) {\r\n        if (!offset) {\r\n            offset = 0;\r\n        }\r\n        var W = this.W_;\r\n        // get 16 big endian words\r\n        if (typeof buf === 'string') {\r\n            for (var i = 0; i < 16; i++) {\r\n                // TODO(user): [bug 8140122] Recent versions of Safari for Mac OS and iOS\r\n                // have a bug that turns the post-increment ++ operator into pre-increment\r\n                // during JIT compilation.  We have code that depends heavily on SHA-1 for\r\n                // correctness and which is affected by this bug, so I've removed all uses\r\n                // of post-increment ++ in which the result value is used.  We can revert\r\n                // this change once the Safari bug\r\n                // (https://bugs.webkit.org/show_bug.cgi?id=109036) has been fixed and\r\n                // most clients have been updated.\r\n                W[i] =\r\n                    (buf.charCodeAt(offset) << 24) |\r\n                        (buf.charCodeAt(offset + 1) << 16) |\r\n                        (buf.charCodeAt(offset + 2) << 8) |\r\n                        buf.charCodeAt(offset + 3);\r\n                offset += 4;\r\n            }\r\n        }\r\n        else {\r\n            for (var i = 0; i < 16; i++) {\r\n                W[i] =\r\n                    (buf[offset] << 24) |\r\n                        (buf[offset + 1] << 16) |\r\n                        (buf[offset + 2] << 8) |\r\n                        buf[offset + 3];\r\n                offset += 4;\r\n            }\r\n        }\r\n        // expand to 80 words\r\n        for (var i = 16; i < 80; i++) {\r\n            var t = W[i - 3] ^ W[i - 8] ^ W[i - 14] ^ W[i - 16];\r\n            W[i] = ((t << 1) | (t >>> 31)) & 0xffffffff;\r\n        }\r\n        var a = this.chain_[0];\r\n        var b = this.chain_[1];\r\n        var c = this.chain_[2];\r\n        var d = this.chain_[3];\r\n        var e = this.chain_[4];\r\n        var f, k;\r\n        // TODO(user): Try to unroll this loop to speed up the computation.\r\n        for (var i = 0; i < 80; i++) {\r\n            if (i < 40) {\r\n                if (i < 20) {\r\n                    f = d ^ (b & (c ^ d));\r\n                    k = 0x5a827999;\r\n                }\r\n                else {\r\n                    f = b ^ c ^ d;\r\n                    k = 0x6ed9eba1;\r\n                }\r\n            }\r\n            else {\r\n                if (i < 60) {\r\n                    f = (b & c) | (d & (b | c));\r\n                    k = 0x8f1bbcdc;\r\n                }\r\n                else {\r\n                    f = b ^ c ^ d;\r\n                    k = 0xca62c1d6;\r\n                }\r\n            }\r\n            var t = (((a << 5) | (a >>> 27)) + f + e + k + W[i]) & 0xffffffff;\r\n            e = d;\r\n            d = c;\r\n            c = ((b << 30) | (b >>> 2)) & 0xffffffff;\r\n            b = a;\r\n            a = t;\r\n        }\r\n        this.chain_[0] = (this.chain_[0] + a) & 0xffffffff;\r\n        this.chain_[1] = (this.chain_[1] + b) & 0xffffffff;\r\n        this.chain_[2] = (this.chain_[2] + c) & 0xffffffff;\r\n        this.chain_[3] = (this.chain_[3] + d) & 0xffffffff;\r\n        this.chain_[4] = (this.chain_[4] + e) & 0xffffffff;\r\n    };\r\n    Sha1.prototype.update = function (bytes, length) {\r\n        // TODO(johnlenz): tighten the function signature and remove this check\r\n        if (bytes == null) {\r\n            return;\r\n        }\r\n        if (length === undefined) {\r\n            length = bytes.length;\r\n        }\r\n        var lengthMinusBlock = length - this.blockSize;\r\n        var n = 0;\r\n        // Using local instead of member variables gives ~5% speedup on Firefox 16.\r\n        var buf = this.buf_;\r\n        var inbuf = this.inbuf_;\r\n        // The outer while loop should execute at most twice.\r\n        while (n < length) {\r\n            // When we have no data in the block to top up, we can directly process the\r\n            // input buffer (assuming it contains sufficient data). This gives ~25%\r\n            // speedup on Chrome 23 and ~15% speedup on Firefox 16, but requires that\r\n            // the data is provided in large chunks (or in multiples of 64 bytes).\r\n            if (inbuf === 0) {\r\n                while (n <= lengthMinusBlock) {\r\n                    this.compress_(bytes, n);\r\n                    n += this.blockSize;\r\n                }\r\n            }\r\n            if (typeof bytes === 'string') {\r\n                while (n < length) {\r\n                    buf[inbuf] = bytes.charCodeAt(n);\r\n                    ++inbuf;\r\n                    ++n;\r\n                    if (inbuf === this.blockSize) {\r\n                        this.compress_(buf);\r\n                        inbuf = 0;\r\n                        // Jump to the outer loop so we use the full-block optimization.\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                while (n < length) {\r\n                    buf[inbuf] = bytes[n];\r\n                    ++inbuf;\r\n                    ++n;\r\n                    if (inbuf === this.blockSize) {\r\n                        this.compress_(buf);\r\n                        inbuf = 0;\r\n                        // Jump to the outer loop so we use the full-block optimization.\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        this.inbuf_ = inbuf;\r\n        this.total_ += length;\r\n    };\r\n    /** @override */\r\n    Sha1.prototype.digest = function () {\r\n        var digest = [];\r\n        var totalBits = this.total_ * 8;\r\n        // Add pad 0x80 0x00*.\r\n        if (this.inbuf_ < 56) {\r\n            this.update(this.pad_, 56 - this.inbuf_);\r\n        }\r\n        else {\r\n            this.update(this.pad_, this.blockSize - (this.inbuf_ - 56));\r\n        }\r\n        // Add # bits.\r\n        for (var i = this.blockSize - 1; i >= 56; i--) {\r\n            this.buf_[i] = totalBits & 255;\r\n            totalBits /= 256; // Don't use bit-shifting here!\r\n        }\r\n        this.compress_(this.buf_);\r\n        var n = 0;\r\n        for (var i = 0; i < 5; i++) {\r\n            for (var j = 24; j >= 0; j -= 8) {\r\n                digest[n] = (this.chain_[i] >> j) & 255;\r\n                ++n;\r\n            }\r\n        }\r\n        return digest;\r\n    };\r\n    return Sha1;\r\n}());\n\n/**\r\n * Helper to make a Subscribe function (just like Promise helps make a\r\n * Thenable).\r\n *\r\n * @param executor Function which can make calls to a single Observer\r\n *     as a proxy.\r\n * @param onNoObservers Callback when count of Observers goes to zero.\r\n */\r\nfunction createSubscribe(executor, onNoObservers) {\r\n    var proxy = new ObserverProxy(executor, onNoObservers);\r\n    return proxy.subscribe.bind(proxy);\r\n}\r\n/**\r\n * Implement fan-out for any number of Observers attached via a subscribe\r\n * function.\r\n */\r\nvar ObserverProxy = /** @class */ (function () {\r\n    /**\r\n     * @param executor Function which can make calls to a single Observer\r\n     *     as a proxy.\r\n     * @param onNoObservers Callback when count of Observers goes to zero.\r\n     */\r\n    function ObserverProxy(executor, onNoObservers) {\r\n        var _this = this;\r\n        this.observers = [];\r\n        this.unsubscribes = [];\r\n        this.observerCount = 0;\r\n        // Micro-task scheduling by calling task.then().\r\n        this.task = Promise.resolve();\r\n        this.finalized = false;\r\n        this.onNoObservers = onNoObservers;\r\n        // Call the executor asynchronously so subscribers that are called\r\n        // synchronously after the creation of the subscribe function\r\n        // can still receive the very first value generated in the executor.\r\n        this.task\r\n            .then(function () {\r\n            executor(_this);\r\n        })\r\n            .catch(function (e) {\r\n            _this.error(e);\r\n        });\r\n    }\r\n    ObserverProxy.prototype.next = function (value) {\r\n        this.forEachObserver(function (observer) {\r\n            observer.next(value);\r\n        });\r\n    };\r\n    ObserverProxy.prototype.error = function (error) {\r\n        this.forEachObserver(function (observer) {\r\n            observer.error(error);\r\n        });\r\n        this.close(error);\r\n    };\r\n    ObserverProxy.prototype.complete = function () {\r\n        this.forEachObserver(function (observer) {\r\n            observer.complete();\r\n        });\r\n        this.close();\r\n    };\r\n    /**\r\n     * Subscribe function that can be used to add an Observer to the fan-out list.\r\n     *\r\n     * - We require that no event is sent to a subscriber sychronously to their\r\n     *   call to subscribe().\r\n     */\r\n    ObserverProxy.prototype.subscribe = function (nextOrObserver, error, complete) {\r\n        var _this = this;\r\n        var observer;\r\n        if (nextOrObserver === undefined &&\r\n            error === undefined &&\r\n            complete === undefined) {\r\n            throw new Error('Missing Observer.');\r\n        }\r\n        // Assemble an Observer object when passed as callback functions.\r\n        if (implementsAnyMethods(nextOrObserver, [\r\n            'next',\r\n            'error',\r\n            'complete'\r\n        ])) {\r\n            observer = nextOrObserver;\r\n        }\r\n        else {\r\n            observer = {\r\n                next: nextOrObserver,\r\n                error: error,\r\n                complete: complete\r\n            };\r\n        }\r\n        if (observer.next === undefined) {\r\n            observer.next = noop;\r\n        }\r\n        if (observer.error === undefined) {\r\n            observer.error = noop;\r\n        }\r\n        if (observer.complete === undefined) {\r\n            observer.complete = noop;\r\n        }\r\n        var unsub = this.unsubscribeOne.bind(this, this.observers.length);\r\n        // Attempt to subscribe to a terminated Observable - we\r\n        // just respond to the Observer with the final error or complete\r\n        // event.\r\n        if (this.finalized) {\r\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n            this.task.then(function () {\r\n                try {\r\n                    if (_this.finalError) {\r\n                        observer.error(_this.finalError);\r\n                    }\r\n                    else {\r\n                        observer.complete();\r\n                    }\r\n                }\r\n                catch (e) {\r\n                    // nothing\r\n                }\r\n                return;\r\n            });\r\n        }\r\n        this.observers.push(observer);\r\n        return unsub;\r\n    };\r\n    // Unsubscribe is synchronous - we guarantee that no events are sent to\r\n    // any unsubscribed Observer.\r\n    ObserverProxy.prototype.unsubscribeOne = function (i) {\r\n        if (this.observers === undefined || this.observers[i] === undefined) {\r\n            return;\r\n        }\r\n        delete this.observers[i];\r\n        this.observerCount -= 1;\r\n        if (this.observerCount === 0 && this.onNoObservers !== undefined) {\r\n            this.onNoObservers(this);\r\n        }\r\n    };\r\n    ObserverProxy.prototype.forEachObserver = function (fn) {\r\n        if (this.finalized) {\r\n            // Already closed by previous event....just eat the additional values.\r\n            return;\r\n        }\r\n        // Since sendOne calls asynchronously - there is no chance that\r\n        // this.observers will become undefined.\r\n        for (var i = 0; i < this.observers.length; i++) {\r\n            this.sendOne(i, fn);\r\n        }\r\n    };\r\n    // Call the Observer via one of it's callback function. We are careful to\r\n    // confirm that the observe has not been unsubscribed since this asynchronous\r\n    // function had been queued.\r\n    ObserverProxy.prototype.sendOne = function (i, fn) {\r\n        var _this = this;\r\n        // Execute the callback asynchronously\r\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n        this.task.then(function () {\r\n            if (_this.observers !== undefined && _this.observers[i] !== undefined) {\r\n                try {\r\n                    fn(_this.observers[i]);\r\n                }\r\n                catch (e) {\r\n                    // Ignore exceptions raised in Observers or missing methods of an\r\n                    // Observer.\r\n                    // Log error to console. b/31404806\r\n                    if (typeof console !== 'undefined' && console.error) {\r\n                        console.error(e);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    };\r\n    ObserverProxy.prototype.close = function (err) {\r\n        var _this = this;\r\n        if (this.finalized) {\r\n            return;\r\n        }\r\n        this.finalized = true;\r\n        if (err !== undefined) {\r\n            this.finalError = err;\r\n        }\r\n        // Proxy is no longer needed - garbage collect references\r\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n        this.task.then(function () {\r\n            _this.observers = undefined;\r\n            _this.onNoObservers = undefined;\r\n        });\r\n    };\r\n    return ObserverProxy;\r\n}());\r\n/** Turn synchronous function into one called asynchronously. */\r\nfunction async(fn, onError) {\r\n    return function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        Promise.resolve(true)\r\n            .then(function () {\r\n            fn.apply(void 0, args);\r\n        })\r\n            .catch(function (error) {\r\n            if (onError) {\r\n                onError(error);\r\n            }\r\n        });\r\n    };\r\n}\r\n/**\r\n * Return true if the object passed in implements any of the named methods.\r\n */\r\nfunction implementsAnyMethods(obj, methods) {\r\n    if (typeof obj !== 'object' || obj === null) {\r\n        return false;\r\n    }\r\n    for (var _i = 0, methods_1 = methods; _i < methods_1.length; _i++) {\r\n        var method = methods_1[_i];\r\n        if (method in obj && typeof obj[method] === 'function') {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\nfunction noop() {\r\n    // do nothing\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Check to make sure the appropriate number of arguments are provided for a public function.\r\n * Throws an error if it fails.\r\n *\r\n * @param fnName The function name\r\n * @param minCount The minimum number of arguments to allow for the function call\r\n * @param maxCount The maximum number of argument to allow for the function call\r\n * @param argCount The actual number of arguments provided.\r\n */\r\nvar validateArgCount = function (fnName, minCount, maxCount, argCount) {\r\n    var argError;\r\n    if (argCount < minCount) {\r\n        argError = 'at least ' + minCount;\r\n    }\r\n    else if (argCount > maxCount) {\r\n        argError = maxCount === 0 ? 'none' : 'no more than ' + maxCount;\r\n    }\r\n    if (argError) {\r\n        var error = fnName +\r\n            ' failed: Was called with ' +\r\n            argCount +\r\n            (argCount === 1 ? ' argument.' : ' arguments.') +\r\n            ' Expects ' +\r\n            argError +\r\n            '.';\r\n        throw new Error(error);\r\n    }\r\n};\r\n/**\r\n * Generates a string to prefix an error message about failed argument validation\r\n *\r\n * @param fnName The function name\r\n * @param argumentNumber The index of the argument\r\n * @param optional Whether or not the argument is optional\r\n * @return The prefix to add to the error thrown for validation.\r\n */\r\nfunction errorPrefix(fnName, argumentNumber, optional) {\r\n    var argName = '';\r\n    switch (argumentNumber) {\r\n        case 1:\r\n            argName = optional ? 'first' : 'First';\r\n            break;\r\n        case 2:\r\n            argName = optional ? 'second' : 'Second';\r\n            break;\r\n        case 3:\r\n            argName = optional ? 'third' : 'Third';\r\n            break;\r\n        case 4:\r\n            argName = optional ? 'fourth' : 'Fourth';\r\n            break;\r\n        default:\r\n            throw new Error('errorPrefix called with argumentNumber > 4.  Need to update it?');\r\n    }\r\n    var error = fnName + ' failed: ';\r\n    error += argName + ' argument ';\r\n    return error;\r\n}\r\n/**\r\n * @param fnName\r\n * @param argumentNumber\r\n * @param namespace\r\n * @param optional\r\n */\r\nfunction validateNamespace(fnName, argumentNumber, namespace, optional) {\r\n    if (optional && !namespace) {\r\n        return;\r\n    }\r\n    if (typeof namespace !== 'string') {\r\n        //TODO: I should do more validation here. We only allow certain chars in namespaces.\r\n        throw new Error(errorPrefix(fnName, argumentNumber, optional) +\r\n            'must be a valid firebase namespace.');\r\n    }\r\n}\r\nfunction validateCallback(fnName, argumentNumber, callback, optional) {\r\n    if (optional && !callback) {\r\n        return;\r\n    }\r\n    if (typeof callback !== 'function') {\r\n        throw new Error(errorPrefix(fnName, argumentNumber, optional) +\r\n            'must be a valid function.');\r\n    }\r\n}\r\nfunction validateContextObject(fnName, argumentNumber, context, optional) {\r\n    if (optional && !context) {\r\n        return;\r\n    }\r\n    if (typeof context !== 'object' || context === null) {\r\n        throw new Error(errorPrefix(fnName, argumentNumber, optional) +\r\n            'must be a valid context object.');\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// Code originally came from goog.crypt.stringToUtf8ByteArray, but for some reason they\r\n// automatically replaced '\\r\\n' with '\\n', and they didn't handle surrogate pairs,\r\n// so it's been modified.\r\n// Note that not all Unicode characters appear as single characters in JavaScript strings.\r\n// fromCharCode returns the UTF-16 encoding of a character - so some Unicode characters\r\n// use 2 characters in Javascript.  All 4-byte UTF-8 characters begin with a first\r\n// character in the range 0xD800 - 0xDBFF (the first character of a so-called surrogate\r\n// pair).\r\n// See http://www.ecma-international.org/ecma-262/5.1/#sec-15.1.3\r\n/**\r\n * @param {string} str\r\n * @return {Array}\r\n */\r\nvar stringToByteArray$1 = function (str) {\r\n    var out = [];\r\n    var p = 0;\r\n    for (var i = 0; i < str.length; i++) {\r\n        var c = str.charCodeAt(i);\r\n        // Is this the lead surrogate in a surrogate pair?\r\n        if (c >= 0xd800 && c <= 0xdbff) {\r\n            var high = c - 0xd800; // the high 10 bits.\r\n            i++;\r\n            assert(i < str.length, 'Surrogate pair missing trail surrogate.');\r\n            var low = str.charCodeAt(i) - 0xdc00; // the low 10 bits.\r\n            c = 0x10000 + (high << 10) + low;\r\n        }\r\n        if (c < 128) {\r\n            out[p++] = c;\r\n        }\r\n        else if (c < 2048) {\r\n            out[p++] = (c >> 6) | 192;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n        else if (c < 65536) {\r\n            out[p++] = (c >> 12) | 224;\r\n            out[p++] = ((c >> 6) & 63) | 128;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n        else {\r\n            out[p++] = (c >> 18) | 240;\r\n            out[p++] = ((c >> 12) & 63) | 128;\r\n            out[p++] = ((c >> 6) & 63) | 128;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n    }\r\n    return out;\r\n};\r\n/**\r\n * Calculate length without actually converting; useful for doing cheaper validation.\r\n * @param {string} str\r\n * @return {number}\r\n */\r\nvar stringLength = function (str) {\r\n    var p = 0;\r\n    for (var i = 0; i < str.length; i++) {\r\n        var c = str.charCodeAt(i);\r\n        if (c < 128) {\r\n            p++;\r\n        }\r\n        else if (c < 2048) {\r\n            p += 2;\r\n        }\r\n        else if (c >= 0xd800 && c <= 0xdbff) {\r\n            // Lead surrogate of a surrogate pair.  The pair together will take 4 bytes to represent.\r\n            p += 4;\r\n            i++; // skip trail surrogate.\r\n        }\r\n        else {\r\n            p += 3;\r\n        }\r\n    }\r\n    return p;\r\n};\n\nexports.CONSTANTS = CONSTANTS;\nexports.Deferred = Deferred;\nexports.ErrorFactory = ErrorFactory;\nexports.FirebaseError = FirebaseError;\nexports.Sha1 = Sha1;\nexports.assert = assert;\nexports.assertionError = assertionError;\nexports.async = async;\nexports.base64 = base64;\nexports.base64Decode = base64Decode;\nexports.base64Encode = base64Encode;\nexports.contains = contains;\nexports.createSubscribe = createSubscribe;\nexports.decode = decode;\nexports.deepCopy = deepCopy;\nexports.deepExtend = deepExtend;\nexports.errorPrefix = errorPrefix;\nexports.getUA = getUA;\nexports.isAdmin = isAdmin;\nexports.isBrowser = isBrowser;\nexports.isBrowserExtension = isBrowserExtension;\nexports.isElectron = isElectron;\nexports.isEmpty = isEmpty;\nexports.isIE = isIE;\nexports.isMobileCordova = isMobileCordova;\nexports.isNode = isNode;\nexports.isNodeSdk = isNodeSdk;\nexports.isReactNative = isReactNative;\nexports.isSafari = isSafari;\nexports.isUWP = isUWP;\nexports.isValidFormat = isValidFormat;\nexports.isValidTimestamp = isValidTimestamp;\nexports.issuedAtTime = issuedAtTime;\nexports.jsonEval = jsonEval;\nexports.map = map;\nexports.querystring = querystring;\nexports.querystringDecode = querystringDecode;\nexports.safeGet = safeGet;\nexports.stringLength = stringLength;\nexports.stringToByteArray = stringToByteArray$1;\nexports.stringify = stringify;\nexports.validateArgCount = validateArgCount;\nexports.validateCallback = validateCallback;\nexports.validateContextObject = validateContextObject;\nexports.validateNamespace = validateNamespace;\n//# sourceMappingURL=index.cjs.js.map\n"],"sourceRoot":""}